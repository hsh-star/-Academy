<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="نظام تسجيل حضور وانصراف حلقة الشيخة نظيرة ودن - حفظها الله - تجويد أفنان طالبات الدُفعة الأولى المستوى الثاني">
  <meta name="theme-color" content="#BD9750">
  <title>أكاديمية أفنان لتعليم القرآن وعلومه</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="logo-afnan.png" as="image">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@400;700&display=swap" as="style">
  
  <!-- تحسين الأداء -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no">
  
  <!-- DNS Prefetch for external resources -->
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- إزالة تضارب script.js -->
  <style>
     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* ضمان عدم وجود مساحات زائدة */
    html, body {
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: hidden !important;
      margin: 0 !important;
      padding: 0 !important;
      position: relative !important;
    }
    
    /* منع scroll أفقي */
    @media (max-width: 767px) {
      html, body {
        overflow-x: hidden !important;
        width: 100vw !important;
        max-width: 100vw !important;
      }
      
      * {
        max-width: 100vw !important;
      }
    }
    
    .main-container {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      overflow-x: hidden !important;
    }

    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      min-height: 100vh;
      direction: rtl;
      margin: 0 !important;
      padding: 0 !important;
    }

    .main-container {
      max-width: none;
      margin: 0 !important;
      padding: 0 !important;
    }

    /* ========== HEADER & LOGO - CLEAN VERSION ========== */
    header.afnan-header-fixed {
      background: #fff;
      border-bottom: 1px solid #e5e0d3;
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      margin-bottom: 0;
      padding: 0;
      height: 75px;
      min-height: 75px;
    }
    .afnan-header-inner {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      height: 75px;
      min-height: 75px;
      padding: 8px;
    }
    .afnan-logo {
      height: 90px;
      max-height: 90px;
      width: auto;
      object-fit: contain;
      margin: 0 auto;
      display: block;
    }
    .afnan-nav-link, .lang-btn {
      color: #8B6F2F !important;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: bold;
      font-size: 0.9rem;
      text-decoration: none;
      transition: color 0.2s;
      padding: 0 8px;
    }
    .afnan-nav-link:hover, .afnan-nav-link.active, .lang-btn:hover {
      color: #BD9750 !important;
    }
    .afnan-nav-list {
      gap: 16px;
    }
    .form-container { 
      margin-top: 80px !important; 
    }
    
    /* ضمان ظهور وصف الأكاديمية تحت الهيدر */
    .afnan-academy-desc {
      margin-top: 85px !important;
      position: relative;
      z-index: 10;
    }
    .header-gap {
      display: none !important; 
      height: 0 !important; 
    }
    
    /* ========== MOBILE HEADER ========== */
    @media (max-width: 600px) {
      .afnan-header-inner {
        height: 60px !important;
        min-height: 60px !important;
      }
      .afnan-logo {
        height: 70px !important;
        max-height: 70px !important;
      }
      .afnan-nav-link, .lang-btn {
        font-size: 0.8rem !important;
      }
      .form-container {
        margin-top: 70px !important; 
        margin-bottom: 80px !important; /* مساحة للشريط السفلي */
      }
      
      /* إصلاح الشريط السفلي للهاتف */
      .afnan-bottom-navbar {
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        background: white !important;
        border-top: 1px solid #e5e0d3 !important;
        z-index: 999 !important;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
      }
      
          /* إصلاح الهيدر للهاتف */
    header.afnan-header-fixed {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      width: 100vw !important;
      max-width: 100vw !important;
      z-index: 1000 !important;
      box-sizing: border-box !important;
    }
    
    .afnan-header-inner {
      width: 100% !important;
      max-width: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    .afnan-logo {
      width: 100% !important;
      max-width: 100% !important;
      height: auto !important;
      object-fit: contain !important;
    }
    }
    /* ========== END HEADER & LOGO ========== */

    /* ========== FORM CONTAINER SPACING ========== */
    .form-container { margin-top: 36px !important; }
    @media (max-width: 600px) { 
      .form-container { 
        margin-top: 24px !important; 
        margin-bottom: 80px !important; /* مساحة للشريط السفلي */
      } 
    }
    /* ========== END FORM CONTAINER SPACING ========== */

    /* ========== HIDE HEADER GAP ========== */
    .header-gap { display: none !important; height: 0 !important; }
    
    /* إضافة مساحة للشريط السفلي على الهاتف */
    @media (max-width: 767px) {
      body {
        padding-bottom: 80px !important;
        width: 100vw !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
      }
      
      .main-container {
        padding-bottom: 80px !important;
        width: 100vw !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
      }
      
      .admin-panel {
        padding-bottom: 80px !important;
        width: 100% !important;
        max-width: 100% !important;
      }
      
      /* إصلاح الفوتر على الهاتف */
      .afnan-footer {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
        position: relative !important;
        z-index: 1001 !important; /* أعلى من الشريط السفلي */
        width: 100% !important;
        max-width: 100% !important;
      }
      
      /* ضمان ظهور جميع الأيقونات */
      .afnan-bottom-navbar {
        display: flex !important;
        justify-content: space-around !important;
        align-items: center !important;
        flex-wrap: nowrap !important;
      }
      
      .afnan-bottom-navbar .bottom-nav-btn {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        min-width: 0 !important;
        max-width: none !important;
      }
    }
    /* ========== END HIDE HEADER GAP ========== */

    /* ========== NAV LINKS IDs ========== */
    /* أضف id لزر الرئيسية */
    /* في الهيدر: */
    /* <a href="index.html" class="afnan-nav-link" id="homeNavBtn">الصفحة الرئيسية</a> */
    /* في الشريط السفلي: */
    /* <button class="bottom-nav-btn" id="mobileHomeBtn">... */
    /* في القائمة الجانبية: */
    /* <a href="#" class="mobile-menu-link" id="sideHomeLink">الصفحة الرئيسية</a> */
    /* ========== END NAV LINKS IDs ========== */

    /* ========== REMOVE OLD/CONFLICTING LOGO & HEADER CSS ========== */
    /* (احذف أي تعريفات .afnan-logo أو .afnan-header-inner أو .header-gap أو .form-container متضاربة لاحقًا في الصفحة) */

    .afnan-navbar {
      display: flex;
      flex: 1;
      justify-content: flex-start;
      align-items: center;
      order: 2;
      margin: 0;
      padding: 0;
    }

    .afnan-nav-list {
      display: flex;
      flex-direction: row;
      justify-content: flex-end;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0 8px 0 0 !important;
      gap: 24px;
    }

    .homework-dropdown {
      position: relative;
    }

    .homework-btn {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .homework-btn i {
      font-size: 0.8rem;
      transition: transform 0.3s;
    }

    .homework-dropdown:hover .homework-btn i {
      transform: rotate(180deg);
    }

    .dropdown-menu-homework {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid #e5e0d3;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      min-width: 250px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      list-style: none;
      padding: 8px 0;
      margin: 0;
    }

    .homework-dropdown:hover .dropdown-menu-homework {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item-homework {
      display: block;
      width: 100%;
      padding: 12px 20px;
      background: none;
      border: none;
      text-align: right;
      color: #8B6F2F;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .dropdown-item-homework:hover {
      background-color: #f7ecd6;
      color: #BD9750;
    }

    /* تنسيق قسم إدارة الواجبات (محسن للأداء) */
    .homework-management {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
      will-change: transform;
      transform: translateZ(0); /* تفعيل تسريع GPU */
    }

    .homework-level-card {
      background: white;
      border: 1px solid #e5e0d3;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .homework-level-card h4 {
      color: #8B6F2F;
      margin-bottom: 15px;
      font-size: 1.1rem;
      border-bottom: 2px solid #f7ecd6;
      padding-bottom: 8px;
    }

    .homework-level-card .form-group {
      margin-bottom: 15px;
    }

    .homework-level-card textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* قائمة الواجبات للهاتف */
    .mobile-homework-submenu {
      background: #f9f7f2;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 8px rgba(139,111,47,0.07);
      margin-top: -2px;
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.3s ease;
    }

    .mobile-homework-submenu.active {
      max-height: 300px;
    }

    .mobile-homework-submenu a {
      color: #8B6F2F !important;
      font-family: 'Tajawal', 'Cairo', Arial, sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 12px 20px;
      background: none;
      border: none;
      border-bottom: 1px solid #f5f5f5;
      text-align: right;
      display: block;
      transition: background 0.18s, color 0.18s;
      text-decoration: none;
    }

    .mobile-homework-submenu a:last-child {
      border-bottom: none;
    }

    .mobile-homework-submenu a:hover {
      background: #f7ecd6;
      color: #BD9750 !important;
    }

    .afnan-lang-dropdown {
      position: relative;
      margin-left: 0;
      padding-left: 0;
      order: 1;
    }

    .lang-btn {
      background: none;
      border: none;
      color: #8B6F2F !important;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: bold;
      font-size: 0.9rem;
      text-decoration: none;
      transition: color 0.2s;
      padding: 0 4px;
    }

    .afnan-nav-link {
      color: #8B6F2F !important;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: bold;
      font-size: 0.9rem;
      text-decoration: none;
      transition: color 0.2s;
      padding: 0 4px;
    }

    .afnan-nav-link:hover, .afnan-nav-link.active, .lang-btn:hover {
      color: #BD9750 !important;
    }

    .lang-arrow {
      font-size: 0.9em;
      margin-right: 4px;
    }

    .lang-menu {
      display: none;
      position: absolute;
      top: 120%;
      left: 0;
      background: #fff;
      border: 1px solid #8B6F2F;
      border-radius: 8px;
      min-width: 120px;
      box-shadow: 0 2px 8px rgba(139,111,47,0.08);
      z-index: 10;
      padding: 0;
      list-style: none;
    }

    .afnan-lang-dropdown.open .lang-menu {
      display: block;
    }

    @media (max-width: 900px) {
      .afnan-header-inner { min-height: 40px; height: 40px; }
      .afnan-logo { height: 32px; }
      .afnan-nav-list { gap: 8px; }
    }

    @media (max-width: 600px) {
      .afnan-header-inner { flex-direction: column; align-items: flex-end; padding: 0; min-height: 36px; height: 36px; }
      .afnan-logo { height: 22px !important; max-height: 22px !important; }
      .afnan-navbar { margin-right: 0; }
      .afnan-nav-list { flex-direction: column; gap: 0; align-items: flex-end; }
    }

    footer {
      background: rgba(226,209,178,0.35);
      color: #8B6F2F;
      text-align: center;
      padding: 2px 2px 1px 2px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-size: 0.95rem;
      border-top: 1.5px solid #e5e0d3;
      letter-spacing: 0.5px;
      position: relative;
      margin: 0;
      min-height: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    footer .footer-hadith {
      color: #8B6F2F;
      font-size: 0.93rem;
      margin-bottom: 1px;
      display: block;
      font-weight: bold;
    }

    footer .footer-ayah-img {
      margin: 0 auto 1px auto;
      display: block;
      max-width: 120px;
      width: 40vw;
      height: auto;
      filter: brightness(0) saturate(100%) sepia(100%) hue-rotate(0deg) brightness(0.7) contrast(1.2) grayscale(0) drop-shadow(0 0 0 #8B6F2F) invert(0) opacity(1);
    }

    footer .footer-copyright {
      color: #8B6F2F;
      font-size: 0.85rem;
      margin-top: 1px;
      display: block;
    }

    .academy-title {
      color: #BD9750;
      font-size: 5rem;
      font-weight: bold;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      letter-spacing: 2px;
      line-height: 1.1;
      margin-top: 0;
      margin-bottom: 2rem;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(189,151,80,0.12);
      position: relative;
    }

    .academy-title::before {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      background: #f8f9fa;
      z-index: -1;
      border-radius: 10px;
      opacity: 0.3;
    }

    .system-desc {
      color: #8b4513;
      font-size: 0.95rem;
      font-family: 'Cairo', 'Tajawal', 'Noto Sans Arabic', Arial, sans-serif;
      font-weight: 600;
      letter-spacing: 0.3px;
      margin-bottom: 0;
      text-align: center;
      text-shadow: 1px 1px 1px rgba(139, 69, 19, 0.08);
    }

    .form-container {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      padding: 45px;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.04);
      margin-bottom: 35px;
      border: 1px solid rgba(139, 69, 19, 0.08);
      position: relative;
      overflow: hidden;
    }

    .form-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: #8B4513;
    }

    .tabs {
      display: flex;
      margin-top: 18px;
      margin-bottom: 35px;
      border-bottom: 2px solid #dee2e6;
      background: rgba(248, 249, 250, 0.5);
      border-radius: 12px 12px 0 0;
      padding: 5px 5px 0 5px;
    }

    .tab-btn {
      background: none;
      border: none;
      padding: 18px 35px;
      font-size: 18px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 600;
      cursor: pointer;
      color: #6c757d;
      border-bottom: 3px solid transparent;
      transition: all 0.4s ease;
      position: relative;
      border-radius: 8px 8px 0 0;
    }

    .tab-btn::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 3px;
      background: #8B4513;
      transition: all 0.4s ease;
      transform: translateX(-50%);
    }
    .tab-btn:hover {
      color: #8B4513;
      background: rgba(139, 69, 19, 0.02);
    }

    .tab-btn.active {
      color: #8B4513;
      font-weight: bold;
      background: rgba(139, 69, 19, 0.06);
    }

    .tab-btn.active::before {
      width: 100%;
    }

    .form-section {
      display: none;
    }

    .form-section.active {
      display: block;
    }

    .form-title {
      color: #2c3e50;
      font-size: 28px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 700;
      margin-top: 20px;
      margin-bottom: 30px;
      text-align: center;
      text-shadow: 1px 1px 1px rgba(44, 62, 80, 0.08);
      position: relative;
    }

    .form-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: #8B4513;
      border-radius: 2px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      color: #495057;
      font-size: 18px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 600;
      margin-bottom: 10px;
      position: relative;
      padding-right: 5px;
    }

    .form-label::before {
      content: '•';
      color: #8B4513;
      font-weight: bold;
      margin-left: 5px;
    }

    .form-input {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 16px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      transition: border-color 0.3s ease, background-color 0.3s ease, transform 0.3s ease;
      background: #f8f9fa;
      /* تحسين الأداء */
      will-change: transform;
    }

    .form-input:focus {
      outline: none;
      border-color: #8B4513;
      background: white;
      box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.08);
      transform: translateY(-1px);
    }

    .form-input:disabled {
      background-color: #e9ecef;
      color: #6c757d;
      cursor: not-allowed;
      border-color: #ced4da;
    }

    .btn-row {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }

    .form-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      color: white;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      /* تحسين الأداء */
      will-change: transform;
      transform: translateZ(0);
    }

    .form-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .form-btn:hover::before {
      left: 100%;
    }

    .form-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .form-btn:active {
      transform: translateY(-1px);
    }

    .form-btn:disabled {
      background-color: #6c757d !important;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .form-btn:disabled::before {
      display: none;
    }

    .green-btn {
      background: #198754;
    }

    .gold-btn {
      background: #e6a700;
    }

    .red-btn {
      background: #dc3545;
    }

    .blue-btn {
      background: #0d6efd;
    }

    .small-btn.blue-btn {
      background: #0d6efd;
    }

    .message {
      margin-top: 20px;
      padding: 18px 20px;
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border: none;
      position: relative;
      overflow: hidden;
    }

    .message::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: #8B4513;
    }

    .success {
      background: #d1e7dd;
      color: #0f5132;
      border: 1px solid #badbcc;
    }

    .error {
      background: #f8d7da;
      color: #842029;
      border: 1px solid #f5c2c7;
    }

    .info {
      background: #cff4fc;
      color: #055160;
      border: 1px solid #b6effb;
    }

    .time-info {
      background: linear-gradient(135deg, #fefefe 0%, #f8f9fa 100%);
      color: #8B4513;
      border: 2px solid #8B4513;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 600;
      font-size: 1.1rem;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
    }

    .time-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #8B4513;
    }

    .time-section {
      margin-bottom: 15px;
    }

    .time-section h4 {
      color: #8B4513;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .admin-panel {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .admin-section {
      margin-bottom: 30px;
    }

    .admin-section h3 {
      color: #8B4513;
      margin-bottom: 15px;
      font-size: 20px;
    }

    .students-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
    }

    .student-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
      background: #f9f9f9;
      margin-bottom: 5px;
      border-radius: 3px;
    }

    .student-info {
      flex: 1;
    }

    .student-name {
      font-weight: bold;
      color: #333;
    }

    .attendance-status {
      font-size: 14px;
      color: #666;
    }

    .admin-controls {
      display: flex;
      gap: 10px;
    }

    .small-btn {
      padding: 5px 10px;
      font-size: 12px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      color: white;
    }

    .export-btn {
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
    }

    .time-settings {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .time-group {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
    }

    .time-group h4 {
      color: #8B4513;
      margin-bottom: 10px;
    }

    .time-inputs {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .time-input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 3px;
      font-size: 14px;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }

    .attendance-summary {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }

    .summary-item {
      margin-bottom: 8px;
      padding: 5px;
      border-radius: 3px;
    }

    .summary-attendance {
      background: #d4edda;
      color: #155724;
    }

    .summary-departure {
      background: #fff3cd;
      color: #856404;
    }

    .summary-both {
      background: #d1ecf1;
      color: #0c5460;
    }

    .admin-summary-preview-box {
      background: #fffbe6;
      border: 1.5px solid #BD9750;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(189,151,80,0.07);
      margin: 18px auto 24px auto;
      padding: 24px 10px 18px 10px;
      width: 98%;
      max-width: 1000px;
    }
    @media (max-width: 900px) {
      .admin-summary-preview-box table {
        min-width: 700px !important;
        font-size: 0.98rem;
      }
      .admin-summary-preview-box th, .admin-summary-preview-box td {
        padding: 10px 8px !important;
      }
    }
    @media (max-width: 600px) {
      .admin-summary-preview-box table {
        min-width: 500px !important;
        font-size: 0.93rem;
      }
      .admin-summary-preview-box th, .admin-summary-preview-box td {
        padding: 7px 4px !important;
      }
    }

    .afnan-header {
      background: #fff;
      border-bottom: none;
      box-shadow: 0 2px 12px rgba(189,151,80,0.07);
      margin-bottom: 0;
      padding: 0;
      position: relative;
    }
    .afnan-header-inner {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: none;
      margin: 0;
      padding: 0;
      min-height: 60px;
    }
    .afnan-logo {
      height: 50px;
      width: auto;
      object-fit: contain;
      margin: 0;
      background: none;
      border: none;
      box-shadow: none;
      order: 1;
      flex-shrink: 0;
    }
    .afnan-navbar {
      flex: 1;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      order: 2;
      margin: 0;
      padding: 0;
    }
    .afnan-nav-list {
      display: flex;
      flex-direction: row;
      justify-content: flex-end;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0 8px 0 0 !important;
      gap: 24px;
    }
    .afnan-nav-list > li {
      margin: 0;
      padding: 0;
    }
    .afnan-lang-dropdown {
      position: relative;
      margin-left: 0;
      padding-left: 0;
      order: 1;
    }
    .afnan-nav-list > li:nth-child(2) { order: 2; }
    .afnan-nav-list > li:nth-child(3) { order: 3; }
    .afnan-nav-list > li:nth-child(4) { order: 4; }
    .lang-btn {
      background: none;
      border: none;
      color: #8B6F2F;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      position: relative;
      z-index: 2;
      margin-left: 0;
      padding-left: 0;
    }
    .lang-arrow {
      font-size: 0.9em;
      margin-right: 4px;
    }
    .lang-menu {
      display: none;
      position: absolute;
      top: 120%;
      left: 0;
      background: #fff;
      border: 1px solid #8B6F2F;
      border-radius: 8px;
      min-width: 120px;
      box-shadow: 0 2px 8px rgba(139,111,47,0.08);
      z-index: 10;
      padding: 0;
      list-style: none;
    }
    .afnan-lang-dropdown.open .lang-menu {
      display: block;
    }
    footer {
      background: rgba(226,209,178,0.7);
      color: #8B6F2F;
      text-align: center;
      padding: 4px 2px 2px 2px;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-size: 0.98rem;
      border-top: 1.5px solid #e5e0d3;
      letter-spacing: 0.5px;
      position: relative;
      margin: 0;
      min-height: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    footer .footer-hadith {
      color: #8B6F2F;
      font-size: 0.98rem;
      margin-bottom: 1px;
      display: block;
      font-weight: bold;
    }
    footer .footer-ayah-img {
      margin: 0 auto 1px auto;
      display: block;
      max-width: 180px;
      width: 60vw;
      height: auto;
      filter: brightness(0) saturate(100%) sepia(100%) hue-rotate(0deg) brightness(0.7) contrast(1.2) grayscale(0) drop-shadow(0 0 0 #8B6F2F) invert(0) opacity(1);
    }
    footer .footer-copyright {
      color: #8B6F2F;
      font-size: 0.91rem;
      margin-top: 1px;
      display: block;
    }
    @media (max-width: 900px) {
      .afnan-header-inner { min-height: 60px; padding: 0; }
      .afnan-logo { height: 45px; }
      .afnan-nav-list { gap: 8px; }
    }
    @media (max-width: 600px) {
      .afnan-header-inner { flex-direction: column; align-items: center; padding: 0; min-height: 50px; }
      .afnan-logo { height: 35px; }
      .afnan-navbar { margin-right: 0; }
      .afnan-nav-list { flex-direction: column; gap: 0; align-items: center; }
    }

    /* زر الدعم الفني */
    .support-btn {
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 2000;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 12px rgba(189,151,80,0.13);
      width: 60px;
      height: 60px;
        display: flex;
        align-items: center;
      justify-content: center;
      color: #BD9750 !important;
      font-size: 2.2rem;
      border: 2.5px solid #BD9750;
      transition: box-shadow 0.2s, background 0.2s;
      text-decoration: none;
    }
    .support-btn:hover {
      background: #BD9750;
      color: #fff !important;
      box-shadow: 0 4px 24px rgba(189,151,80,0.25);
    }
    .support-btn .support-tooltip {
      display: none;
      position: absolute;
      left: 70px;
      bottom: 50%;
      transform: translateY(50%);
      background: #fffbe6;
      color: #8B6F2F;
      padding: 7px 18px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(189,151,80,0.13);
      white-space: nowrap;
    }
    .support-btn:hover .support-tooltip {
        display: block;
    }
    .support-btn i {
      color: #BD9750 !important;
      transition: color 0.2s;
    }
    .support-btn:hover i {
      color: #fff !important;
    }
    /* تصغير الفوتر وتوحيد اللون */
    footer {
      background: rgba(226,209,178,0.25);
      color: #8B6F2F;
      text-align: center;
      padding: 2px 0 1px 0;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-size: 0.90rem;
      border-top: 1.5px solid #e5e0d3;
      letter-spacing: 0.5px;
      margin: 0;
      min-height: 6px;
        display: flex;
        flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    footer .footer-hadith,
    footer .footer-copyright,
    footer .footer-narrator {
      color: #8B6F2F !important;
      font-size: 0.90rem;
      font-weight: bold;
      margin: 0 0 1px 0;
    }
    footer .footer-ayah-img {
      margin: 0 auto 1px auto;
      display: block;
      max-width: 90px;
      width: 30vw;
      height: auto;
      filter: brightness(0) saturate(100%) sepia(100%) hue-rotate(0deg) brightness(0.7) contrast(1.2) grayscale(0) drop-shadow(0 0 0 #8B6F2F) invert(0) opacity(1);
    }
    /* زر اللغة أقصى اليسار */
    .afnan-lang-dropdown {
      position: relative;
      margin-left: 0;
      padding-left: 0;
      order: 1;
      margin-right: auto !important;
    }
    .lang-btn {
      background: none;
      border: none;
      color: #8B6F2F !important;
        font-family: 'Cairo', 'Tajawal', sans-serif;
        font-weight: bold;
      font-size: 0.9rem;
      text-decoration: none;
      transition: color 0.2s;
      padding: 0 4px;
      margin-right: 0 !important;
    }
    .afnan-nav-list {
      padding-left: 0 !important;
    }
    @media (max-width: 600px) {
      .afnan-header-inner {
        min-height: 50px !important;
        height: 50px !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 4px 0 4px 0 !important;
        margin: 0 !important;
        background: #fff;
        border: none;
      }
      .afnan-logo {
        width: auto !important;
        max-width: 80vw !important;
        height: 35px !important;
        max-height: 35px !important;
        display: block;
        margin: 0 auto !important;
        object-fit: contain !important;
        background: #fff;
        border: none;
        box-shadow: none;
      }
      .afnan-navbar {
        display: none !important;
      }
      .afnan-menu-btn {
        display: flex !important;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        font-size: 2.2rem;
        color: #BD9750;
        position: absolute;
        right: 12px;
        top: 16px;
        z-index: 2001;
        width: 44px;
        height: 44px;
        cursor: pointer;
      }
      .afnan-nav-list {
        flex-direction: row !important;
        justify-content: center !important;
        align-items: center !important;
        gap: 18px !important;
        width: 100vw;
        padding: 0 !important;
        margin: 0 !important;
        font-size: 1.15rem !important;
      }
      .afnan-nav-link {
        font-size: 1.15rem !important;
        padding: 6px 8px !important;
      }
      .support-btn { display: none !important; }
    }
    @media (min-width: 601px) {
      .support-btn { display: flex !important; right: 24px; left: auto !important; }
    }
    .afnan-bottom-navbar {
      display: none;
    }
    @media (max-width: 600px) {
      .afnan-bottom-navbar {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 48px;
        background: #fff;
        border-top: 1px solid #bbb;
        z-index: 3000;
        justify-content: space-between;
        align-items: stretch;
        padding: 0;
        box-shadow: 0 -1px 6px rgba(0,0,0,0.04);
      }
      .bottom-nav-btn {
        flex: 1;
        background: none;
        border: none;
        outline: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #444;
        font-size: 0.85rem;
        font-family: 'Cairo', 'Tajawal', sans-serif;
        font-weight: 500;
        padding: 0;
        margin: 0;
        height: 100%;
        cursor: pointer;
        border-radius: 0;
        text-decoration: none;
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
      }
      .bottom-nav-btn i {
        font-size: 1.1em;
        margin-bottom: 0px;
        line-height: 1;
        display: block;
      }
      .bottom-nav-btn span {
        font-size: 0.68em;
        margin-top: 0;
        line-height: 1;
        display: block;
        font-weight: 400;
        letter-spacing: 0;
      }
      .bottom-nav-btn:active, .bottom-nav-btn:focus {
        background: #f7e7c1;
      }
    }
    .header-gap {
      height: 0;
    }
    @media (max-width: 600px) {
      .header-gap {
        height: 14px;
      }
    }

    /* ========== القائمة المنسدلة للموبايل ========== */
    .mobile-side-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .mobile-side-menu.active {
      display: block;
      opacity: 1;
    }

    .mobile-side-menu-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
    }

    .mobile-side-menu-content {
      position: absolute;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: #fff;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      transition: left 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .mobile-side-menu.active .mobile-side-menu-content {
      left: 0;
    }

    .mobile-side-menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid #e5e0d3;
      background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
    }

    .mobile-side-menu-logo {
      height: 40px;
      width: auto;
      object-fit: contain;
    }

    .mobile-side-menu-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #8B6F2F;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .mobile-side-menu-close:hover {
      background: rgba(139, 111, 47, 0.1);
    }

    .mobile-side-menu-nav {
      flex: 1;
      padding: 20px 0;
    }

    .mobile-side-menu-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .mobile-side-menu-list li {
      margin: 0;
      padding: 0;
    }

    .mobile-side-menu-link {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      color: #8B6F2F;
      text-decoration: none;
      font-family: 'Cairo', 'Tajawal', sans-serif;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.2s ease;
      border-bottom: 1px solid #f5f5f5;
    }

    .mobile-side-menu-link:hover {
      background: rgba(189, 151, 80, 0.1);
      color: #BD9750;
      transform: translateX(5px);
    }

    .mobile-side-menu-link i {
      margin-left: 15px;
      font-size: 1.2rem;
      width: 20px;
      text-align: center;
    }

    .mobile-side-menu-link span {
      flex: 1;
    }

    /* تحسين تجربة المستخدم */
    @media (max-width: 600px) {
      .mobile-side-menu-content {
        width: 260px;
        left: -260px;
      }
      
      .mobile-side-menu-link {
        padding: 18px 20px;
        font-size: 1.15rem;
      }
      
      .mobile-side-menu-link i {
        font-size: 1.3rem;
      }
    }

    .afnan-nav-list > li:last-child {
      margin-left: 32px;
    }

    /* فوتر جديد لأكاديمية أفنان */
      .afnan-footer {
    background: #000000;
    color: #ffffff;
    text-align: center;
    padding: 15px 20px;
    font-family: 'Cairo', 'Tajawal', sans-serif;
    font-size: 0.8rem;
    border-top: 2px solid #333333;
    letter-spacing: 0.1px;
    margin: 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
    line-height: 1.6;
    position: relative;
    bottom: 0;
    width: 100%;
    z-index: 1000;
  }
    @media (max-width: 600px) {
      .afnan-logo {
        width: 100vw !important;
        max-width: 100vw !important;
        height: 60px !important;
        max-height: 60px !important;
        object-fit: contain !important;
        display: block;
        margin: 0 auto !important;
      }
      .afnan-header-inner {
        height: 60px !important;
        min-height: 60px !important;
      }
    }
    .afnan-footer .footer-hadith {
      color: #ffffff;
      font-size: 1.1rem;
      margin-bottom: 10px;
      margin-top: 8px;
      display: block;
      font-weight: bold;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      line-height: 1.6;
      padding: 0 15px;
      font-family: 'Amiri', 'Cairo', serif;
    }
    .afnan-footer .footer-ayah-img {
      display: block;
      margin: 8px auto 8px auto;
      max-width: 120px;
      width: 45vw;
      height: auto;
      filter: drop-shadow(0 2px 5px rgba(189,151,80,0.2));
      opacity: 0.95;
    }
    .afnan-footer .footer-narrator {
      color: #ffffff;
      font-size: 0.75rem;
      margin-bottom: 6px;
      margin-top: 3px;
      line-height: 1.3;
      opacity: 0.9;
      font-weight: 500;
    }
    .afnan-footer .footer-copyright {
      color: #ffffff;
      font-size: 0.7rem;
      margin-top: 8px;
      margin-bottom: 5px;
      opacity: 0.8;
      line-height: 1.3;
      font-style: italic;
      padding: 0 10px;
    }
    @media (max-width: 600px) {
      .afnan-footer {
        font-size: 0.75rem;
        padding: 12px 15px;
        z-index: 1000;
        margin-bottom: 70px;
      }
      .afnan-footer .footer-hadith {
        font-size: 1rem;
        margin-bottom: 8px;
        margin-top: 5px;
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }
      .afnan-footer .footer-narrator {
        font-size: 0.7rem;
        margin-bottom: 5px;
      }
      .afnan-footer .footer-copyright {
        font-size: 0.65rem;
        margin-top: 6px;
      }
      .afnan-footer .footer-ayah-img {
        max-width: 60vw;
        opacity: 0.9;
        margin: 6px auto;
      }
    }
  </style>
  <style>
  .afnan-footer .footer-ayah-img {
    display: block;
    margin: 2px auto 2px auto;
    max-width: 150px;
    width: 55vw;
    height: auto;
    filter: drop-shadow(0 1px 3px rgba(189,151,80,0.1));
    opacity: 0.9;
  }
  
  /* ضمان ظهور الفوتر فوق شريط التنقل */
  .afnan-footer {
    position: relative;
    z-index: 1000;
    margin-bottom: 60px; /* مساحة لشريط التنقل */
    background: linear-gradient(135deg, rgba(255, 245, 220, 0.8), rgba(255, 240, 200, 0.6));
    backdrop-filter: blur(5px);
  }
  
  /* إخفاء شريط التنقل إذا كان موجود */
  .bottom-nav,
  .navigation-bar,
  .nav-bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 999;
    background: white;
    border-top: 1px solid #e0e0e0;
  }
  
  /* ضمان عدم تداخل العناصر */
  .main-container {
    padding-bottom: 80px; /* مساحة إضافية في الأسفل */
  }
  
  /* ضمان عدم تداخل العناصر */
  .main-container {
    padding-bottom: 80px; /* مساحة إضافية في الأسفل */
  }
  
  /* تحسين موضع الفوتر */
  .afnan-footer {
    position: relative;
    z-index: 1000;
    background: linear-gradient(135deg, rgba(255, 245, 220, 0.8), rgba(255, 240, 200, 0.6));
    backdrop-filter: blur(5px);
  }
  
  /* وصف الأكاديمية - تصميم محسن مع المصحف والمسجد */
  .afnan-academy-desc {
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 25px 30px;
    background: linear-gradient(135deg, #fffbe6 0%, #f7ecd6 50%, #fff3cd 100%);
    /* إضافة المصحف كخلفية */
    background-image:
      linear-gradient(135deg, #fffbe6 0%, #f7ecd6 50%, #fff3cd 100%),
      url('2.png');
    background-repeat: no-repeat, no-repeat;
    background-size: cover, 220px auto;
    background-position: center, center right 10%;
    background-blend-mode: lighten, normal;
    color: #8B4513;
    border: 2px solid #BD9750;
    border-radius: 15px;
    font-size: 1.2rem;
    font-weight: 600;
    text-align: center;
    line-height: 1.8;
    box-shadow: 
      0 4px 15px rgba(189, 151, 80, 0.15),
      0 2px 8px rgba(139, 69, 19, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    word-break: break-word;
    position: relative;
    z-index: 10;
    margin-top: 85px;
    margin-bottom: 25px;
    font-family: 'Cairo', 'Tajawal', sans-serif;
    overflow: hidden;
  }
  
  /* إضافة تأثيرات بصرية */
  .afnan-academy-desc::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.8s ease;
  }
  
  .afnan-academy-desc:hover::before {
    left: 100%;
  }
  
  .afnan-academy-desc:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 8px 25px rgba(189, 151, 80, 0.25),
      0 4px 15px rgba(139, 69, 19, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
    border-color: #e6a700;
  }
  
  /* إزالة الأيقونة القديمة */
  .afnan-academy-desc::after {
    display: none !important;
  }
  
  /* أيقونة المسجد */
  .academy-mosque-icon {
    position: absolute;
    left: 18px;
    bottom: 14px;
    width: 48px;
    height: 48px;
    opacity: 0.92;
    z-index: 2;
    filter: drop-shadow(0 2px 6px rgba(139,69,19,0.10));
    transition: all 0.3s ease;
  }
  
  .academy-mosque-icon:hover {
    opacity: 1;
    transform: scale(1.05);
  }
  
  /* إضافة تأثيرات إضافية */
  .afnan-academy-desc {
    position: relative;
    background-image: 
      radial-gradient(circle at 20% 80%, rgba(189, 151, 80, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
  }
  
  /* تحسين تأثيرات التفاعل */
  .academy-desc-circle:hover {
    transform: scale(1.05) translateY(-1px);
    box-shadow: 0 4px 12px rgba(189, 151, 80, 0.4);
  }
  
  .academy-desc-subject:hover {
    background: rgba(189, 151, 80, 0.15);
    border-color: rgba(189, 151, 80, 0.5);
    transform: translateY(-1px);
  }
  
  .academy-desc-level:hover {
    transform: scale(1.05);
    box-shadow: 0 3px 10px rgba(139, 69, 19, 0.4);
  }
  
  /* إضافة تأثيرات انتقالية سلسة */
  .academy-desc-content > * {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* تحسين قابلية القراءة */
  .academy-desc-title {
    letter-spacing: 0.5px;
  }
  
  .academy-desc-prayer {
    position: relative;
  }
  
  .academy-desc-prayer::before {
    content: 'ﷺ';
    position: absolute;
    right: -15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8em;
    opacity: 0.6;
  }
  
  /* إضافة تأثير نبض للأيقونة */
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  .afnan-academy-desc:hover::after {
    animation: pulse 1s ease-in-out infinite;
  }
  
  /* إضافة تأثيرات إضافية للعناصر */
  .academy-desc-circle {
    position: relative;
    overflow: hidden;
  }
  
  .academy-desc-circle::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }
  
  .academy-desc-circle:hover::before {
    left: 100%;
  }
  
  /* تحسين تأثيرات الظل */
  .academy-desc-level {
    position: relative;
  }
  
  .academy-desc-level::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 2px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 1px;
  }
  
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة */
  @media (max-width: 600px) {
    .academy-desc-circle:hover {
      transform: scale(1.03) translateY(-1px);
    }
    
    .academy-desc-subject:hover {
      transform: translateY(-1px);
    }
    
    .academy-desc-level:hover {
      transform: scale(1.03);
    }
  }
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .academy-desc-circle:hover {
      transform: scale(1.02) translateY(-1px);
    }
    
    .academy-desc-level:hover {
      transform: scale(1.02);
    }
  }
  
  /* إضافة تأثيرات إضافية للعناصر */
  .academy-desc-batch {
    position: relative;
    overflow: hidden;
  }
  
  .academy-desc-batch::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(139, 69, 19, 0.1), transparent);
    transition: left 0.6s ease;
  }
  
  .academy-desc-batch:hover::before {
    left: 100%;
  }
  
  .academy-desc-batch:hover {
    background: rgba(139, 69, 19, 0.12);
    border-color: rgba(139, 69, 19, 0.3);
    transform: translateY(-1px);
  }
  
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة */
  @media (max-width: 600px) {
    .academy-desc-batch:hover {
      transform: translateY(-1px);
    }
  }
  
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .academy-desc-batch:hover {
      transform: translateY(-1px);
    }
  }
  
  /* إضافة تأثيرات إضافية للعناصر */
  .academy-desc-subject {
    position: relative;
    overflow: hidden;
  }
  
  .academy-desc-subject::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(189, 151, 80, 0.2), transparent);
    transition: left 0.6s ease;
  }
  
  .academy-desc-subject:hover::before {
    left: 100%;
  }
  
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة */
  @media (max-width: 600px) {
    .academy-desc-subject:hover {
      transform: translateY(-1px);
    }
  }
  
  /* تحسين تأثيرات التفاعل للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .academy-desc-subject:hover {
      transform: translateY(-1px);
    }
  }
  
  /* إضافة تأثيرات إضافية للعناصر */
  .academy-desc-level {
    position: relative;
    overflow: hidden;
  }
  
  .academy-desc-level::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }
  
  .academy-desc-level:hover::before {
    left: 100%;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
  }
  
  /* تنسيق محتوى وصف الأكاديمية */
  .academy-desc-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }
  
  .academy-desc-main {
    margin-bottom: 5px;
  }
  
  .academy-desc-title {
    font-size: 1.3em;
    font-weight: 700;
    color: #8B4513;
    text-shadow: 0 1px 2px rgba(139, 69, 19, 0.1);
    display: block;
    margin-bottom: 8px;
  }
  
  .academy-desc-details {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 8px;
    align-items: center;
  }
  
  .academy-desc-circle {
    background: linear-gradient(135deg, #BD9750, #e6a700);
    color: white;
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 0.95em;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(189, 151, 80, 0.3);
    transition: all 0.3s ease;
  }
  
  .academy-desc-circle:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(189, 151, 80, 0.4);
  }
  
  .academy-desc-prayer {
    color: #8B4513;
    font-size: 0.9em;
    font-weight: 500;
    font-style: italic;
    opacity: 0.9;
  }
  
  .academy-desc-subject {
    background: rgba(189, 151, 80, 0.1);
    color: #8B4513;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.9em;
    font-weight: 600;
    border: 1px solid rgba(189, 151, 80, 0.3);
  }
  
  .academy-desc-students {
    background: rgba(139, 69, 19, 0.08);
    color: #8B4513;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.85em;
    font-weight: 500;
    border: 1px solid rgba(139, 69, 19, 0.2);
  }
  
  .academy-desc-batch {
    background: rgba(139, 69, 19, 0.08);
    color: #8B4513;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.85em;
    font-weight: 500;
    border: 1px solid rgba(139, 69, 19, 0.2);
  }
  
  .academy-desc-level {
    background: linear-gradient(135deg, #8B4513, #a0522d);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.85em;
    font-weight: 600;
    box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);
  }
  
  @media (max-width: 900px) {
    .afnan-academy-desc {
      font-size: 1.1rem;
      padding: 20px 25px;
      margin-top: 80px;
      margin-bottom: 22px;
      border-radius: 12px;
      background-size: cover, 180px auto;
      background-position: center, center right 8%;
    }
    
    .academy-mosque-icon {
      width: 40px;
      height: 40px;
      left: 15px;
      bottom: 12px;
    }
    
    .academy-desc-title {
      font-size: 1.2em;
    }
    
    .academy-desc-details {
      gap: 10px;
    }
    
    .academy-desc-circle {
      font-size: 0.9em;
      padding: 5px 12px;
    }
    
    .academy-desc-subject {
      font-size: 0.85em;
      padding: 3px 10px;
    }
    
    .academy-desc-students {
      gap: 8px;
    }
    
    .academy-desc-batch,
    .academy-desc-level {
      font-size: 0.8em;
      padding: 3px 8px;
    }
    
    .academy-desc-prayer::before {
      right: -12px;
      font-size: 0.7em;
    }
  }
  
  @media (max-width: 600px) {
    .afnan-academy-desc {
      font-size: 1rem;
      padding: 18px 20px;
      border-radius: 10px;
      margin-top: 75px;
      margin-bottom: 20px;
      line-height: 1.6;
      background-size: cover, 120px auto;
      background-position: center, center right 2%;
    }
    
    .academy-mosque-icon {
      width: 32px;
      height: 32px;
      left: 8px;
      bottom: 8px;
    }
    
    .academy-desc-title {
      font-size: 1.1em;
    }
    
    .academy-desc-details {
      gap: 8px;
      flex-direction: column;
    }
    
    .academy-desc-circle {
      font-size: 0.85em;
      padding: 4px 10px;
    }
    
    .academy-desc-subject {
      font-size: 0.8em;
      padding: 3px 8px;
    }
    
    .academy-desc-students {
      gap: 6px;
      flex-direction: column;
    }
    
    .academy-desc-batch,
    .academy-desc-level {
      font-size: 0.75em;
      padding: 3px 6px;
    }
    
    .academy-desc-prayer::before {
      right: -10px;
      font-size: 0.65em;
    }
  }
  
  @media (max-width: 480px) {
    .afnan-academy-desc {
      font-size: 0.95rem;
      padding: 15px 18px;
      margin-top: 70px;
      margin-bottom: 18px;
      line-height: 1.5;
      border-radius: 8px;
      background-size: cover, 80px auto;
      background-position: center, center right 1%;
    }
    
    .academy-mosque-icon {
      width: 28px;
      height: 28px;
      left: 6px;
      bottom: 6px;
    }
    
    .academy-desc-title {
      font-size: 1em;
    }
    
    .academy-desc-details {
      gap: 6px;
      flex-direction: column;
    }
    
    .academy-desc-circle {
      font-size: 0.8em;
      padding: 3px 8px;
    }
    
    .academy-desc-subject {
      font-size: 0.75em;
      padding: 2px 6px;
    }
    
    .academy-desc-students {
      gap: 4px;
      flex-direction: column;
    }
    
    .academy-desc-batch,
    .academy-desc-level {
      font-size: 0.7em;
      padding: 2px 5px;
    }
    
    .academy-desc-prayer::before {
      right: -8px;
      font-size: 0.6em;
    }
    
    /* تحسينات إضافية للشاشات الصغيرة جداً */
    @media (max-width: 360px) {
      .afnan-academy-desc {
        padding: 12px 15px;
        font-size: 0.9rem;
        margin-top: 65px;
        margin-bottom: 15px;
        border-radius: 6px;
      }
      
      .academy-desc-title {
        font-size: 0.95em;
      }
      
      .academy-desc-details {
        gap: 4px;
      }
      
      .academy-desc-circle {
        font-size: 0.75em;
        padding: 2px 6px;
      }
      
      .academy-desc-subject {
        font-size: 0.7em;
        padding: 2px 5px;
      }
      
      .academy-desc-students {
        gap: 3px;
      }
      
      .academy-desc-batch,
      .academy-desc-level {
        font-size: 0.65em;
        padding: 2px 4px;
      }
      
      .afnan-academy-desc::after {
        font-size: 1rem;
        top: 6px;
        right: 8px;
      }
      
      .academy-desc-prayer::before {
        right: -6px;
        font-size: 0.55em;
      }
    }
  }
  </style>

  <!-- إضافة CSS للرسائل -->
  <style>
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }


      
/* تحسين القائمة المنسدلة للواجبات */
.dropdown-menu-homework {
  min-width: 210px !important;
  max-width: 260px;
  background: #fffdfa;
  border: none;
  border-radius: 13px;
  box-shadow: 0 8px 32px rgba(139,111,47,0.13);
  padding: 7px 0;
  margin: 0;
  list-style: none;
  z-index: 1001;
  overflow: hidden;
  direction: rtl;
  position: absolute;
  top: 110%;
  right: 50%;
  transform: translateX(50%);
}
.dropdown-item-homework {
  display: block;
  padding: 9px 18px 9px 8px;
  color: #8B6F2F !important;
  font-family: 'Tajawal', 'Cairo', Arial, sans-serif;
  font-weight: 600;
  font-size: 0.93rem;
  text-decoration: none;
  text-align: right;
  background: none;
  border: none;
  white-space: normal;
  overflow: visible;
  text-overflow: unset;
  line-height: 1.5;
  transition: background 0.18s, color 0.18s;
  cursor: pointer;
  border-radius: 6px;
  margin: 0 6px;
}
.dropdown-item-homework:hover,
.dropdown-item-homework:focus {
  background: #f7ecd6;
  color: #BD9750 !important;
}
#homeworkDropdownBtn span {
  color: #8B6F2F;
  margin-right: 4px;
  font-size: 1em;
  vertical-align: middle;
}

.mobile-homework-submenu {
  background: #f9f7f2;
  border-radius: 0 0 10px 10px;
  box-shadow: 0 2px 8px rgba(139,111,47,0.07);
  margin-top: -2px;
  
}
.mobile-homework-submenu a {
  color: #8B6F2F !important;
  font-family: 'Tajawal', 'Cairo', Arial, sans-serif;
  font-weight: 600;
  font-size: 1rem;
  padding: 10px 18px 10px 0;
  background: none;
  border: none;
  border-bottom: 1px solid #f5f5f5;
  text-align: right;
  display: block;
  transition: background 0.18s, color 0.18s;
}
.mobile-homework-submenu a:last-child {
  border-bottom: none;
}
.mobile-homework-submenu a:hover {
  background: #f7ecd6;
  color: #BD9750 !important;
}
.mobile-side-menu-list {
  max-height: 85vh;
  overflow-y: auto;
  overscroll-behavior: contain;
}

  </style>
</head>
<body>
  <div class="main-container">
    <!-- ====== الهيدر الجديد ====== -->
    <header class="afnan-header-fixed">
      <div class="afnan-header-inner">
        <img src="logo-afnan.png" alt="Afnan Academy Logo" class="afnan-logo" />
        <nav class="afnan-navbar">
          <ul class="afnan-nav-list">
            <li><a href="index.html" class="afnan-nav-link">الصفحة الرئيسية</a></li>
            <li><a href="#" class="afnan-nav-link disabled-link">أكاديمية أفنان</a></li>
            <li><a href="#" class="afnan-nav-link disabled-link">حلقات التجويد</a></li>
            <li class="homework-dropdown">
              <button id="homeworkDropdownBtn" class="afnan-nav-link homework-btn">
                الواجبات <i class="fas fa-chevron-down"></i>
              </button>
              <ul class="dropdown-menu-homework" id="homeworkDropdown">
                <li><button class="dropdown-item-homework" onclick="showHomeworkLevel('level2-batch1')">المستوى الثاني الدُفعة الأولى</button></li>
                <li><button class="dropdown-item-homework" onclick="showHomeworkLevel('level1-batch2')">المستوى الأول الدُفعة الثانية</button></li>
                <li><button class="dropdown-item-homework" onclick="showHomeworkLevel('level1-batch3')">المستوى الأول الدُفعة الثالثة</button></li>
              </ul>
            </li>
            <li><button id="langToggleBtn" class="lang-btn" style="font-weight:bold;">EN</button></li>
          </ul>
        </nav>
      </div>
    </header>
    <div class="header-gap"></div>
    <!-- ====== نهاية الهيدر ====== -->

    <!-- وصف الأكاديمية أعلى التبويبات -->
    <div class="afnan-academy-desc" id="academyDescBox">
      <div class="academy-desc-content">
        <div class="academy-desc-main">
          <div class="academy-desc-title">نظام تسجيل حضور وانصراف</div>
          <div class="academy-desc-details">
            <div class="academy-desc-circle">حلقة الشيخة نظيرة ودن</div>
            <div class="academy-desc-prayer">حفظها الله</div>
            <div class="academy-desc-subject">تجويد أفنان</div>
            <div class="academy-desc-students">طالبات الدُفعة الأولى</div>
            <div class="academy-desc-level">المستوى الثاني</div>
          </div>
        </div>
      </div>
      <!-- أيقونة المسجد في الأسفل يسار -->
      <img src="logo-afnan.png" alt="مسجد" class="academy-mosque-icon" />
    </div>



    <div class="form-container">
      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('student')">تسجيل الطالبة</button>
        <button class="tab-btn" onclick="showTab('admin')">الإدارة</button>
      </div>

      <!-- قسم تسجيل الطالبة -->
      <div id="studentSection" class="form-section active">
        <h2 class="form-title">تسجيل الحضور / الانصراف</h2>
        
        <div class="time-info">
          <div class="time-section">
            <h4>مواعيد تسجيل الحضور:</h4>
            <div><span id="attendanceTimes">06:00 - 08:00</span></div>
          </div>
          <div class="time-section">
            <h4>مواعيد تسجيل الانصراف:</h4>
            <div><span id="departureTimes">08:00 - 10:00</span></div>
          </div>
          <div id="timeStatus" style="margin-top: 10px; font-weight: bold; text-align: center;">❌ التسجيل مغلق الآن</div>
        </div>

        <div class="form-group">
          <label for="studentName" class="form-label">اسم الطالبة:</label>
          <input type="text" id="studentName" class="form-input" placeholder="التسجيل مغلق - انتظر موعد التسجيل" disabled>
          
          <script>
          // تفعيل حقل اسم الطالبة
          document.addEventListener('DOMContentLoaded', function() {
            const studentNameInput = document.getElementById('studentName');
            if (studentNameInput) {
              studentNameInput.disabled = true;
              studentNameInput.placeholder = 'التسجيل مغلق - انتظر موعد التسجيل';
              studentNameInput.style.backgroundColor = '#f5f5f5';
              studentNameInput.style.color = '#999';
            }
          });
          </script>
        </div>

        <div class="btn-row registration-buttons">
          <button type="button" id="checkInBtn" class="form-btn gold-btn" disabled>تسجيل الحضور</button>
          <button type="button" id="checkOutBtn" class="form-btn green-btn" disabled>تسجيل الانصراف</button>
        </div>

        <div id="studentMessage" class="message" style="display: none;"></div>
        
        <!-- قسم ملخص الحلقة للطلاب -->
        <div class="session-summary-section" id="studentSessionSummary" style="display: none;">
          <div class="summary-header">
            <h2 class="summary-title">ملخص الحلقة</h2>
            <div class="summary-info">
              <div class="summary-field" id="summaryAttendanceField">حضور</div>
              <div class="summary-field" id="summaryDateField">السبت، ١٢ يوليو ٢٠٢٥</div>
              <div class="summary-field" id="summaryLectureField">المحاضرة الرابعة عشر</div>
              <div class="summary-field" id="summaryTitleField">ورشة العمل الاولى في المخارج (1)</div>
            </div>
            <div class="summary-form-link" id="summaryFormLink">لائحة الاستمارة رقم (1)</div>
          </div>
          
          <!-- جدول الطالبات -->
          <div class="students-table-container">
            <table class="students-table" id="studentsSummaryTable">
              <thead>
                <tr>
                  <th class="student-name-header">اسم الطالبة</th>
                  <th class="attendance-status-header">حضور+انصراف</th>
                </tr>
              </thead>
              <tbody id="studentsSummaryTableBody">
                <!-- ستظهر أسماء الطالبات هنا -->
              </tbody>
            </table>
          </div>
          
          <!-- التنبيهات والملاحظات -->
          <div class="session-warnings" id="sessionWarningsSection">
            <h3>تنبيهات وملاحظات</h3>
            <div class="warnings-content" id="warningsContent">
              <!-- ستظهر التنبيهات هنا -->
            </div>
          </div>
          
          <!-- زر تصدير PDF (للإدارة فقط) -->
          <div class="export-section" id="adminExportSection" style="display: none;">
            <button type="button" id="exportSummaryPDFBtn" class="export-pdf-btn" onclick="exportSummaryPDF()">
              <i class="fas fa-file-pdf"></i>
              تصدير الملخص PDF
            </button>
          </div>
        </div>
        
        <script>
        // تفعيل أزرار تسجيل الحضور والانصراف للطلاب
        document.addEventListener('DOMContentLoaded', function() {
          const checkInBtn = document.getElementById('checkInBtn');
          const checkOutBtn = document.getElementById('checkOutBtn');
          const studentNameInput = document.getElementById('studentName');
          
          if (checkInBtn) {
            checkInBtn.addEventListener('click', function() {
              const studentName = studentNameInput.value.trim();
              
              if (!studentName) {
                showToast('يرجى إدخال اسم الطالبة', 'error');
                return;
              }
              
              // التحقق من أن تسجيل الحضور مفتوح
              const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
              if (!attendanceOpen) {
                showToast('تسجيل الحضور مغلق حالياً', 'warning');
                return;
              }
              
              // تسجيل الحضور
              const attendance = {
                studentName: studentName,
                type: 'checkIn',
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('ar-SA')
              };
              
              // حفظ في LocalStorage
              let attendances = [];
              try {
                const savedAttendances = localStorage.getItem('afnan_attendances');
                attendances = savedAttendances ? JSON.parse(savedAttendances) : [];
              } catch(e) {
                attendances = [];
              }
              
              attendances.push(attendance);
              localStorage.setItem('afnan_attendances', JSON.stringify(attendances));
              
              // مسح الحقل
              studentNameInput.value = '';
              
              showToast(`تم تسجيل حضور ${studentName} بنجاح`, 'success');
              
              // إظهار قسم ملخص الحلقة وتحديث الجدول
              showSessionSummary();
            });
          }
          
          if (checkOutBtn) {
            checkOutBtn.addEventListener('click', function() {
              const studentName = studentNameInput.value.trim();
              
              if (!studentName) {
                showToast('يرجى إدخال اسم الطالبة', 'error');
                return;
              }
              
              // التحقق من أن تسجيل الانصراف مفتوح
              const departureOpen = localStorage.getItem('departureOpen') === 'true';
              if (!departureOpen) {
                showToast('تسجيل الانصراف مغلق حالياً', 'warning');
                return;
              }
              
              // تسجيل الانصراف
              const departure = {
                studentName: studentName,
                type: 'checkOut',
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('ar-SA')
              };
              
              // حفظ في LocalStorage
              let departures = [];
              try {
                const savedDepartures = localStorage.getItem('afnan_departures');
                departures = savedDepartures ? JSON.parse(savedDepartures) : [];
              } catch(e) {
                departures = [];
              }
              
              departures.push(departure);
              localStorage.setItem('afnan_departures', JSON.stringify(departures));
              
              // مسح الحقل
              studentNameInput.value = '';
              
              showToast(`تم تسجيل انصراف ${studentName} بنجاح`, 'success');
              
              // إظهار قسم ملخص الحلقة وتحديث الجدول
              showSessionSummary();
            });
          }
          
          // تحديث حالة الأزرار عند تحميل الصفحة
          updateAttendanceStatus();
          
          // تحديث المواعيد والحالة عند تحميل الصفحة
          setTimeout(() => {
            updateAttendanceStatus();
          }, 200);
          
          // تحديث حقل اسم الطالبة عند تحميل الصفحة
          setTimeout(() => {
            const studentNameInput = document.getElementById('studentName');
            if (studentNameInput) {
              const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
              const departureOpen = localStorage.getItem('departureOpen') === 'true';
              
              if (attendanceOpen || departureOpen) {
                studentNameInput.disabled = false;
                studentNameInput.placeholder = 'أدخلي اسمك الكامل';
                studentNameInput.style.backgroundColor = '#ffffff';
                studentNameInput.style.color = '#333';
                studentNameInput.style.borderColor = '#BD9750';
              } else {
                studentNameInput.disabled = true;
                studentNameInput.placeholder = 'التسجيل مغلق - انتظر موعد التسجيل';
                studentNameInput.style.backgroundColor = '#f5f5f5';
                studentNameInput.style.color = '#999';
                studentNameInput.style.borderColor = '#ddd';
                studentNameInput.value = '';
              }
            }
          }, 300);
        });
        </script>

        <!-- قسم ملخص الحلقة للطلاب (يظهر فقط إذا تم تفعيله من الإدارة) -->
        <div id="studentSummarySection" style="display:none; margin-bottom: 30px;">
          <div class="form-container" style="background: #fffbe6; border: 1.5px solid #BD9750;">
            <h2 class="form-title" style="color:#BD9750;">ملخص الحلقة</h2>
            <div id="studentSummaryContent"></div>
            <div id="studentNamesTable"></div>
            <div id="studentWarningsSection" style="display:none; margin-top: 15px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; opacity: 0.8;">
              <h4 style="color: #856404; margin-bottom: 10px;">تنبيهات وملاحظات:</h4>
              <div id="studentWarningsContent">لا توجد تنبيهات حالياً</div>
            </div>
            <div id="studentSessionHistorySection" style="display:none; margin-top: 15px;">
              <h4 style="color: #BD9750; margin-bottom: 10px;">ملخصات الحلقات السابقة:</h4>
              <select id="studentSessionHistorySelect" class="form-input" style="margin-bottom: 10px;">
                <option value="">اختر ملخص لعرضه</option>
              </select>
              <div id="studentSessionHistoryPreview"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- قسم الإدارة -->
      <div id="adminSection" class="form-section">
        <h2 class="form-title">دخول الإدارة</h2>
        
        <div class="form-group">
          <label for="adminUser" class="form-label">اسم المستخدم:</label>
          <input type="text" id="adminUser" class="form-input" placeholder="اسم المستخدم">
        </div>

        <div class="form-group">
          <label for="adminPass" class="form-label">كلمة المرور:</label>
          <input type="password" id="adminPass" class="form-input" placeholder="كلمة المرور">
        </div>

        <button type="button" id="adminLoginBtn" class="form-btn gold-btn">دخول</button>
        <div id="adminMessage" class="message" style="display: none;"></div>
        
        <script>
        // تفعيل زر تسجيل دخول الإدارة
        document.addEventListener('DOMContentLoaded', function() {
          const adminLoginBtn = document.getElementById('adminLoginBtn');
          if (adminLoginBtn) {
            adminLoginBtn.addEventListener('click', function() {
              const username = document.getElementById('adminUser').value.trim();
              const password = document.getElementById('adminPass').value.trim();
              const messageDiv = document.getElementById('adminMessage');
              
              if (!username || !password) {
                messageDiv.textContent = 'يرجى إدخال اسم المستخدم وكلمة المرور';
                messageDiv.style.color = '#dc3545';
                messageDiv.style.display = 'block';
                return;
              }
              
              // تحميل المشرفين
              loadAdmins();
              
              // التحقق من بيانات الدخول
              const foundAdmin = window.admins.find(admin => 
                admin.username === username && admin.password === password
              );
              
              if (foundAdmin) {
                messageDiv.textContent = 'تم تسجيل الدخول بنجاح!';
                messageDiv.style.color = '#28a745';
                messageDiv.style.display = 'block';
                
                // إخفاء نموذج تسجيل الدخول وإظهار لوحة الإدارة
                setTimeout(() => {
                  document.getElementById('adminSection').style.display = 'none';
                  document.getElementById('adminPanel').style.display = 'block';
                  messageDiv.style.display = 'none';
                  
                  // تحميل البيانات وعرض القوائم
                  loadStudents();
                  loadCustomColumns();
                  loadSchedules();
                  loadSessionSummaries();
                  renderStudentsList();
                  renderAdminsList();
                  renderCustomColumnsList();
                  renderSchedulesList();
                  renderSessionSummariesList();
                  
                  // تحميل البيانات المحفوظة
                  loadAdminData();
                  
                  // تحديث حالة التسجيل والمواعيد
                  updateAttendanceStatus();
                  
                  // تحديث حقل اسم الطالبة
                  setTimeout(() => {
                    const studentNameInput = document.getElementById('studentName');
                    if (studentNameInput) {
                      const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
                      const departureOpen = localStorage.getItem('departureOpen') === 'true';
                      
                      if (attendanceOpen || departureOpen) {
                        studentNameInput.disabled = false;
                        studentNameInput.placeholder = 'أدخلي اسمك الكامل';
                        studentNameInput.style.backgroundColor = '#ffffff';
                        studentNameInput.style.color = '#333';
                        studentNameInput.style.borderColor = '#BD9750';
                      } else {
                        studentNameInput.disabled = true;
                        studentNameInput.placeholder = 'التسجيل مغلق - انتظر موعد التسجيل';
                        studentNameInput.style.backgroundColor = '#f5f5f5';
                        studentNameInput.style.color = '#999';
                        studentNameInput.style.borderColor = '#ddd';
                        studentNameInput.value = '';
                      }
                    }
                  }, 100);
                  
                        // تطبيق إعدادات وصف الأكاديمية
      setTimeout(() => {
        applyAcademyDescSettings();
      }, 200);
      
              // إظهار قسم ملخص الحلقة إذا كان مفعلاً
        setTimeout(() => {
          const summaryVisible = localStorage.getItem('summaryVisibleToStudents') === 'true';
          if (summaryVisible) {
            showSessionSummary();
          }
          
          // إظهار قسم ملخص الحلقة للإدارة إذا كان مفعلاً
          const adminSummaryVisible = localStorage.getItem('summaryVisibleToAdmin') === 'true';
          if (adminSummaryVisible) {
            showAdminSessionSummary();
          }
          
          // إظهار زر تصدير PDF للإدارة
          const showExportPDF = localStorage.getItem('showExportPDFBtn') === 'true';
          const exportSection = document.getElementById('adminExportSection');
          if (exportSection && showExportPDF) {
            exportSection.style.display = 'block';
          }
        }, 500);
                  
                  showToast('مرحباً بك في لوحة الإدارة', 'success');
                }, 1000);
              } else {
                messageDiv.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
                messageDiv.style.color = '#dc3545';
                messageDiv.style.display = 'block';
              }
            });
          }
        });
        </script>


      </div>
    </div>
    <!-- لوحة الإدارة (تظهر بعد تسجيل الدخول) -->
    <div id="adminPanel" class="admin-panel" style="display: none;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="form-title">لوحة الإدارة</h2>
        <button type="button" id="logoutBtn" class="admin-btn red-btn" style="padding: 8px 15px; font-size: 0.9rem; min-height: 35px;">تسجيل الخروج</button>
      </div>
      
      <script>
      // تفعيل زر تسجيل الخروج
      document.addEventListener('DOMContentLoaded', function() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
              document.getElementById('adminPanel').style.display = 'none';
              document.getElementById('adminSection').style.display = 'block';
              
              // مسح حقول تسجيل الدخول
              document.getElementById('adminUser').value = '';
              document.getElementById('adminPass').value = '';
              document.getElementById('adminMessage').style.display = 'none';
              
              showToast('تم تسجيل الخروج بنجاح', 'info');
            }
          });
        }
      });
      
      // تحميل البيانات عند فتح لوحة الإدارة
      function loadAdminData() {
        // تحميل وصف الأكاديمية
        const desc = localStorage.getItem('academyDescText') || 'نظام تسجيل حضور وانصراف حلقة الشيخة نظيرة ودن- حفظها الله - تجويد أفنان طالبات الدُفعة الأولى المستوى الثاني';
        const bg = localStorage.getItem('academyDescBg') || '#f5f5f5';
        const color = localStorage.getItem('academyDescColor') || '#3b2e13';
        const font = localStorage.getItem('academyDescFont') || "'Cairo', sans-serif";
        const size = localStorage.getItem('academyDescSize') || '1rem';
        const weight = localStorage.getItem('academyDescWeight') || '400';
        const padding = localStorage.getItem('academyDescPadding') || '15px';
        const radius = localStorage.getItem('academyDescRadius') || '10px';
        const shadow = localStorage.getItem('academyDescShadow') || '0 2px 4px rgba(0,0,0,0.1)';
        
        if (document.getElementById('academyDescInput')) {
          document.getElementById('academyDescInput').value = desc;
          document.getElementById('academyDescBgColor').value = bg;
          document.getElementById('academyDescTextColor').value = color;
          document.getElementById('academyDescFont').value = font;
          document.getElementById('academyDescSize').value = size;
          document.getElementById('academyDescWeight').value = weight;
          document.getElementById('academyDescPadding').value = padding;
          document.getElementById('academyDescRadius').value = radius;
          document.getElementById('academyDescShadow').value = shadow;
        }
        
        // تحميل إعدادات حقول ملخص الحلقة
        loadSummaryFieldsSettings();
        
        // تحميل إعدادات عرض ملخص الحلقة
        loadSummaryDisplaySettings();
        loadSummaryAdminSettings();
        
        // إضافة مستمعي الأحداث لتحديث الجدول عند تغيير نوع القائمة
        document.addEventListener('DOMContentLoaded', function() {
          const summaryNamesType = document.getElementById('summaryNamesType');
          const summaryNamesTypeAdmin = document.getElementById('summaryNamesTypeAdmin');
          
          if (summaryNamesType) {
            summaryNamesType.addEventListener('change', function() {
              updateSessionSummaryTable();
            });
          }
          
          if (summaryNamesTypeAdmin) {
            summaryNamesTypeAdmin.addEventListener('change', function() {
              updateAdminSessionSummaryTable();
            });
          }
        });
        
        // دالة تحميل إعدادات حقول ملخص الحلقة
        function loadSummaryFieldsSettings() {
          const settings = JSON.parse(localStorage.getItem('summaryFieldsSettings') || '{}');
          
          const fieldRows = document.querySelectorAll('.summary-field-row');
          
          fieldRows.forEach((row) => {
            const label = row.querySelector('.field-label').textContent.replace(':', '');
            let fieldName = '';
            
            if (label.includes('حضور')) fieldName = 'attendance';
            else if (label.includes('اليوم والتاريخ')) fieldName = 'date';
            else if (label.includes('رقم المحاضرة')) fieldName = 'lecture';
            else if (label.includes('عنوان الحلقة')) fieldName = 'title';
            else if (label.includes('خانة إضافية')) fieldName = 'extra';
            
            if (fieldName && settings[fieldName]) {
              const setting = settings[fieldName];
              row.querySelector('.field-text').value = setting.text || '';
              row.querySelector('.field-font').value = setting.font || "'Cairo', sans-serif";
              row.querySelector('.field-size').value = setting.size || '1rem';
              row.querySelector('.field-color').value = setting.color || '#2c3e50';
              row.querySelector('.field-weight').value = setting.weight || '400';
            }
          });
          
          // تطبيق المعاينة
          setTimeout(() => {
            applySummaryFieldsPreview();
          }, 100);
        }
        
        // تحميل المواعيد
        const attendanceStart = localStorage.getItem('attendanceStart') || '06:00';
        const attendanceEnd = localStorage.getItem('attendanceEnd') || '08:00';
        const departureStart = localStorage.getItem('departureStart') || '08:00';
        const departureEnd = localStorage.getItem('departureEnd') || '10:00';
        
        if (document.getElementById('attendanceStart')) document.getElementById('attendanceStart').value = attendanceStart;
        if (document.getElementById('attendanceEnd')) document.getElementById('attendanceEnd').value = attendanceEnd;
        if (document.getElementById('departureStart')) document.getElementById('departureStart').value = departureStart;
        if (document.getElementById('departureEnd')) document.getElementById('departureEnd').value = departureEnd;
        
        // تحميل بيانات الواجبات
        loadHomeworkData();
      }
      </script>
      <div class="admin-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;">
        <button type="button" id="openCheckInManual" class="admin-btn gold-btn" onclick="openCheckIn()">فتح تسجيل الحضور</button>
        <button type="button" id="closeCheckInManual" class="admin-btn red-btn" onclick="closeCheckIn()">إغلاق تسجيل الحضور</button>
        <button type="button" id="openCheckOutManual" class="admin-btn green-btn" onclick="openCheckOut()">فتح تسجيل الانصراف</button>
        <button type="button" id="closeCheckOutManual" class="admin-btn red-btn" onclick="closeCheckOut()">إغلاق تسجيل الانصراف</button>
      </div>
      
      <script>
      // دوال تفعيل الحضور والانصراف
      function openCheckIn() {
        localStorage.setItem('attendanceOpen', 'true');
        showToast('تم فتح تسجيل الحضور', 'success');
        updateAttendanceStatus();
        console.log('تم فتح تسجيل الحضور');
      }
      
      function closeCheckIn() {
        localStorage.setItem('attendanceOpen', 'false');
        showToast('تم إغلاق تسجيل الحضور', 'warning');
        updateAttendanceStatus();
        console.log('تم إغلاق تسجيل الحضور');
      }
      
      function openCheckOut() {
        localStorage.setItem('departureOpen', 'true');
        showToast('تم فتح تسجيل الانصراف', 'success');
        updateAttendanceStatus();
        console.log('تم فتح تسجيل الانصراف');
      }
      
      function closeCheckOut() {
        localStorage.setItem('departureOpen', 'false');
        showToast('تم إغلاق تسجيل الانصراف', 'warning');
        updateAttendanceStatus();
        console.log('تم إغلاق تسجيل الانصراف');
      }
      </script>
      
      <!-- إدارة المواعيد -->
      <div class="admin-section">
        <h3>إدارة مواعيد التسجيل</h3>
        <div class="time-settings">
          <div class="time-group">
            <h4>مواعيد تسجيل الحضور</h4>
            <div class="time-inputs">
              <input type="time" id="attendanceStart" class="time-input" value="06:00">
              <span>إلى</span>
              <input type="time" id="attendanceEnd" class="time-input" value="08:00">
            </div>
          </div>
          <div class="time-group">
            <h4>مواعيد تسجيل الانصراف</h4>
            <div class="time-inputs">
              <input type="time" id="departureStart" class="time-input" value="08:00">
              <span>إلى</span>
              <input type="time" id="departureEnd" class="time-input" value="10:00">
            </div>
          </div>
        </div>
        <button type="button" id="saveTimesBtn" class="admin-btn blue-btn" onclick="saveTimes()" style="margin-top: 15px;">حفظ المواعيد</button>
      </div>
      
      <script>
      // دالة حفظ المواعيد
      function saveTimes() {
        const attendanceStart = document.getElementById('attendanceStart').value;
        const attendanceEnd = document.getElementById('attendanceEnd').value;
        const departureStart = document.getElementById('departureStart').value;
        const departureEnd = document.getElementById('departureEnd').value;
        
        localStorage.setItem('attendanceStart', attendanceStart);
        localStorage.setItem('attendanceEnd', attendanceEnd);
        localStorage.setItem('departureStart', departureStart);
        localStorage.setItem('departureEnd', departureEnd);
        
        showToast('تم حفظ المواعيد بنجاح', 'success');
        updateAttendanceStatus();
        console.log('تم حفظ المواعيد:', { attendanceStart, attendanceEnd, departureStart, departureEnd });
      }
      </script>
      
      <!-- إعدادات وصف الأكاديمية -->
      <div class="admin-section academy-desc-settings">
        <h3>إعدادات وصف الأكاديمية</h3>
        <div class="form-group">
          <label for="academyDescInput" class="form-label">نص الوصف:</label>
          <textarea id="academyDescInput" class="form-input" rows="3" placeholder="أدخل وصف الأكاديمية هنا..."></textarea>
        </div>
        <div class="form-group">
          <label for="academyDescFont" class="form-label">نوع الخط:</label>
          <select id="academyDescFont" class="form-input">
            <option value="'Cairo', sans-serif">Cairo (عادي)</option>
            <option value="'Amiri', serif">Amiri (كلاسيكي)</option>
            <option value="'Tajawal', sans-serif">Tajawal (حديث)</option>
            <option value="'Almarai', sans-serif">Almarai (أنيق)</option>
            <option value="'Reem Kufi', sans-serif">Reem Kufi (فني)</option>
            <option value="'Aref Ruqaa', serif">Aref Ruqaa (تقليدي)</option>
            <option value="'Noto Naskh Arabic', serif">Noto Naskh (واضح)</option>
            <option value="'Scheherazade New', serif">Scheherazade (جميل)</option>
          </select>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="academyDescSize" class="form-label">حجم الخط:</label>
            <select id="academyDescSize" class="form-input">
              <option value="0.9rem">صغير</option>
              <option value="1rem" selected>متوسط</option>
              <option value="1.1rem">كبير</option>
              <option value="1.2rem">كبير جداً</option>
            </select>
          </div>
          <div class="form-group">
            <label for="academyDescWeight" class="form-label">سمك الخط:</label>
            <select id="academyDescWeight" class="form-input">
              <option value="300">خفيف</option>
              <option value="400" selected>عادي</option>
              <option value="600">متوسط</option>
              <option value="700">عريض</option>
              <option value="800">عريض جداً</option>
            </select>
          </div>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="academyDescBgColor" class="form-label">لون خلفية المربع:</label>
            <input type="color" id="academyDescBgColor" class="form-input" value="#f5f5f5" style="width:100%; height:40px; padding:0; border-radius: 6px;">
          </div>
          <div class="form-group">
            <label for="academyDescTextColor" class="form-label">لون الخط:</label>
            <input type="color" id="academyDescTextColor" class="form-input" value="#3b2e13" style="width:100%; height:40px; padding:0; border-radius: 6px;">
          </div>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="academyDescPadding" class="form-label">المساحة الداخلية:</label>
            <select id="academyDescPadding" class="form-input">
              <option value="10px">صغيرة</option>
              <option value="15px" selected>متوسطة</option>
              <option value="20px">كبيرة</option>
              <option value="25px">كبيرة جداً</option>
            </select>
          </div>
          <div class="form-group">
            <label for="academyDescRadius" class="form-label">استدارة الزوايا:</label>
            <select id="academyDescRadius" class="form-input">
              <option value="0px">بدون</option>
              <option value="5px">خفيفة</option>
              <option value="10px" selected>متوسطة</option>
              <option value="15px">كبيرة</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="academyDescShadow" class="form-label">ظل المربع:</label>
          <select id="academyDescShadow" class="form-input">
            <option value="none">بدون ظل</option>
            <option value="0 2px 4px rgba(0,0,0,0.1)" selected>خفيف</option>
            <option value="0 4px 8px rgba(0,0,0,0.15)">متوسط</option>
            <option value="0 6px 12px rgba(0,0,0,0.2)">كبير</option>
          </select>
        </div>
        <button type="button" id="saveAcademyDescBtn" class="admin-btn gold-btn" onclick="saveAcademyDesc()">حفظ التعديلات</button>
      </div>
      
      <script>
      // دالة حفظ وصف الأكاديمية
      function saveAcademyDesc() {
        const desc = document.getElementById('academyDescInput').value.trim() || 'نظام تسجيل الحضور والانصراف لأكاديمية أفنان لتعليم القرآن وعلومه';
        const bg = document.getElementById('academyDescBgColor').value;
        const color = document.getElementById('academyDescTextColor').value;
        const font = document.getElementById('academyDescFont').value;
        const size = document.getElementById('academyDescSize').value;
        const weight = document.getElementById('academyDescWeight').value;
        const padding = document.getElementById('academyDescPadding').value;
        const radius = document.getElementById('academyDescRadius').value;
        const shadow = document.getElementById('academyDescShadow').value;
        
        localStorage.setItem('academyDescText', desc);
        localStorage.setItem('academyDescBg', bg);
        localStorage.setItem('academyDescColor', color);
        localStorage.setItem('academyDescFont', font);
        localStorage.setItem('academyDescSize', size);
        localStorage.setItem('academyDescWeight', weight);
        localStorage.setItem('academyDescPadding', padding);
        localStorage.setItem('academyDescRadius', radius);
        localStorage.setItem('academyDescShadow', shadow);
        
        // تحديث الوصف في الصفحة
        const descBox = document.getElementById('academyDescBox');
        if(descBox) {
          descBox.textContent = desc;
          descBox.style.background = bg;
          descBox.style.color = color;
          descBox.style.fontFamily = font;
          descBox.style.fontSize = size;
          descBox.style.fontWeight = weight;
          descBox.style.padding = padding;
          descBox.style.borderRadius = radius;
          descBox.style.boxShadow = shadow;
        }
        
        showToast('تم حفظ إعدادات وصف الأكاديمية بنجاح', 'success');
        console.log('تم حفظ وصف الأكاديمية:', { desc, bg, color, font, size, weight, padding, radius, shadow });
        
        // تطبيق الإعدادات فوراً
        applyAcademyDescSettings();
      }
      
      // دالة حفظ إعدادات حقول ملخص الحلقة
      function saveSummaryFields() {
        const summarySettings = {};
        
        // جمع إعدادات كل حقل
        const fieldRows = document.querySelectorAll('.summary-field-row');
        
        fieldRows.forEach((row, index) => {
          const label = row.querySelector('.field-label').textContent.replace(':', '');
          const text = row.querySelector('.field-text').value;
          const font = row.querySelector('.field-font').value;
          const size = row.querySelector('.field-size').value;
          const color = row.querySelector('.field-color').value;
          const weight = row.querySelector('.field-weight').value;
          
          // تحديد اسم الحقل بناءً على التسمية
          let fieldName = '';
          if (label.includes('حضور')) fieldName = 'attendance';
          else if (label.includes('اليوم والتاريخ')) fieldName = 'date';
          else if (label.includes('رقم المحاضرة')) fieldName = 'lecture';
          else if (label.includes('عنوان الحلقة')) fieldName = 'title';
          else if (label.includes('خانة إضافية')) fieldName = 'extra';
          
          if (fieldName) {
            summarySettings[fieldName] = { text, font, size, color, weight };
          }
        });
        
        localStorage.setItem('summaryFieldsSettings', JSON.stringify(summarySettings));
        
        // تطبيق الإعدادات على المعاينة
        applySummaryFieldsPreview();
        
        showToast('تم حفظ إعدادات حقول ملخص الحلقة بنجاح', 'success');
        console.log('تم حفظ إعدادات الحقول:', summarySettings);
      }
      
      // دالة تطبيق معاينة حقول ملخص الحلقة
      function applySummaryFieldsPreview() {
        const settings = JSON.parse(localStorage.getItem('summaryFieldsSettings') || '{}');
        
        const previews = {
          attendance: document.getElementById('previewAttendance'),
          date: document.getElementById('previewDate'),
          lecture: document.getElementById('previewLecture'),
          title: document.getElementById('previewTitle'),
          extra: document.getElementById('previewExtra')
        };
        
        Object.keys(previews).forEach(key => {
          const preview = previews[key];
          const setting = settings[key];
          
          if (preview && setting) {
            preview.textContent = setting.text;
            preview.style.fontFamily = setting.font;
            preview.style.fontSize = setting.size;
            preview.style.color = setting.color;
            preview.style.fontWeight = setting.weight;
          }
        });
      }
      
                    // تطبيق الإعدادات عند تحميل الصفحة
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
          applySummaryFieldsPreview();
        }, 1000);
        
        // إظهار قسم ملخص الحلقة للطلاب إذا كان مفعلاً
        setTimeout(() => {
          const summaryVisible = localStorage.getItem('summaryVisibleToStudents') === 'true';
          if (summaryVisible) {
            showSessionSummary();
          }
        }, 1500);
      });
        // دالة حفظ إعدادات عرض ملخص الحلقة للطلاب
        function saveSummaryDisplaySettings() {
          const visibleToStudents = document.getElementById('summaryVisibleToStudents').value;
          const namesType = document.getElementById('summaryNamesType').value;
          const studentColumns = document.getElementById('studentSummaryColumns').value;
          const warnings = document.getElementById('sessionWarnings').value;
          const showWarnings = document.getElementById('showWarningsToStudents').value;
          const showHistory = document.getElementById('showSessionHistoryToStudents').value;
          
          localStorage.setItem('summaryVisibleToStudents', visibleToStudents);
          localStorage.setItem('summaryNamesType', namesType);
          localStorage.setItem('studentSummaryColumns', studentColumns);
          localStorage.setItem('sessionWarnings', warnings);
          localStorage.setItem('showWarningsToStudents', showWarnings);
          localStorage.setItem('showSessionHistoryToStudents', showHistory);
          
          showToast('تم حفظ إعدادات عرض ملخص الحلقة للطلاب بنجاح', 'success');
          console.log('تم حفظ إعدادات العرض للطلاب:', { visibleToStudents, namesType, studentColumns, warnings, showWarnings, showHistory });
        }
        
        // دالة حفظ إعدادات عرض ملخص الحلقة للإدارة
        function saveSummaryAdminSettings() {
          const visibleToAdmin = document.getElementById('summaryVisibleToAdmin').value;
          const namesTypeAdmin = document.getElementById('summaryNamesTypeAdmin').value;
          const adminColumns = document.getElementById('adminSummaryColumns').value;
          const showWarningsAdmin = document.getElementById('showWarningsToAdmin').value;
          const showExportPDF = document.getElementById('showExportPDFBtn').value;
          
          localStorage.setItem('summaryVisibleToAdmin', visibleToAdmin);
          localStorage.setItem('summaryNamesTypeAdmin', namesTypeAdmin);
          localStorage.setItem('adminSummaryColumns', adminColumns);
          localStorage.setItem('showWarningsToAdmin', showWarningsAdmin);
          localStorage.setItem('showExportPDFBtn', showExportPDF);
          
          showToast('تم حفظ إعدادات عرض ملخص الحلقة للإدارة بنجاح', 'success');
          console.log('تم حفظ إعدادات العرض للإدارة:', { visibleToAdmin, namesTypeAdmin, adminColumns, showWarningsAdmin, showExportPDF });
        }
        
        // دالة تحميل إعدادات العرض للطلاب
        function loadSummaryDisplaySettings() {
          const visibleToStudents = localStorage.getItem('summaryVisibleToStudents') || 'false';
          const namesType = localStorage.getItem('summaryNamesType') || 'all';
          const studentColumns = localStorage.getItem('studentSummaryColumns') || 'name';
          const warnings = localStorage.getItem('sessionWarnings') || '';
          const showWarnings = localStorage.getItem('showWarningsToStudents') || 'true';
          const showHistory = localStorage.getItem('showSessionHistoryToStudents') || 'false';
          
          if (document.getElementById('summaryVisibleToStudents')) {
            document.getElementById('summaryVisibleToStudents').value = visibleToStudents;
            document.getElementById('summaryNamesType').value = namesType;
            document.getElementById('studentSummaryColumns').value = studentColumns;
            document.getElementById('sessionWarnings').value = warnings;
            document.getElementById('showWarningsToStudents').value = showWarnings;
            document.getElementById('showSessionHistoryToStudents').value = showHistory;
          }
        }
        
        // دالة تحميل إعدادات العرض للإدارة
        function loadSummaryAdminSettings() {
          const visibleToAdmin = localStorage.getItem('summaryVisibleToAdmin') || 'true';
          const namesTypeAdmin = localStorage.getItem('summaryNamesTypeAdmin') || 'all';
          const adminColumns = localStorage.getItem('adminSummaryColumns') || 'name-both';
          const showWarningsAdmin = localStorage.getItem('showWarningsToAdmin') || 'true';
          const showExportPDF = localStorage.getItem('showExportPDFBtn') || 'true';
          
          if (document.getElementById('summaryVisibleToAdmin')) {
            document.getElementById('summaryVisibleToAdmin').value = visibleToAdmin;
            document.getElementById('summaryNamesTypeAdmin').value = namesTypeAdmin;
            document.getElementById('adminSummaryColumns').value = adminColumns;
            document.getElementById('showWarningsToAdmin').value = showWarningsAdmin;
            document.getElementById('showExportPDFBtn').value = showExportPDF;
          }
        }
        
        // دالة إظهار قسم ملخص الحلقة للطلاب
        function showSessionSummary() {
          const summarySection = document.getElementById('studentSessionSummary');
          const summaryVisible = localStorage.getItem('summaryVisibleToStudents') === 'true';
          const showWarnings = localStorage.getItem('showWarningsToStudents') === 'true';
          const showHistory = localStorage.getItem('showSessionHistoryToStudents') === 'true';
          
          if (summaryVisible && summarySection) {
            summarySection.style.display = 'block';
            updateSessionSummaryTable();
            
            // إظهار/إخفاء التنبيهات حسب الإعداد
            const warningsSection = document.getElementById('sessionWarningsSection');
            if (warningsSection) {
              warningsSection.style.display = showWarnings ? 'block' : 'none';
            }
            
            // إخفاء زر تصدير PDF للطلاب
            const exportSection = document.getElementById('adminExportSection');
            if (exportSection) {
              exportSection.style.display = 'none';
            }
            
            updateSessionWarnings();
            applySummaryFieldsToStudentView();
          }
        }
        
        // دالة إظهار قسم ملخص الحلقة للإدارة
        function showAdminSessionSummary() {
          const summarySection = document.getElementById('studentSessionSummary');
          const summaryVisible = localStorage.getItem('summaryVisibleToAdmin') === 'true';
          const showWarnings = localStorage.getItem('showWarningsToAdmin') === 'true';
          const showExportPDF = localStorage.getItem('showExportPDFBtn') === 'true';
          
          if (summaryVisible && summarySection) {
            summarySection.style.display = 'block';
            updateAdminSessionSummaryTable();
            
            // إظهار/إخفاء التنبيهات حسب الإعداد
            const warningsSection = document.getElementById('sessionWarningsSection');
            if (warningsSection) {
              warningsSection.style.display = showWarnings ? 'block' : 'none';
            }
            
            // إظهار/إخفاء زر تصدير PDF حسب الإعداد
            const exportSection = document.getElementById('adminExportSection');
            if (exportSection) {
              exportSection.style.display = showExportPDF ? 'block' : 'none';
            }
            
            updateSessionWarnings();
            applySummaryFieldsToStudentView();
          }
        }
        
        // دالة تحديث جدول ملخص الحلقة للطلاب
        function updateSessionSummaryTable() {
          const tableBody = document.getElementById('studentsSummaryTableBody');
          if (!tableBody) return;
          
          // جمع بيانات الحضور والانصراف
          const attendances = JSON.parse(localStorage.getItem('afnan_attendances') || '[]');
          const departures = JSON.parse(localStorage.getItem('afnan_departures') || '[]');
          
          // تجميع الطالبات وحالاتهم مع التفاصيل
          const studentsMap = new Map();
          
          // إضافة الحضور
          attendances.forEach(att => {
            if (!studentsMap.has(att.studentName)) {
              studentsMap.set(att.studentName, { 
                name: att.studentName, 
                hasAttendance: true, 
                hasDeparture: false,
                attendanceTime: new Date(att.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                attendanceDate: att.date
              });
            } else {
              studentsMap.get(att.studentName).hasAttendance = true;
              studentsMap.get(att.studentName).attendanceTime = new Date(att.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
              studentsMap.get(att.studentName).attendanceDate = att.date;
            }
          });
          
          // إضافة الانصراف
          departures.forEach(dep => {
            if (!studentsMap.has(dep.studentName)) {
              studentsMap.set(dep.studentName, { 
                name: dep.studentName, 
                hasAttendance: false, 
                hasDeparture: true,
                departureTime: new Date(dep.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                departureDate: dep.date
              });
            } else {
              studentsMap.get(dep.studentName).hasDeparture = true;
              studentsMap.get(dep.studentName).departureTime = new Date(dep.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
              studentsMap.get(dep.studentName).departureDate = dep.date;
            }
          });
          
          // الحصول على نوع القائمة المطلوب
          const namesType = localStorage.getItem('summaryNamesType') || 'all';
          const studentColumns = localStorage.getItem('studentSummaryColumns') || 'name';
          
          // تحديث رؤوس الجدول حسب الإعدادات
          updateTableHeaders(studentColumns);
          
          // إنشاء صفوف الجدول
          tableBody.innerHTML = '';
          studentsMap.forEach(student => {
            let shouldShow = true;
            
            // تطبيق فلتر نوع القائمة
            if (namesType === 'attendanceOnly' && !student.hasAttendance) {
              shouldShow = false;
            } else if (namesType === 'departureOnly' && !student.hasDeparture) {
              shouldShow = false;
            } else if (namesType === 'noRecord' && (student.hasAttendance || student.hasDeparture)) {
              shouldShow = false;
            }
            
            if (shouldShow) {
              const row = document.createElement('tr');
              
              // إضافة خلية اسم الطالبة
              const nameCell = document.createElement('td');
              nameCell.textContent = student.name;
              nameCell.title = student.name; // إضافة title للاسم الكامل
              row.appendChild(nameCell);
              
              // إضافة الأعمدة حسب الإعدادات
              switch(studentColumns) {
                case 'name':
                  // اسم الطالبة فقط - لا نحتاج أعمدة إضافية
                  break;
                  
                case 'name-type':
                  const typeCell = document.createElement('td');
              if (student.hasAttendance && student.hasDeparture) {
                    typeCell.textContent = 'حضور + انصراف';
                  } else if (student.hasAttendance) {
                    typeCell.textContent = 'حضور فقط';
                  } else if (student.hasDeparture) {
                    typeCell.textContent = 'انصراف فقط';
              } else {
                    typeCell.textContent = 'بدون سجل';
                  }
                  row.appendChild(typeCell);
                  break;
                  
                case 'name-attendance':
                  const attendanceCell = document.createElement('td');
                  if (student.hasAttendance) {
                    attendanceCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  row.appendChild(attendanceCell);
                  break;
                  
                case 'name-departure':
                  const departureCell = document.createElement('td');
                  if (student.hasDeparture) {
                    departureCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  row.appendChild(departureCell);
                  break;
                  
                case 'name-both':
                  const attendanceBothCell = document.createElement('td');
                  const departureBothCell = document.createElement('td');
                  
                  if (student.hasAttendance) {
                    attendanceBothCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceBothCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  if (student.hasDeparture) {
                    departureBothCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureBothCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  row.appendChild(attendanceBothCell);
                  row.appendChild(departureBothCell);
                  break;
                  
                case 'all':
                  const typeAllCell = document.createElement('td');
                  const attendanceAllCell = document.createElement('td');
                  const departureAllCell = document.createElement('td');
                  const timeAllCell = document.createElement('td');
                  
                  if (student.hasAttendance && student.hasDeparture) {
                    typeAllCell.textContent = 'حضور + انصراف';
                  } else if (student.hasAttendance) {
                    typeAllCell.textContent = 'حضور فقط';
                  } else if (student.hasDeparture) {
                    typeAllCell.textContent = 'انصراف فقط';
                  } else {
                    typeAllCell.textContent = 'بدون سجل';
                  }
                  
                  if (student.hasAttendance) {
                    attendanceAllCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceAllCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  if (student.hasDeparture) {
                    departureAllCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureAllCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  // عرض الوقت إذا كان متوفراً
                  if (student.attendanceTime && student.departureTime) {
                    timeAllCell.textContent = `${student.attendanceTime} - ${student.departureTime}`;
                  } else if (student.attendanceTime) {
                    timeAllCell.textContent = `حضور: ${student.attendanceTime}`;
                  } else if (student.departureTime) {
                    timeAllCell.textContent = `انصراف: ${student.departureTime}`;
                  } else {
                    timeAllCell.textContent = '-';
                  }
                  
                  row.appendChild(typeAllCell);
                  row.appendChild(attendanceAllCell);
                  row.appendChild(departureAllCell);
                  row.appendChild(timeAllCell);
                  break;
              }
              
              tableBody.appendChild(row);
            }
          });
        }
        
        // دالة تحديث جدول ملخص الحلقة للإدارة
        function updateAdminSessionSummaryTable() {
          const tableBody = document.getElementById('studentsSummaryTableBody');
          if (!tableBody) return;
          
          // جمع بيانات الحضور والانصراف
          const attendances = JSON.parse(localStorage.getItem('afnan_attendances') || '[]');
          const departures = JSON.parse(localStorage.getItem('afnan_departures') || '[]');
          
          // تجميع الطالبات وحالاتهم مع التفاصيل
          const studentsMap = new Map();
          
          // إضافة الحضور
          attendances.forEach(att => {
            if (!studentsMap.has(att.studentName)) {
              studentsMap.set(att.studentName, { 
                name: att.studentName, 
                hasAttendance: true, 
                hasDeparture: false,
                attendanceTime: new Date(att.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                attendanceDate: att.date
              });
            } else {
              studentsMap.get(att.studentName).hasAttendance = true;
              studentsMap.get(att.studentName).attendanceTime = new Date(att.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
              studentsMap.get(att.studentName).attendanceDate = att.date;
            }
          });
          
          // إضافة الانصراف
          departures.forEach(dep => {
            if (!studentsMap.has(dep.studentName)) {
              studentsMap.set(dep.studentName, { 
                name: dep.studentName, 
                hasAttendance: false, 
                hasDeparture: true,
                departureTime: new Date(dep.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                departureDate: dep.date
              });
            } else {
              studentsMap.get(dep.studentName).hasDeparture = true;
              studentsMap.get(dep.studentName).departureTime = new Date(dep.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
              studentsMap.get(dep.studentName).departureDate = dep.date;
            }
          });
          
          // الحصول على نوع القائمة المطلوب للإدارة
          const namesTypeAdmin = localStorage.getItem('summaryNamesTypeAdmin') || 'all';
          const adminColumns = localStorage.getItem('adminSummaryColumns') || 'name-both';
          
          // تحديث رؤوس الجدول حسب الإعدادات
          updateTableHeaders(adminColumns);
          
          // إنشاء صفوف الجدول للإدارة
          tableBody.innerHTML = '';
          studentsMap.forEach(student => {
            let shouldShow = true;
            
            // تطبيق فلتر نوع القائمة للإدارة
            if (namesTypeAdmin === 'attendanceOnly' && !student.hasAttendance) {
              shouldShow = false;
            } else if (namesTypeAdmin === 'departureOnly' && !student.hasDeparture) {
              shouldShow = false;
            } else if (namesTypeAdmin === 'noRecord' && (student.hasAttendance || student.hasDeparture)) {
              shouldShow = false;
            }
            
            if (shouldShow) {
              const row = document.createElement('tr');
              
              // إضافة خلية اسم الطالبة
              const nameCell = document.createElement('td');
              nameCell.textContent = student.name;
              nameCell.title = student.name; // إضافة title للاسم الكامل
              row.appendChild(nameCell);
              
              // إضافة الأعمدة حسب الإعدادات
              switch(adminColumns) {
                case 'name':
                  // اسم الطالبة فقط - لا نحتاج أعمدة إضافية
                  break;
                  
                case 'name-type':
                  const typeCell = document.createElement('td');
              if (student.hasAttendance && student.hasDeparture) {
                    typeCell.textContent = 'حضور + انصراف';
                  } else if (student.hasAttendance) {
                    typeCell.textContent = 'حضور فقط';
                  } else if (student.hasDeparture) {
                    typeCell.textContent = 'انصراف فقط';
              } else {
                    typeCell.textContent = 'بدون سجل';
                  }
                  row.appendChild(typeCell);
                  break;
                  
                case 'name-attendance':
                  const attendanceCell = document.createElement('td');
                  if (student.hasAttendance) {
                    attendanceCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  row.appendChild(attendanceCell);
                  break;
                  
                case 'name-departure':
                  const departureCell = document.createElement('td');
                  if (student.hasDeparture) {
                    departureCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  row.appendChild(departureCell);
                  break;
                  
                case 'name-both':
                  const attendanceBothCell = document.createElement('td');
                  const departureBothCell = document.createElement('td');
                  
                  if (student.hasAttendance) {
                    attendanceBothCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceBothCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  if (student.hasDeparture) {
                    departureBothCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureBothCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  row.appendChild(attendanceBothCell);
                  row.appendChild(departureBothCell);
                  break;
                  
                case 'all':
                  const typeAllCell = document.createElement('td');
                  const attendanceAllCell = document.createElement('td');
                  const departureAllCell = document.createElement('td');
                  const timeAllCell = document.createElement('td');
                  
                  if (student.hasAttendance && student.hasDeparture) {
                    typeAllCell.textContent = 'حضور + انصراف';
                  } else if (student.hasAttendance) {
                    typeAllCell.textContent = 'حضور فقط';
                  } else if (student.hasDeparture) {
                    typeAllCell.textContent = 'انصراف فقط';
                  } else {
                    typeAllCell.textContent = 'بدون سجل';
                  }
                  
                  if (student.hasAttendance) {
                    attendanceAllCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    attendanceAllCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  if (student.hasDeparture) {
                    departureAllCell.innerHTML = '<span class="status-check">✓</span>';
                  } else {
                    departureAllCell.innerHTML = '<span class="status-cross">✗</span>';
                  }
                  
                  // عرض الوقت إذا كان متوفراً
                  if (student.attendanceTime && student.departureTime) {
                    timeAllCell.textContent = `${student.attendanceTime} - ${student.departureTime}`;
                  } else if (student.attendanceTime) {
                    timeAllCell.textContent = `حضور: ${student.attendanceTime}`;
                  } else if (student.departureTime) {
                    timeAllCell.textContent = `انصراف: ${student.departureTime}`;
                  } else {
                    timeAllCell.textContent = '-';
                  }
                  
                  row.appendChild(typeAllCell);
                  row.appendChild(attendanceAllCell);
                  row.appendChild(departureAllCell);
                  row.appendChild(timeAllCell);
                  break;
              }
              
              tableBody.appendChild(row);
            }
          });
        }
        
        // دالة تحديث رؤوس الجدول حسب إعدادات الأعمدة
        function updateTableHeaders(columnsType) {
          const tableHead = document.querySelector('#studentsSummaryTable thead tr');
          if (!tableHead) return;
          
          // مسح الرؤوس الحالية
          tableHead.innerHTML = '';
          
          // إضافة رأس اسم الطالبة دائماً
          const nameHeader = document.createElement('th');
          nameHeader.textContent = 'اسم الطالبة';
          nameHeader.className = 'student-name-header';
          tableHead.appendChild(nameHeader);
          
          // إضافة الرؤوس حسب نوع الأعمدة
          switch(columnsType) {
            case 'name':
              // اسم الطالبة فقط - لا نحتاج رؤوس إضافية
              break;
              
            case 'name-type':
              const typeHeader = document.createElement('th');
              typeHeader.textContent = 'النوع';
              typeHeader.className = 'attendance-type-header';
              tableHead.appendChild(typeHeader);
              break;
              
            case 'name-attendance':
              const attendanceHeader = document.createElement('th');
              attendanceHeader.textContent = 'حضور';
              attendanceHeader.className = 'attendance-status-header';
              tableHead.appendChild(attendanceHeader);
              break;
              
            case 'name-departure':
              const departureHeader = document.createElement('th');
              departureHeader.textContent = 'انصراف';
              departureHeader.className = 'departure-status-header';
              tableHead.appendChild(departureHeader);
              break;
              
            case 'name-both':
              const attendanceBothHeader = document.createElement('th');
              attendanceBothHeader.textContent = 'حضور';
              attendanceBothHeader.className = 'attendance-status-header';
              tableHead.appendChild(attendanceBothHeader);
              
              const departureBothHeader = document.createElement('th');
              departureBothHeader.textContent = 'انصراف';
              departureBothHeader.className = 'departure-status-header';
              tableHead.appendChild(departureBothHeader);
              break;
              
            case 'all':
              const typeAllHeader = document.createElement('th');
              typeAllHeader.textContent = 'النوع';
              typeAllHeader.className = 'attendance-type-header';
              tableHead.appendChild(typeAllHeader);
              
              const attendanceAllHeader = document.createElement('th');
              attendanceAllHeader.textContent = 'حضور';
              attendanceAllHeader.className = 'attendance-status-header';
              tableHead.appendChild(attendanceAllHeader);
              
              const departureAllHeader = document.createElement('th');
              departureAllHeader.textContent = 'انصراف';
              departureAllHeader.className = 'departure-status-header';
              tableHead.appendChild(departureAllHeader);
              
              const timeAllHeader = document.createElement('th');
              timeAllHeader.textContent = 'الوقت';
              timeAllHeader.className = 'time-header';
              tableHead.appendChild(timeAllHeader);
              break;
          }
        }
        
        // دالة تحديث التنبيهات والملاحظات
        function updateSessionWarnings() {
          const warningsContent = document.getElementById('warningsContent');
          if (!warningsContent) return;
          
          const warnings = localStorage.getItem('sessionWarnings') || 'لا توجد تنبيهات حالياً';
          warningsContent.innerHTML = warnings;
        }
        
        // دالة تطبيق إعدادات الحقول على عرض الطلاب
        function applySummaryFieldsToStudentView() {
          const settings = JSON.parse(localStorage.getItem('summaryFieldsSettings') || '{}');
          
          const fields = {
            attendance: document.getElementById('summaryAttendanceField'),
            date: document.getElementById('summaryDateField'),
            lecture: document.getElementById('summaryLectureField'),
            title: document.getElementById('summaryTitleField')
          };
          
          Object.keys(fields).forEach(key => {
            const field = fields[key];
            const setting = settings[key];
            
            if (field && setting) {
              field.textContent = setting.text;
              field.style.fontFamily = setting.font;
              field.style.fontSize = setting.size;
              field.style.color = setting.color;
              field.style.fontWeight = setting.weight;
            }
          });
        }
        // دالة تصدير PDF
        function exportSummaryPDF() {
          const summarySection = document.getElementById('studentSessionSummary');
          if (!summarySection) return;
          
          // إنشاء محتوى PDF
          const pdfContent = `
            <html dir="rtl">
              <head>
                <style>
                  body { font-family: 'Cairo', sans-serif; margin: 20px; }
                  .header { text-align: center; margin-bottom: 30px; }
                  .title { color: #BD9750; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
                  .info { display: flex; justify-content: space-around; margin-bottom: 30px; }
                  .field { background: #f8f9fa; padding: 10px; border-radius: 5px; }
                  table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                  th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
                  th { background: #BD9750; color: white; }
                  .warnings { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; }
                </style>
              </head>
              <body>
                <div class="header">
                  <div class="title">ملخص الحلقة</div>
                  <div class="info">
                    <div class="field">${document.getElementById('summaryAttendanceField')?.textContent || 'حضور'}</div>
                    <div class="field">${document.getElementById('summaryDateField')?.textContent || 'التاريخ'}</div>
                    <div class="field">${document.getElementById('summaryLectureField')?.textContent || 'المحاضرة'}</div>
                    <div class="field">${document.getElementById('summaryTitleField')?.textContent || 'العنوان'}</div>
                  </div>
                </div>
                
                <table>
                  <thead>
                    <tr>
                      <th>اسم الطالبة</th>
                      <th>حضور+انصراف</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${document.getElementById('studentsSummaryTableBody')?.innerHTML || ''}
                  </tbody>
                </table>
                
                <div class="warnings">
                  <h3>تنبيهات وملاحظات</h3>
                  <div>${document.getElementById('warningsContent')?.innerHTML || 'لا توجد تنبيهات'}</div>
                </div>
              </body>
            </html>
          `;
          
          // إنشاء PDF (باستخدام jsPDF أو window.print)
          const printWindow = window.open('', '_blank');
          printWindow.document.write(pdfContent);
          printWindow.document.close();
          printWindow.print();
        }
        
        // إضافة مستمعي الأحداث للتحديث الفوري للمعاينة
        document.addEventListener('DOMContentLoaded', function() {
          // تحسين تجربة الجدول على الهاتف
          setupTableMobileExperience();
          setTimeout(() => {
            const fieldInputs = document.querySelectorAll('.field-text, .field-font, .field-size, .field-color, .field-weight');
            fieldInputs.forEach(input => {
              input.addEventListener('input', function() {
                setTimeout(() => {
                  applySummaryFieldsPreview();
                }, 50);
              });
            });
            
            // إضافة مستمعي الأحداث لتحديث الجدول عند تغيير إعدادات الأعمدة
            const studentColumnsSelect = document.getElementById('studentSummaryColumns');
            if (studentColumnsSelect) {
              studentColumnsSelect.addEventListener('change', function() {
                setTimeout(() => {
                  updateSessionSummaryTable();
                }, 100);
              });
            }
            
            const adminColumnsSelect = document.getElementById('adminSummaryColumns');
            if (adminColumnsSelect) {
              adminColumnsSelect.addEventListener('change', function() {
                setTimeout(() => {
                  updateAdminSessionSummaryTable();
                }, 100);
              });
            }
          }, 1500);
        });
        
        // دالة لإنشاء بيانات تجريبية لاختبار الأعمدة الجديدة
        function createTestData() {
          const testAttendances = [
            {
              studentName: 'فاطمة أحمد محمد',
              type: 'checkIn',
              timestamp: new Date('2024-12-20T06:30:00').toISOString(),
              date: '2024-12-20'
            },
            {
              studentName: 'عائشة علي حسن',
              type: 'checkIn',
              timestamp: new Date('2024-12-20T06:45:00').toISOString(),
              date: '2024-12-20'
            },
            {
              studentName: 'خديجة محمد عبدالله',
              type: 'checkIn',
              timestamp: new Date('2024-12-20T07:00:00').toISOString(),
              date: '2024-12-20'
            }
          ];
          
          const testDepartures = [
            {
              studentName: 'فاطمة أحمد محمد',
              type: 'checkOut',
              timestamp: new Date('2024-12-20T08:30:00').toISOString(),
              date: '2024-12-20'
            },
            {
              studentName: 'عائشة علي حسن',
              type: 'checkOut',
              timestamp: new Date('2024-12-20T08:45:00').toISOString(),
              date: '2024-12-20'
            }
          ];
          
          localStorage.setItem('afnan_attendances', JSON.stringify(testAttendances));
          localStorage.setItem('afnan_departures', JSON.stringify(testDepartures));
          
          showToast('تم إنشاء بيانات تجريبية بنجاح', 'success');
          
          // تحديث الجدول
          setTimeout(() => {
            updateSessionSummaryTable();
            updateAdminSessionSummaryTable();
          }, 500);
        }
        
        // دالة تحسين تجربة الجدول على الهاتف
        function setupTableMobileExperience() {
          const tableContainer = document.querySelector('.students-table-container');
          if (!tableContainer) return;
          
          // إضافة مؤشر للتمرير الأفقي
          let isScrolling = false;
          let startX = 0;
          let scrollLeft = 0;
          
          tableContainer.addEventListener('touchstart', function(e) {
            isScrolling = true;
            startX = e.touches[0].pageX - tableContainer.offsetLeft;
            scrollLeft = tableContainer.scrollLeft;
          });
          
          tableContainer.addEventListener('touchmove', function(e) {
            if (!isScrolling) return;
            e.preventDefault();
            const x = e.touches[0].pageX - tableContainer.offsetLeft;
            const walk = (x - startX) * 2;
            tableContainer.scrollLeft = scrollLeft - walk;
          });
          
          tableContainer.addEventListener('touchend', function() {
            isScrolling = false;
          });
          
          // إضافة تأثير بصري عند التمرير
          tableContainer.addEventListener('scroll', function() {
            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
            setTimeout(() => {
              this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.05)';
            }, 200);
          });
        }
      </script>
      
      <!-- اختبار الأعمدة الجديدة -->
      <div class="admin-section">
        <h3>اختبار الأعمدة الجديدة</h3>
        <div class="form-group">
          <button type="button" onclick="createTestData()" class="form-btn blue-btn">إنشاء بيانات تجريبية</button>
          <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">اضغط على هذا الزر لإنشاء بيانات تجريبية لاختبار الأعمدة الجديدة</p>
        </div>
      </div>
      
      <!-- إدارة الطالبات -->
      <div class="admin-section">
        <h3>إدارة قائمة الطالبات</h3>
        <div class="form-group">
          <label for="newStudentName" class="form-label">إضافة طالبة جديدة:</label>
          <div style="display: flex; gap: 10px;">
            <input type="text" id="newStudentName" class="form-input" placeholder="اسم الطالبة الرباعي">
            <button type="button" id="addStudentBtn" class="form-btn green-btn">إضافة</button>
          </div>
        </div>
        
        <div class="students-list" id="studentsList">
          <!-- ستظهر قائمة الطالبات هنا -->
        </div>
      </div>

      <script>
      // نظام إدارة الطالبات
      let students = [];
      
      // تحميل الطالبات من LocalStorage
      function loadStudents() {
        try {
          const savedStudents = localStorage.getItem('afnan_students');
          students = savedStudents ? JSON.parse(savedStudents) : [];
        } catch(e) {
          students = [];
        }
        renderStudentsList();
      }
      
      // حفظ الطالبات في LocalStorage
      function saveStudents() {
        localStorage.setItem('afnan_students', JSON.stringify(students));
      }
      
      // عرض قائمة الطالبات
      function renderStudentsList() {
        const studentsList = document.getElementById('studentsList');
        if (!studentsList) return;
        
        if (students.length === 0) {
          studentsList.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #888; background: #f8f9fa; border-radius: 8px; margin-top: 10px;">
              <i style="font-size: 2rem; color: #ddd; display: block; margin-bottom: 10px;">👥</i>
              لا توجد طالبات مسجلة حالياً
            </div>
          `;
          return;
        }
        
        studentsList.innerHTML = `
          <div style="margin-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
              <span style="font-weight: bold; color: #BD9750;">قائمة الطالبات (${students.length})</span>
              <button type="button" onclick="exportStudentsToCSV()" class="form-btn blue-btn" style="padding: 8px 15px; font-size: 0.9rem;">
                <i>📊</i> تصدير
              </button>
            </div>
            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px;">
              ${students.map((student, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #f1f3f4; background: white; transition: background-color 0.2s;" 
                     onmouseover="this.style.background='#f8f9fa'" 
                     onmouseout="this.style.background='white'">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #BD9750, #e6a700); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem;">
                      ${student.name.charAt(0)}
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #333; font-size: 1rem;">${student.name}</div>
                      <div style="font-size: 0.85rem; color: #666;">تم الإضافة: ${new Date(student.addedAt).toLocaleDateString('ar-SA')}</div>
                    </div>
                  </div>
                  <button type="button" onclick="deleteStudent(${index})" class="form-btn red-btn" style="padding: 8px 12px; font-size: 0.85rem; min-width: auto;">
                    <i>🗑️</i> حذف
                  </button>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      // إضافة طالبة جديدة
      function addStudent() {
        const nameInput = document.getElementById('newStudentName');
        const name = nameInput.value.trim();
        
        if (!name) {
          showToast('يرجى إدخال اسم الطالبة', 'error');
          nameInput.focus();
          return;
        }
        
        // التحقق من عدم تكرار الاسم
        if (students.some(student => student.name.toLowerCase() === name.toLowerCase())) {
          showToast('هذه الطالبة مسجلة مسبقاً', 'warning');
          nameInput.focus();
          return;
        }
        
        const newStudent = {
          name: name,
          addedAt: new Date().toISOString(),
          id: Date.now() + Math.random()
        };
        
        students.push(newStudent);
        saveStudents();
        renderStudentsList();
        
        nameInput.value = '';
        showToast(`تم إضافة الطالبة "${name}" بنجاح`, 'success');
        nameInput.focus();
      }
      
      // حذف طالبة
      function deleteStudent(index) {
        const student = students[index];
        if (confirm(`هل أنت متأكد من حذف الطالبة "${student.name}"؟`)) {
          students.splice(index, 1);
          saveStudents();
          renderStudentsList();
          showToast(`تم حذف الطالبة "${student.name}" بنجاح`, 'success');
        }
      }
      
      // تصدير قائمة الطالبات إلى CSV
      function exportStudentsToCSV() {
        if (students.length === 0) {
          showToast('لا توجد طالبات للتصدير', 'warning');
          return;
        }
        
        const csvContent = [
          'اسم الطالبة,تاريخ الإضافة',
          ...students.map(student => 
            `"${student.name}","${new Date(student.addedAt).toLocaleDateString('ar-SA')}"`
          )
        ].join('\n');
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `قائمة_الطالبات_${new Date().toLocaleDateString('ar-SA')}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('تم تصدير قائمة الطالبات بنجاح', 'success');
      }
      
      // دالة عرض رسائل التنبيه
      function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 8px;
          color: white;
          font-weight: 600;
          font-family: 'Cairo', 'Tajawal', sans-serif;
          z-index: 10000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          transform: translateX(100%);
          transition: transform 0.3s ease;
          max-width: 300px;
          word-wrap: break-word;
        `;
        
        const colors = {
          success: '#28a745',
          error: '#dc3545',
          warning: '#ffc107',
          info: '#17a2b8'
        };
        
        toast.style.background = colors[type] || colors.info;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // إظهار الرسالة
        setTimeout(() => {
          toast.style.transform = 'translateX(0)';
        }, 100);
        
        // إخفاء الرسالة بعد 3 ثوان
        setTimeout(() => {
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }
      
      // تفعيل الأزرار عند تحميل الصفحة
      document.addEventListener('DOMContentLoaded', function() {
        loadStudents();
        
        // تفعيل زر إضافة طالبة
        const addStudentBtn = document.getElementById('addStudentBtn');
        if (addStudentBtn) {
          addStudentBtn.onclick = addStudent;
        }
        
        // تفعيل إدخال الطالبة عند الضغط على Enter
        const newStudentName = document.getElementById('newStudentName');
        if (newStudentName) {
          newStudentName.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              addStudent();
            }
          });
        }
      });
      </script>

      <!-- إدارة الأعمدة المخصصة -->
      <div class="admin-section" id="customColumnsSection">
        <h3>إدارة الأعمدة المخصصة للجدول</h3>
        
        <!-- نموذج إضافة عمود جديد -->
        <div class="form-container">
          <h4>إضافة عمود جديد</h4>
          <div class="form-group">
            <label for="newCustomColumnName" class="form-label">اسم العمود:</label>
            <input type="text" id="newCustomColumnName" class="form-input" placeholder="مثال: الواجب المنزلي، رقم الهوية، ملاحظة خاصة">
          </div>
          <div class="form-group">
            <label for="columnType" class="form-label">نوع العمود:</label>
            <select id="columnType" class="form-input" onchange="toggleColumnOptions()">
              <option value="text">نص</option>
              <option value="number">رقم</option>
              <option value="select">قائمة منسدلة</option>
              <option value="checkbox">صندوق اختيار</option>
              <option value="date">تاريخ</option>
              <option value="time">وقت</option>
              <option value="textarea">نص طويل</option>
            </select>
          </div>
          <div class="form-group" id="selectOptionsGroup" style="display: none;">
            <label for="selectOptions" class="form-label">خيارات القائمة المنسدلة (مفصولة بفواصل):</label>
            <input type="text" id="selectOptions" class="form-input" placeholder="مثال: ممتاز، جيد، مقبول، ضعيف">
          </div>
          <div class="form-group">
            <label for="columnRequired" class="form-label">
              <input type="checkbox" id="columnRequired" style="margin-left: 8px;">
              إجباري
            </label>
          </div>
          <div class="form-group">
            <label for="columnDescription" class="form-label">وصف العمود:</label>
            <textarea id="columnDescription" class="form-input" placeholder="وصف مختصر للعمود (اختياري)" rows="2"></textarea>
          </div>
          <button type="button" id="addCustomColumnBtn" class="form-btn green-btn">إضافة عمود</button>
        </div>
        
        <!-- قائمة الأعمدة المضافة -->
        <div class="columns-management">
          <div class="section-header">
            <h4>الأعمدة المضافة</h4>
            <button type="button" onclick="exportColumnsToCSV()" class="form-btn blue-btn">
              <i>📊</i> تصدير إلى Excel
            </button>
          </div>
          <div id="customColumnsList" class="items-list"></div>
        </div>
      </div>

      <!-- إدارة الجداول الزمنية -->
      <div class="admin-section" id="schedulesSection">
        <h3>إدارة الجداول الزمنية</h3>
        
        <!-- نموذج إضافة جدول جديد -->
        <div class="form-container">
          <h4>إضافة جدول جديد</h4>
          <div class="form-group">
            <label for="scheduleName" class="form-label">اسم الجدول:</label>
            <input type="text" id="scheduleName" class="form-input" placeholder="مثال: جدول الصباح، جدول المساء">
          </div>
          <div class="form-group">
            <label for="scheduleType" class="form-label">نوع الجدول:</label>
            <select id="scheduleType" class="form-input">
              <option value="daily">يومي</option>
              <option value="weekly">أسبوعي</option>
              <option value="monthly">شهري</option>
            </select>
          </div>
          <div class="form-group">
            <label for="startTime" class="form-label">وقت البداية:</label>
            <input type="time" id="startTime" class="form-input">
          </div>
          <div class="form-group">
            <label for="endTime" class="form-label">وقت النهاية:</label>
            <input type="time" id="endTime" class="form-input">
          </div>
          <div class="form-group">
            <label for="scheduleDays" class="form-label">أيام العمل:</label>
            <div class="days-selector">
              <label><input type="checkbox" value="sunday"> الأحد</label>
              <label><input type="checkbox" value="monday"> الاثنين</label>
              <label><input type="checkbox" value="tuesday"> الثلاثاء</label>
              <label><input type="checkbox" value="wednesday"> الأربعاء</label>
              <label><input type="checkbox" value="thursday"> الخميس</label>
              <label><input type="checkbox" value="friday"> الجمعة</label>
              <label><input type="checkbox" value="saturday"> السبت</label>
            </div>
          </div>
          <div class="form-group">
            <label for="scheduleDescription" class="form-label">وصف الجدول:</label>
            <textarea id="scheduleDescription" class="form-input" placeholder="وصف مختصر للجدول" rows="2"></textarea>
          </div>
          <button type="button" onclick="addSchedule()" class="form-btn green-btn">إضافة جدول</button>
        </div>
        
        <!-- قائمة الجداول -->
        <div class="schedules-management">
          <div class="section-header">
            <h4>الجداول الزمنية</h4>
            <button type="button" onclick="exportSchedulesToCSV()" class="form-btn blue-btn">
              <i>📊</i> تصدير إلى Excel
            </button>
          </div>
          <div id="schedulesList" class="items-list"></div>
        </div>
      </div>

      <!-- جدول أسماء الخطوط وأكواد الألوان المرجعية -->
      <div class="admin-section" id="fontsColorsReference" style="margin-top: 30px; background: #f8f8f8; border: 1px solid #eee; border-radius: 10px; padding: 18px;">
        <h4 style="margin-bottom: 12px; color: #BD9750;">دليل الخطوط والألوان المستخدمة في التخصيص</h4>
        <div style="overflow-x:auto;">
          <table style="width:100%; max-width:700px; margin:auto; border-collapse:collapse; background:#fff; border-radius:8px; box-shadow:0 1px 4px #eee;">
            <thead>
              <tr style="background:#f7e7c1;">
                <th style="padding:10px 8px; text-align:center;">اسم الخط</th>
                <th style="padding:10px 8px; text-align:center;">معاينة</th>
                <th style="padding:10px 8px; text-align:center;">كود CSS</th>
              </tr>
            </thead>
            <tbody>
              <tr><td style="text-align:center;">Cairo</td><td style="font-family:Cairo; text-align:center;">مثال نصي</td><td style="text-align:center;">Cairo</td></tr>
              <tr><td style="text-align:center;">Tajawal</td><td style="font-family:Tajawal; text-align:center;">مثال نصي</td><td style="text-align:center;">Tajawal</td></tr>
              <tr><td style="text-align:center;">Amiri</td><td style="font-family:Amiri; text-align:center;">مثال نصي</td><td style="text-align:center;">Amiri</td></tr>
              <tr><td style="text-align:center;">Aref Ruqaa</td><td style="font-family:'Aref Ruqaa'; text-align:center;">مثال نصي</td><td style="text-align:center;">'Aref Ruqaa'</td></tr>
              <tr><td style="text-align:center;">Reem Kufi</td><td style="font-family:'Reem Kufi'; text-align:center;">مثال نصي</td><td style="text-align:center;">'Reem Kufi'</td></tr>
              <tr><td style="text-align:center;">Harmattan</td><td style="font-family:Harmattan; text-align:center;">مثال نصي</td><td style="text-align:center;">Harmattan</td></tr>
              <tr><td style="text-align:center;">Scheherazade New</td><td style="font-family:'Scheherazade New'; text-align:center;">مثال نصي</td><td style="text-align:center;">'Scheherazade New'</td></tr>
              <tr><td style="text-align:center;">Noto Sans Arabic</td><td style="font-family:'Noto Sans Arabic'; text-align:center;">مثال نصي</td><td style="text-align:center;">'Noto Sans Arabic'</td></tr>
              <tr><td style="text-align:center;">Arial</td><td style="font-family:Arial; text-align:center;">مثال نصي</td><td style="text-align:center;">Arial</td></tr>
              <tr><td style="text-align:center;">Tahoma</td><td style="font-family:Tahoma; text-align:center;">مثال نصي</td><td style="text-align:center;">Tahoma</td></tr>
              <tr><td style="text-align:center;">serif</td><td style="font-family:serif; text-align:center;">مثال نصي</td><td style="text-align:center;">serif</td></tr>
              <tr><td style="text-align:center;">sans-serif</td><td style="font-family:sans-serif; text-align:center;">مثال نصي</td><td style="text-align:center;">sans-serif</td></tr>
            </tbody>
          </table>
        </div>
        <div style="overflow-x:auto;">
          <table style="width:100%; max-width:600px; margin:auto; border-collapse:collapse; background:#fff; border-radius:8px; box-shadow:0 1px 4px #eee;">
            <thead>
              <tr style="background:#f7e7c1;">
                <th style="padding:10px 8px; text-align:center;">اسم اللون</th>
                <th style="padding:10px 8px; text-align:center;">معاينة</th>
                <th style="padding:10px 8px; text-align:center;">كود اللون</th>
              </tr>
            </thead>
            <tbody>
              <tr><td style="text-align:center;">ذهبي</td><td style="background:#BD9750; width:60px;"></td><td style="text-align:center;">#BD9750</td></tr>
              <tr><td style="text-align:center;">برتقالي</td><td style="background:#e67e22; width:60px;"></td><td style="text-align:center;">#e67e22</td></tr>
              <tr><td style="text-align:center;">بني</td><td style="background:#8B4513; width:60px;"></td><td style="text-align:center;">#8B4513</td></tr>
              <tr><td style="text-align:center;">أسود</td><td style="background:#333; width:60px;"></td><td style="text-align:center;">#333</td></tr>
              <tr><td style="text-align:center;">رمادي</td><td style="background:#888; width:60px;"></td><td style="text-align:center;">#888</td></tr>
              <tr><td style="text-align:center;">بنفسجي</td><td style="background:#3E0100; width:60px;"></td><td style="text-align:center;">#3E0100</td></tr>
              <tr><td style="text-align:center;">أزرق</td><td style="background:#0d6efd; width:60px;"></td><td style="text-align:center;">#0d6efd</td></tr>
              <tr><td style="text-align:center;">أخضر</td><td style="background:#388e3c; width:60px;"></td><td style="text-align:center;">#388e3c</td></tr>
              <tr><td style="text-align:center;">أحمر</td><td style="background:#c62828; width:60px;"></td><td style="text-align:center;">#c62828</td></tr>
            </tbody>
          </table>
        </div>
        <div style="margin-top:10px; color:#888; font-size:0.95em; text-align:center;">يمكنك نسخ اسم الخط أو كود اللون واستخدامه في التخصيص اليدوي.</div>
      </div>

      <!-- إدارة ملخصات الجلسات -->
      <div class="admin-section" id="sessionsSection">
        <h3>إدارة ملخصات الجلسات</h3>
        
        <!-- نموذج إضافة ملخص جلسة -->
        <div class="form-container">
          <h4>إضافة ملخص جلسة جديدة</h4>
          <div class="form-group">
            <label for="sessionTitle" class="form-label">عنوان الجلسة:</label>
            <input type="text" id="sessionTitle" class="form-input" placeholder="مثال: جلسة التجويد الأولى">
          </div>
          <div class="form-group">
            <label for="sessionDate" class="form-label">تاريخ الجلسة:</label>
            <input type="date" id="sessionDate" class="form-input">
          </div>
          <div class="form-group">
            <label for="sessionTime" class="form-label">وقت الجلسة:</label>
            <input type="time" id="sessionTime" class="form-input">
          </div>
          <div class="form-group">
            <label for="sessionDuration" class="form-label">مدة الجلسة (بالدقائق):</label>
            <input type="number" id="sessionDuration" class="form-input" placeholder="60" min="15" max="300">
          </div>
          <div class="form-group">
            <label for="sessionInstructor" class="form-label">المدرب:</label>
            <input type="text" id="sessionInstructor" class="form-input" placeholder="اسم المدرب">
          </div>
          <div class="form-group">
            <label for="sessionTopic" class="form-label">موضوع الجلسة:</label>
            <textarea id="sessionTopic" class="form-input" placeholder="موضوع الجلسة والمواد المغطاة" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="sessionNotes" class="form-label">ملاحظات إضافية:</label>
            <textarea id="sessionNotes" class="form-input" placeholder="ملاحظات وتوصيات" rows="3"></textarea>
          </div>
          <button type="button" onclick="addSession()" class="form-btn green-btn">إضافة جلسة</button>
        </div>
        
        <!-- قائمة الجلسات -->
        <div class="sessions-management">
          <div class="section-header">
            <h4>ملخصات الجلسات</h4>
            <div style="display: flex; gap: 10px;">
              <button type="button" onclick="exportSessionsToCSV()" class="form-btn blue-btn">
                <i>📊</i> تصدير إلى Excel
              </button>
              <button type="button" onclick="generateSessionReport()" class="form-btn green-btn">
                <i>📋</i> تقرير الجلسات
              </button>
            </div>
          </div>
          <div id="sessionsList" class="items-list"></div>
        </div>
      </div>
      <!-- الإحصائيات والتقارير -->
      <div class="admin-section" id="statisticsSection">
        <h3>الإحصائيات والتقارير</h3>
        
        <!-- بطاقات الإحصائيات -->
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon">👥</div>
            <div class="stat-content">
              <div class="stat-number" id="totalStudents">0</div>
              <div class="stat-label">إجمالي الطالبات</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">📊</div>
            <div class="stat-content">
              <div class="stat-number" id="totalSessions">0</div>
              <div class="stat-label">إجمالي الجلسات</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">✅</div>
            <div class="stat-content">
              <div class="stat-number" id="attendanceRate">0%</div>
              <div class="stat-label">معدل الحضور</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">📅</div>
            <div class="stat-content">
              <div class="stat-number" id="activeSchedules">0</div>
              <div class="stat-label">الجداول النشطة</div>
            </div>
          </div>
        </div>
        
        <!-- التقارير السريعة -->
        <div class="reports-section">
          <div class="section-header">
            <h4>التقارير السريعة</h4>
            <button type="button" onclick="generateFullReport()" class="form-btn green-btn">
              <i>📋</i> تقرير شامل
            </button>
          </div>
          <div class="reports-grid">
            <div class="report-card">
              <h5>تقرير الحضور اليومي</h5>
              <p>إحصائيات الحضور والانصراف لليوم الحالي</p>
              <button type="button" onclick="generateDailyReport()" class="form-btn blue-btn">عرض التقرير</button>
            </div>
            <div class="report-card">
              <h5>تقرير الأسبوع</h5>
              <p>ملخص إحصائيات الأسبوع الحالي</p>
              <button type="button" onclick="generateWeeklyReport()" class="form-btn blue-btn">عرض التقرير</button>
            </div>
            <div class="report-card">
              <h5>تقرير الشهر</h5>
              <p>إحصائيات شهرية شاملة</p>
              <button type="button" onclick="generateMonthlyReport()" class="form-btn blue-btn">عرض التقرير</button>
            </div>
            <div class="report-card">
              <h5>تقرير الطالبات</h5>
              <p>إحصائيات مفصلة لكل طالبة</p>
              <button type="button" onclick="generateStudentsReport()" class="form-btn blue-btn">عرض التقرير</button>
            </div>
          </div>
        </div>
      </div>

      <!-- إدارة الواجبات -->
      <div class="admin-section">
        <h3>إدارة الواجبات</h3>
        
        <div class="homework-management">
          <!-- المستوى الثاني الدُفعة الأولى -->
          <div class="homework-level-card">
            <h4>المستوى الثاني الدُفعة الأولى</h4>
            <div class="form-group">
              <label for="level2-batch1-password" class="form-label">كلمة المرور:</label>
              <div style="display: flex; gap: 10px;">
                <input type="password" id="level2-batch1-password" class="form-input" placeholder="كلمة المرور">
                <button type="button" onclick="updateHomeworkPassword('level2-batch1')" class="form-btn blue-btn">تحديث</button>
              </div>
            </div>
            <div class="form-group">
              <label for="level2-batch1-links" class="form-label">روابط الواجبات (كل رابط في سطر منفصل):</label>
              <textarea id="level2-batch1-links" class="form-input" rows="4" placeholder="ضع هنا روابط الواجبات، كل رابط في سطر منفصل"></textarea>
              <button type="button" onclick="updateHomeworkLinks('level2-batch1')" class="form-btn green-btn">حفظ الروابط</button>
            </div>
          </div>

          <!-- المستوى الأول الدُفعة الثانية -->
          <div class="homework-level-card">
            <h4>المستوى الأول الدُفعة الثانية</h4>
            <div class="form-group">
              <label for="level1-batch2-password" class="form-label">كلمة المرور:</label>
              <div style="display: flex; gap: 10px;">
                <input type="password" id="level1-batch2-password" class="form-input" placeholder="كلمة المرور">
                <button type="button" onclick="updateHomeworkPassword('level1-batch2')" class="form-btn blue-btn">تحديث</button>
              </div>
            </div>
            <div class="form-group">
              <label for="level1-batch2-links" class="form-label">روابط الواجبات (كل رابط في سطر منفصل):</label>
              <textarea id="level1-batch2-links" class="form-input" rows="4" placeholder="ضع هنا روابط الواجبات، كل رابط في سطر منفصل"></textarea>
              <button type="button" onclick="updateHomeworkLinks('level1-batch2')" class="form-btn green-btn">حفظ الروابط</button>
            </div>
          </div>

          <!-- المستوى الأول الدُفعة الثالثة -->
          <div class="homework-level-card">
            <h4>المستوى الأول الدُفعة الثالثة</h4>
            <div class="form-group">
              <label for="level1-batch3-password" class="form-label">كلمة المرور:</label>
              <div style="display: flex; gap: 10px;">
                <input type="password" id="level1-batch3-password" class="form-input" placeholder="كلمة المرور">
                <button type="button" onclick="updateHomeworkPassword('level1-batch3')" class="form-btn blue-btn">تحديث</button>
              </div>
            </div>
            <div class="form-group">
              <label for="level1-batch3-links" class="form-label">روابط الواجبات (كل رابط في سطر منفصل):</label>
              <textarea id="level1-batch3-links" class="form-input" rows="4" placeholder="ضع هنا روابط الواجبات، كل رابط في سطر منفصل"></textarea>
              <button type="button" onclick="updateHomeworkLinks('level1-batch3')" class="form-btn green-btn">حفظ الروابط</button>
            </div>
          </div>
        </div>
      </div>

      <!-- إدارة المشرفين -->
      <div class="admin-section">
        <h3>إدارة المشرفين</h3>
        
        <!-- إضافة مشرف جديد -->
        <div class="form-group">
          <label for="newAdminUsername" class="form-label">إضافة مشرف جديد:</label>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" id="newAdminUsername" class="form-input" placeholder="اسم المستخدم" style="flex: 1; min-width: 200px;">
            <input type="password" id="newAdminPassword" class="form-input" placeholder="كلمة المرور" style="flex: 1; min-width: 200px;">
            <button type="button" id="addAdminBtn" class="form-btn green-btn">إضافة مشرف</button>
          </div>
        </div>
        
        <!-- قائمة المشرفين -->
        <div class="students-list" id="adminsList">
          <!-- ستظهر قائمة المشرفين هنا -->
        </div>
      </div>



      <script>
      // نظام إدارة المشرفين
      let admins = [];
      
      // تحميل المشرفين من LocalStorage
      function loadAdmins() {
        try {
          const savedAdmins = localStorage.getItem('afnan_admins');
          admins = savedAdmins ? JSON.parse(savedAdmins) : [];
          // إذا لم يكن هناك مشرفين، أضف مشرف افتراضي
          if (admins.length === 0) {
            admins = [{ username: 'Afnan Academy', password: 'admin123', addedAt: new Date().toISOString(), id: Date.now() }];
            saveAdmins();
          }
        } catch(e) {
          admins = [{ username: 'Afnan Academy', password: 'admin123', addedAt: new Date().toISOString(), id: Date.now() }];
          saveAdmins();
        }
        renderAdminsList();
      }
      
      // حفظ المشرفين في LocalStorage
        function saveAdmins() {
    localStorage.setItem('afnan_admins', JSON.stringify(admins));
  }
  
  function loadAdmins() {
    try {
      const savedAdmins = localStorage.getItem('afnan_admins');
      admins = savedAdmins ? JSON.parse(savedAdmins) : [];
      
      // إضافة مشرف افتراضي إذا لم يكن هناك مشرفين
      if (admins.length === 0) {
        admins = [{ username: 'admin', password: 'admin123' }];
        localStorage.setItem('afnan_admins', JSON.stringify(admins));
      }
    } catch(e) {
      admins = [{ username: 'admin', password: 'admin123' }];
      localStorage.setItem('afnan_admins', JSON.stringify(admins));
    }
  }
      
      // عرض قائمة المشرفين
      function renderAdminsList() {
        const adminsList = document.getElementById('adminsList');
        if (!adminsList) return;
        
        if (admins.length === 0) {
          adminsList.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #888; background: #f8f9fa; border-radius: 8px; margin-top: 10px;">
              <i style="font-size: 2rem; color: #ddd; display: block; margin-bottom: 10px;">👤</i>
              لا يوجد مشرفين مسجلين حالياً
            </div>
          `;
          return;
        }
        
        adminsList.innerHTML = `
          <div style="margin-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
              <span style="font-weight: bold; color: #BD9750;">قائمة المشرفين (${admins.length})</span>
              <button type="button" onclick="exportAdminsToCSV()" class="form-btn blue-btn" style="padding: 8px 15px; font-size: 0.9rem;">
                <i>📊</i> تصدير
              </button>
            </div>
            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px;">
              ${admins.map((admin, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #f1f3f4; background: white; transition: background-color 0.2s;" 
                     onmouseover="this.style.background='#f8f9fa'" 
                     onmouseout="this.style.background='white'">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #dc3545, #c82333); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem;">
                      ${admin.username.charAt(0).toUpperCase()}
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #333; font-size: 1rem;">${admin.username}</div>
                      <div style="font-size: 0.85rem; color: #666;">تم الإضافة: ${new Date(admin.addedAt).toLocaleDateString('ar-SA')}</div>
                    </div>
                  </div>
                  <div style="display: flex; gap: 8px;">
                    <button type="button" onclick="editAdmin(${index})" class="form-btn blue-btn" style="padding: 8px 12px; font-size: 0.85rem; min-width: auto;">
                      <i>✏️</i> تعديل
                    </button>
                    <button type="button" onclick="deleteAdmin(${index})" class="form-btn red-btn" style="padding: 8px 12px; font-size: 0.85rem; min-width: auto;">
                      <i>🗑️</i> حذف
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      // دوال إدارة الأعمدة المخصصة
      let customColumns = [];
      
      // تحميل الأعمدة المخصصة
      function loadCustomColumns() {
        try {
          const savedColumns = localStorage.getItem('afnan_custom_columns');
          customColumns = savedColumns ? JSON.parse(savedColumns) : [];
        } catch(e) {
          customColumns = [];
        }
        renderCustomColumnsList();
      }
      
      // حفظ الأعمدة المخصصة
      function saveCustomColumns() {
        localStorage.setItem('afnan_custom_columns', JSON.stringify(customColumns));
      }
      
      // عرض قائمة الأعمدة المخصصة
      function renderCustomColumnsList() {
        const columnsList = document.getElementById('customColumnsList');
        if (!columnsList) return;
        
        if (customColumns.length === 0) {
          columnsList.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #888; background: #f8f9fa; border-radius: 8px;">
              <i style="font-size: 2rem; color: #ddd; display: block; margin-bottom: 10px;">📋</i>
              لا توجد أعمدة مخصصة مضافة حالياً
            </div>
          `;
          return;
        }
        
        columnsList.innerHTML = customColumns.map((column, index) => `
          <div class="item-card">
            <div class="item-info">
              <div class="item-avatar" style="background: linear-gradient(135deg, #28a745, #20c997);">
                📋
              </div>
              <div class="item-details">
                <h5>${column.name}</h5>
                <p>النوع: ${getColumnTypeName(column.type)} | ${column.required ? 'إجباري' : 'اختياري'}</p>
                ${column.description ? `<p style="font-size: 0.8rem; color: #888;">${column.description}</p>` : ''}
              </div>
            </div>
            <div class="item-actions">
              <button type="button" onclick="editCustomColumn(${index})" class="form-btn blue-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>✏️</i> تعديل
              </button>
              <button type="button" onclick="deleteCustomColumn(${index})" class="form-btn red-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>🗑️</i> حذف
              </button>
            </div>
          </div>
        `).join('');
      }
      
      // الحصول على اسم نوع العمود
      function getColumnTypeName(type) {
        const types = {
          'text': 'نص',
          'number': 'رقم',
          'select': 'قائمة منسدلة',
          'checkbox': 'صندوق اختيار',
          'date': 'تاريخ',
          'time': 'وقت',
          'textarea': 'نص طويل'
        };
        return types[type] || type;
      }
      
      // تبديل خيارات القائمة المنسدلة
      function toggleColumnOptions() {
        const columnType = document.getElementById('columnType').value;
        const selectOptionsGroup = document.getElementById('selectOptionsGroup');
        selectOptionsGroup.style.display = columnType === 'select' ? 'block' : 'none';
      }
      
      // إضافة عمود مخصص
      function addCustomColumn() {
        const nameInput = document.getElementById('newCustomColumnName');
        const typeSelect = document.getElementById('columnType');
        const requiredCheckbox = document.getElementById('columnRequired');
        const descriptionTextarea = document.getElementById('columnDescription');
        const selectOptionsInput = document.getElementById('selectOptions');
        
        const name = nameInput.value.trim();
        const type = typeSelect.value;
        const required = requiredCheckbox.checked;
        const description = descriptionTextarea.value.trim();
        
        if (!name) {
          showToast('يرجى إدخال اسم العمود', 'error');
          nameInput.focus();
          return;
        }
        
        if (customColumns.some(col => col.name.toLowerCase() === name.toLowerCase())) {
          showToast('اسم العمود موجود مسبقاً', 'warning');
          nameInput.focus();
          return;
        }
        
        const newColumn = {
          id: Date.now(),
          name: name,
          type: type,
          required: required,
          description: description,
          options: type === 'select' ? selectOptionsInput.value.split(',').map(opt => opt.trim()).filter(opt => opt) : [],
          createdAt: new Date().toISOString()
        };
        
        customColumns.push(newColumn);
        saveCustomColumns();
        renderCustomColumnsList();
        
        // مسح النموذج
        nameInput.value = '';
        typeSelect.value = 'text';
        requiredCheckbox.checked = false;
        descriptionTextarea.value = '';
        selectOptionsInput.value = '';
        toggleColumnOptions();
        
        showToast('تم إضافة العمود المخصص بنجاح', 'success');
      }
      
             // تعديل عمود مخصص
       function editCustomColumn(index) {
         const column = customColumns[index];
         
         // ملء النموذج بالبيانات الحالية
         document.getElementById('newCustomColumnName').value = column.name;
         document.getElementById('columnType').value = column.type;
         document.getElementById('columnRequired').checked = column.required;
         document.getElementById('columnDescription').value = column.description || '';
         document.getElementById('selectOptions').value = column.options ? column.options.join(', ') : '';
         
         // تبديل خيارات القائمة المنسدلة
         toggleColumnOptions();
         
         // تغيير زر الإضافة إلى تحديث
         const addBtn = document.getElementById('addCustomColumnBtn');
         addBtn.textContent = 'تحديث العمود';
         addBtn.onclick = function() {
           updateCustomColumn(index);
         };
         
         // التمرير إلى النموذج
         document.getElementById('newCustomColumnName').scrollIntoView({ behavior: 'smooth' });
       }
       
       // تحديث عمود مخصص
       function updateCustomColumn(index) {
         const nameInput = document.getElementById('newCustomColumnName');
         const typeSelect = document.getElementById('columnType');
         const requiredCheckbox = document.getElementById('columnRequired');
         const descriptionTextarea = document.getElementById('columnDescription');
         const selectOptionsInput = document.getElementById('selectOptions');
         
         const name = nameInput.value.trim();
         const type = typeSelect.value;
         const required = requiredCheckbox.checked;
         const description = descriptionTextarea.value.trim();
         
         if (!name) {
           showToast('يرجى إدخال اسم العمود', 'error');
           nameInput.focus();
           return;
         }
         
         // التحقق من عدم تكرار الاسم (باستثناء العمود الحالي)
         if (customColumns.some((col, i) => i !== index && col.name.toLowerCase() === name.toLowerCase())) {
           showToast('اسم العمود موجود مسبقاً', 'warning');
           nameInput.focus();
           return;
         }
         
         // تحديث العمود
         customColumns[index] = {
           ...customColumns[index],
           name: name,
           type: type,
           required: required,
           description: description,
           options: type === 'select' ? selectOptionsInput.value.split(',').map(opt => opt.trim()).filter(opt => opt) : [],
           updatedAt: new Date().toISOString()
         };
         
         saveCustomColumns();
         renderCustomColumnsList();
         
         // إعادة تعيين النموذج
         nameInput.value = '';
         typeSelect.value = 'text';
         requiredCheckbox.checked = false;
         descriptionTextarea.value = '';
         selectOptionsInput.value = '';
         toggleColumnOptions();
         
         // إعادة تعيين الزر
         const addBtn = document.getElementById('addCustomColumnBtn');
         addBtn.textContent = 'إضافة عمود';
         addBtn.onclick = addCustomColumn;
         
         showToast('تم تحديث العمود بنجاح', 'success');
       }
       
       // حذف عمود مخصص
       function deleteCustomColumn(index) {
        if (confirm('هل أنت متأكد من حذف هذا العمود؟')) {
          customColumns.splice(index, 1);
          saveCustomColumns();
          renderCustomColumnsList();
          showToast('تم حذف العمود بنجاح', 'success');
        }
      }
      
      // تصدير الأعمدة إلى CSV
      function exportColumnsToCSV() {
        if (customColumns.length === 0) {
          showToast('لا توجد أعمدة للتصدير', 'warning');
          return;
        }
        
        const headers = ['اسم العمود', 'النوع', 'إجباري', 'الوصف', 'تاريخ الإنشاء'];
        const csvContent = [
          headers.join(','),
          ...customColumns.map(col => [
            col.name,
            getColumnTypeName(col.type),
            col.required ? 'نعم' : 'لا',
            col.description || '',
            new Date(col.createdAt).toLocaleDateString('ar-SA')
          ].join(','))
        ].join('\n');
        
        downloadCSV(csvContent, 'الأعمدة_المخصصة');
        showToast('تم تصدير الأعمدة بنجاح', 'success');
      }
      
      // دوال إدارة الجداول الزمنية
      let schedules = [];
      
      // تحميل الجداول الزمنية
      function loadSchedules() {
        try {
          const savedSchedules = localStorage.getItem('afnan_schedules');
          schedules = savedSchedules ? JSON.parse(savedSchedules) : [];
        } catch(e) {
          schedules = [];
        }
        renderSchedulesList();
      }
      
      // حفظ الجداول الزمنية
      function saveSchedules() {
        localStorage.setItem('afnan_schedules', JSON.stringify(schedules));
      }
      
      // عرض قائمة الجداول
      function renderSchedulesList() {
        const schedulesList = document.getElementById('schedulesList');
        if (!schedulesList) return;
        
        if (schedules.length === 0) {
          schedulesList.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #888; background: #f8f9fa; border-radius: 8px;">
              <i style="font-size: 2rem; color: #ddd; display: block; margin-bottom: 10px;">📅</i>
              لا توجد جداول زمنية مضافة حالياً
            </div>
          `;
          return;
        }
        
        schedulesList.innerHTML = schedules.map((schedule, index) => `
          <div class="item-card">
            <div class="item-info">
              <div class="item-avatar" style="background: linear-gradient(135deg, #007bff, #0056b3);">
                📅
              </div>
              <div class="item-details">
                <h5>${schedule.name}</h5>
                <p>${schedule.startTime} - ${schedule.endTime} | ${getScheduleTypeName(schedule.type)}</p>
                ${schedule.description ? `<p style="font-size: 0.8rem; color: #888;">${schedule.description}</p>` : ''}
              </div>
            </div>
            <div class="item-actions">
              <button type="button" onclick="editSchedule(${index})" class="form-btn blue-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>✏️</i> تعديل
              </button>
              <button type="button" onclick="deleteSchedule(${index})" class="form-btn red-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>🗑️</i> حذف
              </button>
            </div>
          </div>
        `).join('');
      }
      
      // الحصول على اسم نوع الجدول
      function getScheduleTypeName(type) {
        const types = {
          'daily': 'يومي',
          'weekly': 'أسبوعي',
          'monthly': 'شهري'
        };
        return types[type] || type;
      }
      
      // إضافة جدول جديد
      function addSchedule() {
        const nameInput = document.getElementById('scheduleName');
        const typeSelect = document.getElementById('scheduleType');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const descriptionTextarea = document.getElementById('scheduleDescription');
        
        const name = nameInput.value.trim();
        const type = typeSelect.value;
        const startTime = startTimeInput.value;
        const endTime = endTimeInput.value;
        const description = descriptionTextarea.value.trim();
        
        // الحصول على الأيام المختارة
        const selectedDays = Array.from(document.querySelectorAll('.days-selector input[type="checkbox"]:checked'))
          .map(checkbox => checkbox.value);
        
        if (!name || !startTime || !endTime) {
          showToast('يرجى إدخال جميع البيانات المطلوبة', 'error');
          return;
        }
        
        if (selectedDays.length === 0) {
          showToast('يرجى اختيار يوم واحد على الأقل', 'warning');
          return;
        }
        
        const newSchedule = {
          id: Date.now(),
          name: name,
          type: type,
          startTime: startTime,
          endTime: endTime,
          days: selectedDays,
          description: description,
          createdAt: new Date().toISOString()
        };
        
        schedules.push(newSchedule);
        saveSchedules();
        renderSchedulesList();
        
        // مسح النموذج
        nameInput.value = '';
        typeSelect.value = 'daily';
        startTimeInput.value = '';
        endTimeInput.value = '';
        descriptionTextarea.value = '';
        document.querySelectorAll('.days-selector input[type="checkbox"]').forEach(cb => cb.checked = false);
        
        showToast('تم إضافة الجدول الزمني بنجاح', 'success');
      }
             // تعديل جدول
       function editSchedule(index) {
         const schedule = schedules[index];
         
         // ملء النموذج بالبيانات الحالية
         document.getElementById('scheduleName').value = schedule.name;
         document.getElementById('scheduleType').value = schedule.type;
         document.getElementById('startTime').value = schedule.startTime;
         document.getElementById('endTime').value = schedule.endTime;
         document.getElementById('scheduleDescription').value = schedule.description || '';
         
         // تحديد الأيام المختارة
         document.querySelectorAll('.days-selector input[type="checkbox"]').forEach(checkbox => {
           checkbox.checked = schedule.days.includes(checkbox.value);
         });
         
         // تغيير زر الإضافة إلى تحديث
         const addBtn = document.querySelector('button[onclick="addSchedule()"]');
         addBtn.textContent = 'تحديث الجدول';
         addBtn.onclick = function() {
           updateSchedule(index);
         };
         
         // التمرير إلى النموذج
         document.getElementById('scheduleName').scrollIntoView({ behavior: 'smooth' });
       }
       
       // تحديث جدول
       function updateSchedule(index) {
         const nameInput = document.getElementById('scheduleName');
         const typeSelect = document.getElementById('scheduleType');
         const startTimeInput = document.getElementById('startTime');
         const endTimeInput = document.getElementById('endTime');
         const descriptionTextarea = document.getElementById('scheduleDescription');
         
         const name = nameInput.value.trim();
         const type = typeSelect.value;
         const startTime = startTimeInput.value;
         const endTime = endTimeInput.value;
         const description = descriptionTextarea.value.trim();
         
         // الحصول على الأيام المختارة
         const selectedDays = Array.from(document.querySelectorAll('.days-selector input[type="checkbox"]:checked'))
           .map(checkbox => checkbox.value);
         
         if (!name || !startTime || !endTime) {
           showToast('يرجى إدخال جميع البيانات المطلوبة', 'error');
           return;
         }
         
         if (selectedDays.length === 0) {
           showToast('يرجى اختيار يوم واحد على الأقل', 'warning');
           return;
         }
         
         // تحديث الجدول
         schedules[index] = {
           ...schedules[index],
           name: name,
           type: type,
           startTime: startTime,
           endTime: endTime,
           days: selectedDays,
           description: description,
           updatedAt: new Date().toISOString()
         };
         
         saveSchedules();
         renderSchedulesList();
         
         // إعادة تعيين النموذج
         nameInput.value = '';
         typeSelect.value = 'daily';
         startTimeInput.value = '';
         endTimeInput.value = '';
         descriptionTextarea.value = '';
         document.querySelectorAll('.days-selector input[type="checkbox"]').forEach(cb => cb.checked = false);
         
         // إعادة تعيين الزر
         const addBtn = document.querySelector('button[onclick="updateSchedule(' + index + ')"]');
         addBtn.textContent = 'إضافة جدول';
         addBtn.onclick = addSchedule;
         
         showToast('تم تحديث الجدول بنجاح', 'success');
       }
       
       // حذف جدول
       function deleteSchedule(index) {
        if (confirm('هل أنت متأكد من حذف هذا الجدول؟')) {
          schedules.splice(index, 1);
          saveSchedules();
          renderSchedulesList();
          showToast('تم حذف الجدول بنجاح', 'success');
        }
      }
      
      // تصدير الجداول إلى CSV
      function exportSchedulesToCSV() {
        if (schedules.length === 0) {
          showToast('لا توجد جداول للتصدير', 'warning');
          return;
        }
        
        const headers = ['اسم الجدول', 'النوع', 'وقت البداية', 'وقت النهاية', 'الأيام', 'الوصف'];
        const csvContent = [
          headers.join(','),
          ...schedules.map(schedule => [
            schedule.name,
            getScheduleTypeName(schedule.type),
            schedule.startTime,
            schedule.endTime,
            schedule.days.join('، '),
            schedule.description || ''
          ].join(','))
        ].join('\n');
        
        downloadCSV(csvContent, 'الجداول_الزمنية');
        showToast('تم تصدير الجداول بنجاح', 'success');
      }
      
      // دوال إدارة الجلسات
      let sessions = [];
      
      // تحميل الجلسات
      function loadSessions() {
        try {
          const savedSessions = localStorage.getItem('afnan_sessions');
          sessions = savedSessions ? JSON.parse(savedSessions) : [];
        } catch(e) {
          sessions = [];
        }
        renderSessionsList();
      }
      
      // حفظ الجلسات
      function saveSessions() {
        localStorage.setItem('afnan_sessions', JSON.stringify(sessions));
      }
      
      // عرض قائمة الجلسات
      function renderSessionsList() {
        const sessionsList = document.getElementById('sessionsList');
        if (!sessionsList) return;
        
        if (sessions.length === 0) {
          sessionsList.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #888; background: #f8f9fa; border-radius: 8px;">
              <i style="font-size: 2rem; color: #ddd; display: block; margin-bottom: 10px;">📚</i>
              لا توجد جلسات مسجلة حالياً
            </div>
          `;
          return;
        }
        
        sessionsList.innerHTML = sessions.map((session, index) => `
          <div class="item-card">
            <div class="item-info">
              <div class="item-avatar" style="background: linear-gradient(135deg, #6f42c1, #5a2d91);">
                📚
              </div>
              <div class="item-details">
                <h5>${session.title}</h5>
                <p>${new Date(session.date).toLocaleDateString('ar-SA')} | ${session.time} | ${session.duration} دقيقة</p>
                <p style="font-size: 0.8rem; color: #888;">المدرب: ${session.instructor}</p>
              </div>
            </div>
            <div class="item-actions">
              <button type="button" onclick="viewSessionDetails(${index})" class="form-btn blue-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>👁️</i> عرض
              </button>
              <button type="button" onclick="editSession(${index})" class="form-btn green-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>✏️</i> تعديل
              </button>
              <button type="button" onclick="deleteSession(${index})" class="form-btn red-btn" style="padding: 8px 12px; font-size: 0.85rem;">
                <i>🗑️</i> حذف
              </button>
            </div>
          </div>
        `).join('');
      }
      
      // إضافة جلسة جديدة
      function addSession() {
        const titleInput = document.getElementById('sessionTitle');
        const dateInput = document.getElementById('sessionDate');
        const timeInput = document.getElementById('sessionTime');
        const durationInput = document.getElementById('sessionDuration');
        const instructorInput = document.getElementById('sessionInstructor');
        const topicTextarea = document.getElementById('sessionTopic');
        const notesTextarea = document.getElementById('sessionNotes');
        
        const title = titleInput.value.trim();
        const date = dateInput.value;
        const time = timeInput.value;
        const duration = parseInt(durationInput.value);
        const instructor = instructorInput.value.trim();
        const topic = topicTextarea.value.trim();
        const notes = notesTextarea.value.trim();
        
        if (!title || !date || !time || !duration || !instructor) {
          showToast('يرجى إدخال جميع البيانات المطلوبة', 'error');
          return;
        }
        
        const newSession = {
          id: Date.now(),
          title: title,
          date: date,
          time: time,
          duration: duration,
          instructor: instructor,
          topic: topic,
          notes: notes,
          createdAt: new Date().toISOString()
        };
        
        sessions.push(newSession);
        saveSessions();
        renderSessionsList();
        
        // مسح النموذج
        titleInput.value = '';
        dateInput.value = '';
        timeInput.value = '';
        durationInput.value = '';
        instructorInput.value = '';
        topicTextarea.value = '';
        notesTextarea.value = '';
        
        showToast('تم إضافة الجلسة بنجاح', 'success');
      }
      
             // عرض تفاصيل الجلسة
       function viewSessionDetails(index) {
         const session = sessions[index];
         const modal = document.createElement('div');
         modal.className = 'modal-overlay';
         modal.style.cssText = `
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           display: flex;
           align-items: center;
           justify-content: center;
           z-index: 10000;
         `;
         
         modal.innerHTML = `
           <div class="modal-content" style="background: white; border-radius: 10px; padding: 20px; max-width: 500px; width: 90%; max-height: 80%; overflow-y: auto;">
             <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
               <h3 style="margin: 0; color: #BD9750;">تفاصيل الجلسة</h3>
               <button class="modal-close-btn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
             </div>
             <div style="line-height: 1.6;">
               <p><strong>العنوان:</strong> ${session.title}</p>
               <p><strong>التاريخ:</strong> ${new Date(session.date).toLocaleDateString('ar-SA')}</p>
               <p><strong>الوقت:</strong> ${session.time}</p>
               <p><strong>المدة:</strong> ${session.duration} دقيقة</p>
               <p><strong>المدرب:</strong> ${session.instructor}</p>
               <p><strong>الموضوع:</strong> ${session.topic || 'غير محدد'}</p>
               ${session.notes ? `<p><strong>الملاحظات:</strong> ${session.notes}</p>` : ''}
             </div>
             <div style="text-align: center; margin-top: 20px;">
               <button class="modal-close-btn form-btn blue-btn">إغلاق</button>
             </div>
           </div>
         `;
         
         // إضافة مستمعي الأحداث للإغلاق
         modal.addEventListener('click', function(e) {
           if (e.target === modal) {
             modal.remove();
           }
         });
         
         const closeButtons = modal.querySelectorAll('.modal-close-btn');
         closeButtons.forEach(btn => {
           btn.addEventListener('click', function() {
             modal.remove();
           });
         });
         
         // إغلاق عند الضغط على ESC
         const handleEsc = function(e) {
           if (e.key === 'Escape') {
             modal.remove();
             document.removeEventListener('keydown', handleEsc);
           }
         };
         document.addEventListener('keydown', handleEsc);
         
         document.body.appendChild(modal);
       }
       
       // تعديل جلسة
       function editSession(index) {
         const session = sessions[index];
         
         // ملء النموذج بالبيانات الحالية
         document.getElementById('sessionTitle').value = session.title;
         document.getElementById('sessionDate').value = session.date;
         document.getElementById('sessionTime').value = session.time;
         document.getElementById('sessionDuration').value = session.duration;
         document.getElementById('sessionInstructor').value = session.instructor;
         document.getElementById('sessionTopic').value = session.topic || '';
         document.getElementById('sessionNotes').value = session.notes || '';
         
         // تغيير زر الإضافة إلى تحديث
         const addBtn = document.querySelector('button[onclick="addSession()"]');
         addBtn.textContent = 'تحديث الجلسة';
         addBtn.onclick = function() {
           updateSession(index);
         };
         
         // التمرير إلى النموذج
         document.getElementById('sessionTitle').scrollIntoView({ behavior: 'smooth' });
       }
       
       // تحديث جلسة
       function updateSession(index) {
         const titleInput = document.getElementById('sessionTitle');
         const dateInput = document.getElementById('sessionDate');
         const timeInput = document.getElementById('sessionTime');
         const durationInput = document.getElementById('sessionDuration');
         const instructorInput = document.getElementById('sessionInstructor');
         const topicTextarea = document.getElementById('sessionTopic');
         const notesTextarea = document.getElementById('sessionNotes');
         
         const title = titleInput.value.trim();
         const date = dateInput.value;
         const time = timeInput.value;
         const duration = parseInt(durationInput.value);
         const instructor = instructorInput.value.trim();
         const topic = topicTextarea.value.trim();
         const notes = notesTextarea.value.trim();
         
         if (!title || !date || !time || !duration || !instructor) {
           showToast('يرجى إدخال جميع البيانات المطلوبة', 'error');
           return;
         }
         
         // تحديث الجلسة
         sessions[index] = {
           ...sessions[index],
           title: title,
           date: date,
           time: time,
           duration: duration,
           instructor: instructor,
           topic: topic,
           notes: notes,
           updatedAt: new Date().toISOString()
         };
         
         saveSessions();
         renderSessionsList();
         
         // إعادة تعيين النموذج
         titleInput.value = '';
         dateInput.value = '';
         timeInput.value = '';
         durationInput.value = '';
         instructorInput.value = '';
         topicTextarea.value = '';
         notesTextarea.value = '';
         
         // إعادة تعيين الزر
         const addBtn = document.querySelector('button[onclick="updateSession(' + index + ')"]');
         addBtn.textContent = 'إضافة جلسة';
         addBtn.onclick = addSession;
         
         showToast('تم تحديث الجلسة بنجاح', 'success');
       }
       
       // حذف جلسة
       function deleteSession(index) {
        if (confirm('هل أنت متأكد من حذف هذه الجلسة؟')) {
          sessions.splice(index, 1);
          saveSessions();
          renderSessionsList();
          showToast('تم حذف الجلسة بنجاح', 'success');
        }
      }
      
             // تصدير الجلسات إلى CSV
       function exportSessionsToCSV() {
         if (sessions.length === 0) {
           showToast('لا توجد جلسات للتصدير', 'warning');
           return;
         }
         
         const headers = ['العنوان', 'التاريخ', 'الوقت', 'المدة', 'المدرب', 'الموضوع', 'الملاحظات'];
         const csvContent = [
           headers.join(','),
           ...sessions.map(session => [
             session.title,
             new Date(session.date).toLocaleDateString('ar-SA'),
             session.time,
             session.duration,
             session.instructor,
             session.topic || '',
             session.notes || ''
           ].join(','))
         ].join('\n');
         
         downloadCSV(csvContent, 'الجلسات');
         showToast('تم تصدير الجلسات بنجاح', 'success');
       }
       
       // تقرير الجلسات
       function generateSessionReport() {
         if (sessions.length === 0) {
           showToast('لا توجد جلسات لتوليد التقرير', 'warning');
           return;
         }
         
         const report = `تقرير الجلسات\n\n`;
         const totalSessions = sessions.length;
         const totalDuration = sessions.reduce((sum, session) => sum + session.duration, 0);
         const instructors = [...new Set(sessions.map(s => s.instructor))];
         
         const reportContent = `
تقرير الجلسات - ${new Date().toLocaleDateString('ar-SA')}

إحصائيات عامة:
- إجمالي الجلسات: ${totalSessions}
- إجمالي الساعات: ${Math.round(totalDuration / 60 * 10) / 10} ساعة
- عدد المدربين: ${instructors.length}

تفاصيل الجلسات:
${sessions.map((session, index) => `
${index + 1}. ${session.title}
   التاريخ: ${new Date(session.date).toLocaleDateString('ar-SA')}
   الوقت: ${session.time}
   المدة: ${session.duration} دقيقة
   المدرب: ${session.instructor}
   الموضوع: ${session.topic || 'غير محدد'}
`).join('\n')}
المدربون المشاركون:
${instructors.map(instructor => `- ${instructor}`).join('\n')}
         `;
         
                  showReportModal('تقرير الجلسات', reportContent);
       }
      
      // دوال الإحصائيات والتقارير
      function updateStatistics() {
        // تحديث إحصائيات الطالبات
        document.getElementById('totalStudents').textContent = students.length;
        
        // تحديث إحصائيات الجلسات
        document.getElementById('totalSessions').textContent = sessions.length;
        
        // تحديث معدل الحضور (مثال بسيط)
        const attendanceRate = students.length > 0 ? Math.round((students.filter(s => s.attendanceCount > 0).length / students.length) * 100) : 0;
        document.getElementById('attendanceRate').textContent = attendanceRate + '%';
        
        // تحديث الجداول النشطة
        document.getElementById('activeSchedules').textContent = schedules.length;
      }
      
      // دوال التقارير
      function generateDailyReport() {
        const today = new Date().toLocaleDateString('ar-SA');
        const report = `تقرير الحضور اليومي - ${today}\n\n`;
        showReportModal('تقرير الحضور اليومي', report);
      }
      
      function generateWeeklyReport() {
        const report = 'تقرير الأسبوع الحالي\n\n';
        showReportModal('تقرير الأسبوع', report);
      }
      
      function generateMonthlyReport() {
        const report = 'تقرير الشهر الحالي\n\n';
        showReportModal('تقرير الشهر', report);
      }
      
      function generateStudentsReport() {
        const report = `تقرير الطالبات\nإجمالي الطالبات: ${students.length}\n\n`;
        showReportModal('تقرير الطالبات', report);
      }
      
      function generateFullReport() {
        const report = `التقرير الشامل\n\n`;
        showReportModal('التقرير الشامل', report);
      }
      
             // عرض التقرير في نافذة منبثقة
       function showReportModal(title, content) {
         const modal = document.createElement('div');
         modal.className = 'modal-overlay';
         modal.style.cssText = `
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           display: flex;
           align-items: center;
           justify-content: center;
           z-index: 10000;
         `;
         
         modal.innerHTML = `
           <div class="modal-content" style="background: white; border-radius: 10px; padding: 20px; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;">
             <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
               <h3 style="margin: 0; color: #BD9750;">${title}</h3>
               <button class="modal-close-btn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
             </div>
             <pre style="white-space: pre-wrap; font-family: inherit; background: #f8f9fa; padding: 15px; border-radius: 5px;">${content}</pre>
             <div style="text-align: center; margin-top: 20px;">
               <button onclick="downloadReport('${title}', '${content}')" class="form-btn blue-btn">تحميل التقرير</button>
               <button class="modal-close-btn form-btn red-btn">إغلاق</button>
             </div>
           </div>
         `;
         
         // إضافة مستمعي الأحداث للإغلاق
         modal.addEventListener('click', function(e) {
           if (e.target === modal) {
             modal.remove();
           }
         });
         
         const closeButtons = modal.querySelectorAll('.modal-close-btn');
         closeButtons.forEach(btn => {
           btn.addEventListener('click', function() {
             modal.remove();
           });
         });
         
         // إغلاق عند الضغط على ESC
         const handleEsc = function(e) {
           if (e.key === 'Escape') {
             modal.remove();
             document.removeEventListener('keydown', handleEsc);
           }
         };
         document.addEventListener('keydown', handleEsc);
         
         document.body.appendChild(modal);
       }
      
             // تحميل التقرير
       function downloadReport(title, content) {
         const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `${title}_${new Date().toISOString().split('T')[0]}.txt`;
         a.click();
         URL.revokeObjectURL(url);
       }
       
       // دالة مساعدة لتحميل CSV
       function downloadCSV(content, filename) {
         const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
         a.click();
         URL.revokeObjectURL(url);
       }
      
      
         
         // إضافة مستمعي الأحداث 
        
      

      
             // دالة مساعدة لتحميل CSV
       function downloadCSV(content, filename) {
         const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
         a.click();
         URL.revokeObjectURL(url);
       }
       
       // دالة مساعدة لعرض رسائل Toast
       function showToast(message, type = 'info') {
         const toast = document.createElement('div');
         toast.style.cssText = `
           position: fixed;
           top: 20px;
           right: 20px;
           background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
           color: white;
           padding: 12px 20px;
           border-radius: 5px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.2);
           z-index: 10001;
           max-width: 300px;
           word-wrap: break-word;
           animation: slideIn 0.3s ease-out;
         `;
         
         toast.textContent = message;
         document.body.appendChild(toast);
         
         setTimeout(() => {
           toast.style.animation = 'slideOut 0.3s ease-in';
           setTimeout(() => {
             if (toast.parentNode) {
               toast.parentNode.removeChild(toast);
             }
           }, 300);
         }, 3000);
       }
       
       // إضافة أنماط CSS للرسائل
       const style = document.createElement('style');
       style.textContent = `
         @keyframes slideIn {
           from { transform: translateX(100%); opacity: 0; }
           to { transform: translateX(0); opacity: 1; }
         }
         @keyframes slideOut {
           from { transform: translateX(0); opacity: 1; }
           to { transform: translateX(100%); opacity: 0; }
         }
         
         /* أنماط النوافذ المنبثقة */
         .modal-overlay {
           animation: fadeIn 0.3s ease-out;
         }
         
         .modal-content {
           animation: slideInModal 0.3s ease-out;
         }
         
         @keyframes fadeIn {
           from { opacity: 0; }
           to { opacity: 1; }
         }
         
         @keyframes slideInModal {
           from { transform: scale(0.8); opacity: 0; }
           to { transform: scale(1); opacity: 1; }
         }
         
         .modal-close-btn:hover {
           color: #BD9750 !important;
           transform: scale(1.1);
           transition: all 0.2s;
         }
       `;
       document.head.appendChild(style);
      
             // تحميل جميع البيانات عند تحميل الصفحة
       document.addEventListener('DOMContentLoaded', function() {
         loadStudents();
         loadAdmins();
         loadCustomColumns();
         loadSchedules();
         loadSessions();
         updateStatistics();
         
         // تفعيل أزرار الأعمدة المخصصة
         const addCustomColumnBtn = document.getElementById('addCustomColumnBtn');
         if (addCustomColumnBtn) {
           addCustomColumnBtn.onclick = addCustomColumn;
         }
         
         // تفعيل أزرار الجداول الزمنية
         const addScheduleBtn = document.querySelector('button[onclick="addSchedule()"]');
         if (addScheduleBtn) {
           addScheduleBtn.onclick = addSchedule;
         }
         
         // تفعيل أزرار الجلسات
         const addSessionBtn = document.querySelector('button[onclick="addSession()"]');
         if (addSessionBtn) {
           addSessionBtn.onclick = addSession;
         }
         
         

       });

      // إضافة مشرف جديد
      function addAdmin() {
        const usernameInput = document.getElementById('newAdminUsername');
        const passwordInput = document.getElementById('newAdminPassword');
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username || !password) {
          showToast('يرجى إدخال اسم المستخدم وكلمة المرور', 'error');
          if (!username) usernameInput.focus();
          else passwordInput.focus();
          return;
        }
        
        if (password.length < 6) {
          showToast('كلمة المرور يجب أن تكون 6 أحرف على الأقل', 'warning');
          passwordInput.focus();
          return;
        }
        
        // التحقق من عدم تكرار اسم المستخدم
        if (admins.some(admin => admin.username.toLowerCase() === username.toLowerCase())) {
          showToast('اسم المستخدم موجود مسبقاً', 'warning');
          usernameInput.focus();
          return;
        }
        
        const newAdmin = {
          username: username,
          password: password,
          addedAt: new Date().toISOString(),
          id: Date.now() + Math.random()
        };
        
        admins.push(newAdmin);
        saveAdmins();
        renderAdminsList();
        
        usernameInput.value = '';
        passwordInput.value = '';
        showToast(`تم إضافة المشرف "${username}" بنجاح`, 'success');
        usernameInput.focus();
      }
      
      // تعديل مشرف
      function editAdmin(index) {
        const admin = admins[index];
        const newUsername = prompt('اسم المستخدم الجديد:', admin.username);
        if (newUsername === null) return; // تم إلغاء العملية
        
        const newPassword = prompt('كلمة المرور الجديدة (اتركها فارغة إذا لم ترد تغييرها):', '');
        if (newUsername.trim() === '') {
          showToast('اسم المستخدم لا يمكن أن يكون فارغاً', 'error');
          return;
        }
        
        // التحقق من عدم تكرار اسم المستخدم
        if (admins.some((admin, i) => i !== index && admin.username.toLowerCase() === newUsername.toLowerCase())) {
          showToast('اسم المستخدم موجود مسبقاً', 'warning');
          return;
        }
        
        admin.username = newUsername.trim();
        if (newPassword.trim() !== '') {
          if (newPassword.length < 6) {
            showToast('كلمة المرور يجب أن تكون 6 أحرف على الأقل', 'warning');
            return;
          }
          admin.password = newPassword;
        }
        
        saveAdmins();
        renderAdminsList();
        showToast(`تم تحديث بيانات المشرف "${admin.username}" بنجاح`, 'success');
      }
      
             // تعديل مشرف
       function editAdmin(index) {
         const admin = admins[index];
         
         // إنشاء نافذة منبثقة للتعديل
         const modal = document.createElement('div');
         modal.className = 'modal-overlay';
         modal.style.cssText = `
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           display: flex;
           align-items: center;
           justify-content: center;
           z-index: 10000;
         `;
         
         modal.innerHTML = `
           <div class="modal-content" style="background: white; border-radius: 10px; padding: 20px; max-width: 400px; width: 90%;">
             <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
               <h3 style="margin: 0; color: #BD9750;">تعديل المشرف</h3>
               <button class="modal-close-btn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
             </div>
             <div class="form-group">
               <label class="form-label">اسم المستخدم:</label>
               <input type="text" id="editAdminUsername" class="form-input" value="${admin.username}">
             </div>
             <div class="form-group">
               <label class="form-label">كلمة المرور الجديدة:</label>
               <input type="password" id="editAdminPassword" class="form-input" placeholder="اتركها فارغة إذا لم ترد تغييرها">
             </div>
             <div style="text-align: center; margin-top: 20px;">
               <button onclick="saveAdminEdit(${index})" class="form-btn green-btn">حفظ التغييرات</button>
               <button class="modal-close-btn form-btn red-btn">إلغاء</button>
             </div>
           </div>
         `;
         
         // إضافة مستمعي الأحداث للإغلاق
         modal.addEventListener('click', function(e) {
           if (e.target === modal) {
             modal.remove();
           }
         });
         
         const closeButtons = modal.querySelectorAll('.modal-close-btn');
         closeButtons.forEach(btn => {
           btn.addEventListener('click', function() {
             modal.remove();
           });
         });
         
         // إغلاق عند الضغط على ESC
         const handleEsc = function(e) {
           if (e.key === 'Escape') {
             modal.remove();
             document.removeEventListener('keydown', handleEsc);
           }
         };
         document.addEventListener('keydown', handleEsc);
         
         document.body.appendChild(modal);
       }
       
       // حفظ تعديل المشرف
       function saveAdminEdit(index) {
         const usernameInput = document.getElementById('editAdminUsername');
         const passwordInput = document.getElementById('editAdminPassword');
         const username = usernameInput.value.trim();
         const password = passwordInput.value.trim();
         
         if (!username) {
           showToast('يرجى إدخال اسم المستخدم', 'error');
           usernameInput.focus();
           return;
         }
         
         // التحقق من عدم تكرار اسم المستخدم (باستثناء المشرف الحالي)
         if (admins.some((admin, i) => i !== index && admin.username.toLowerCase() === username.toLowerCase())) {
           showToast('اسم المستخدم موجود مسبقاً', 'warning');
           usernameInput.focus();
           return;
         }
         
         // تحديث المشرف
         admins[index] = {
           ...admins[index],
           username: username,
           password: password || admins[index].password, // الاحتفاظ بكلمة المرور القديمة إذا لم يتم تغييرها
           updatedAt: new Date().toISOString()
         };
         
         saveAdmins();
         renderAdminsList();
         
         // إغلاق النافذة المنبثقة
         const modal = document.querySelector('.modal-overlay');
         if (modal) {
           modal.remove();
         }
         
         showToast('تم تحديث المشرف بنجاح', 'success');
       }
       
       // حذف مشرف
       function deleteAdmin(index) {
        const admin = admins[index];
        if (admins.length <= 1) {
          showToast('يجب أن يبقى مشرف واحد على الأقل', 'warning');
          return;
        }
        
        if (confirm(`هل أنت متأكد من حذف المشرف "${admin.username}"؟`)) {
          admins.splice(index, 1);
          saveAdmins();
          renderAdminsList();
          showToast(`تم حذف المشرف "${admin.username}" بنجاح`, 'success');
        }
      }
      
      // تصدير قائمة المشرفين إلى CSV
      function exportAdminsToCSV() {
        if (admins.length === 0) {
          showToast('لا يوجد مشرفين للتصدير', 'warning');
          return;
        }
        
        const csvContent = [
          'اسم المستخدم,تاريخ الإضافة',
          ...admins.map(admin => 
            `"${admin.username}","${new Date(admin.addedAt).toLocaleDateString('ar-SA')}"`
          )
        ].join('\n');
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `قائمة_المشرفين_${new Date().toLocaleDateString('ar-SA')}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('تم تصدير قائمة المشرفين بنجاح', 'success');
      }
      
      // تحسين دالة تسجيل دخول الإدارة
      function adminLogin() {
        const username = document.getElementById('adminUser').value.trim();
        const password = document.getElementById('adminPass').value.trim();
        
        if (!username || !password) {
          showToast('يرجى إدخال اسم المستخدم وكلمة المرور', 'error');
          return;
        }
        
        // البحث في قائمة المشرفين
        const admin = admins.find(a => a.username === username && a.password === password);
        
        if (admin) {
          // تسجيل الدخول بنجاح
          document.getElementById('adminPanel').style.display = 'block';
          document.getElementById('adminSection').style.display = 'none';
          showToast('تم تسجيل الدخول بنجاح', 'success');
          
          // مسح حقول تسجيل الدخول
          document.getElementById('adminUser').value = '';
          document.getElementById('adminPass').value = '';
          
          // تحميل البيانات
          loadStudents();
          loadAdmins();
        } else {
          showToast('اسم المستخدم أو كلمة المرور غير صحيحة', 'error');
        }
      }
      
      // تفعيل الأزرار عند تحميل الصفحة
      document.addEventListener('DOMContentLoaded', function() {
        loadAdmins();
        
        // تفعيل زر إضافة مشرف
        const addAdminBtn = document.getElementById('addAdminBtn');
        if (addAdminBtn) {
          addAdminBtn.onclick = addAdmin;
        }
        
        // تفعيل زر تسجيل دخول الإدارة
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        if (adminLoginBtn) {
          adminLoginBtn.onclick = adminLogin;
        }
        
        // تفعيل إدخال المشرف عند الضغط على Enter
        const newAdminUsername = document.getElementById('newAdminUsername');
        const newAdminPassword = document.getElementById('newAdminPassword');
        
        if (newAdminUsername) {
          newAdminUsername.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              addAdmin();
            }
          });
        }
        
        if (newAdminPassword) {
          newAdminPassword.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              addAdmin();
            }
          });
        }
      });
      </script>

      <!-- عرض سجلات الحضور -->
      <div class="admin-section">
        <h3>سجلات الحضور والانصراف</h3>
        
        <!-- فلتر التاريخ -->
        <div class="form-group">
          <label for="attendanceFilterDate" class="form-label">فلتر حسب التاريخ:</label>
          <input type="date" id="attendanceFilterDate" class="form-input">
        </div>
        
        <div id="attendanceListFiltered">
          <!-- ستظهر سجلات الحضور المفلترة هنا -->
        </div>
        
        <!-- ملخص الحضور -->
        <div class="attendance-summary" id="attendanceSummary">
          <!-- سيظهر ملخص الحضور هنا -->
        </div>
        
        <div class="students-list" id="attendanceList">
          <!-- ستظهر سجلات الحضور هنا -->
        </div>
        <button type="button" id="exportBtn" class="export-btn">تصدير البيانات PDF</button>
      </div>
      <!-- ملخص الحلقة (جديد) مع خيارات التخصيص -->
      <div class="admin-section" id="sessionSummarySection">
        <h3>ملخص الحلقة</h3>
        
        <!-- أزرار الحقول المخصصة -->
        <div class="summary-fields-container">
          <h4>حقول الملخص</h4>
          
          <!-- حقل الحضور -->
          <div class="summary-field-row">
            <label class="field-label">حضور:</label>
            <div class="field-controls">
              <input type="text" class="field-text" placeholder="حضور" value="حضور">
              <select class="field-font">
                <option value="'Cairo', sans-serif">Cairo</option>
                <option value="'Amiri', serif">Amiri</option>
                <option value="'Tajawal', sans-serif">Tajawal</option>
                <option value="'Almarai', sans-serif">Almarai</option>
              </select>
              <select class="field-size">
                <option value="0.9rem">صغير</option>
                <option value="1rem" selected>متوسط</option>
                <option value="1.1rem">كبير</option>
                <option value="1.2rem">كبير جداً</option>
              </select>
              <input type="color" class="field-color" value="#BD9750">
              <select class="field-weight">
                <option value="300">خفيف</option>
                <option value="400" selected>عادي</option>
                <option value="600">متوسط</option>
                <option value="700">عريض</option>
              </select>
            </div>
          </div>
          
          <!-- حقل اليوم والتاريخ -->
          <div class="summary-field-row">
            <label class="field-label">اليوم والتاريخ:</label>
            <div class="field-controls">
              <input type="text" class="field-text" placeholder="السبت، ١٢ يوليو ٢٠٢٥" value="السبت، ١٢ يوليو ٢٠٢٥">
              <select class="field-font">
                <option value="'Cairo', sans-serif">Cairo</option>
                <option value="'Amiri', serif">Amiri</option>
                <option value="'Tajawal', sans-serif">Tajawal</option>
                <option value="'Almarai', sans-serif">Almarai</option>
              </select>
              <select class="field-size">
                <option value="0.9rem">صغير</option>
                <option value="1rem" selected>متوسط</option>
                <option value="1.1rem">كبير</option>
                <option value="1.2rem">كبير جداً</option>
              </select>
              <input type="color" class="field-color" value="#2c3e50">
              <select class="field-weight">
                <option value="300">خفيف</option>
                <option value="400" selected>عادي</option>
                <option value="600">متوسط</option>
                <option value="700">عريض</option>
              </select>
            </div>
          </div>
          
          <!-- حقل رقم المحاضرة -->
          <div class="summary-field-row">
            <label class="field-label">رقم المحاضرة:</label>
            <div class="field-controls">
              <input type="text" class="field-text" placeholder="المحاضرة رقم" value="المحاضرة رقم">
              <select class="field-font">
                <option value="'Cairo', sans-serif">Cairo</option>
                <option value="'Amiri', serif">Amiri</option>
                <option value="'Tajawal', sans-serif">Tajawal</option>
                <option value="'Almarai', sans-serif">Almarai</option>
              </select>
              <select class="field-size">
                <option value="0.9rem">صغير</option>
                <option value="1rem" selected>متوسط</option>
                <option value="1.1rem">كبير</option>
                <option value="1.2rem">كبير جداً</option>
              </select>
              <input type="color" class="field-color" value="#2c3e50">
              <select class="field-weight">
                <option value="300">خفيف</option>
                <option value="400" selected>عادي</option>
                <option value="600">متوسط</option>
                <option value="700">عريض</option>
              </select>
            </div>
          </div>
          
          <!-- حقل عنوان الحلقة -->
          <div class="summary-field-row">
            <label class="field-label">عنوان الحلقة:</label>
            <div class="field-controls">
              <input type="text" class="field-text" placeholder="عنوان الحلقة" value="عنوان الحلقة">
              <select class="field-font">
                <option value="'Cairo', sans-serif">Cairo</option>
                <option value="'Amiri', serif">Amiri</option>
                <option value="'Tajawal', sans-serif">Tajawal</option>
                <option value="'Almarai', sans-serif">Almarai</option>
              </select>
              <select class="field-size">
                <option value="0.9rem">صغير</option>
                <option value="1rem" selected>متوسط</option>
                <option value="1.1rem">كبير</option>
                <option value="1.2rem">كبير جداً</option>
              </select>
              <input type="color" class="field-color" value="#BD9750">
              <select class="field-weight">
                <option value="300">خفيف</option>
                <option value="400" selected>عادي</option>
                <option value="600">متوسط</option>
                <option value="700">عريض</option>
              </select>
            </div>
          </div>
          
          <!-- حقل خانة إضافية -->
          <div class="summary-field-row">
            <label class="field-label">خانة إضافية:</label>
            <div class="field-controls">
              <input type="text" class="field-text" placeholder="خانة إضافية" value="خانة إضافية">
              <select class="field-font">
                <option value="'Cairo', sans-serif">Cairo</option>
                <option value="'Amiri', serif">Amiri</option>
                <option value="'Tajawal', sans-serif">Tajawal</option>
                <option value="'Almarai', sans-serif">Almarai</option>
              </select>
              <select class="field-size">
                <option value="0.9rem">صغير</option>
                <option value="1rem" selected>متوسط</option>
                <option value="1.1rem">كبير</option>
                <option value="1.2rem">كبير جداً</option>
              </select>
              <input type="color" class="field-color" value="#6c757d">
              <select class="field-weight">
                <option value="300">خفيف</option>
                <option value="400" selected>عادي</option>
                <option value="600">متوسط</option>
                <option value="700">عريض</option>
              </select>
            </div>
          </div>
        </div>
        
        <button type="button" id="saveSummaryFieldsBtn" class="admin-btn blue-btn" onclick="saveSummaryFields()">حفظ إعدادات الحقول</button>
        
        <!-- معاينة الحقول -->
        <div class="summary-preview">
          <h4>معاينة الحقول</h4>
          <div class="preview-container">
            <div class="preview-field" id="previewAttendance">حضور</div>
            <div class="preview-field" id="previewDate">السبت، ١٢ يوليو ٢٠٢٥</div>
            <div class="preview-field" id="previewLecture">المحاضرة رقم</div>
            <div class="preview-field" id="previewTitle">عنوان الحلقة</div>
            <div class="preview-field" id="previewExtra">خانة إضافية</div>
          </div>
        </div>
        
        <!-- إعدادات عرض ملخص الحلقة للطلاب -->
        <div class="summary-display-settings">
          <h4>إعدادات العرض للطلاب</h4>
          
          <div class="form-group">
            <label class="form-label">إظهار ملخص الحلقة للطلاب:</label>
            <select id="summaryVisibleToStudents" class="form-input">
              <option value="false">لا (افتراضي)</option>
              <option value="true">نعم</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">نوع قائمة الأسماء المعروضة للطلاب:</label>
            <select id="summaryNamesType" class="form-input">
              <option value="all">كل من سجل حضور أو انصراف</option>
              <option value="attendanceOnly">سجل حضور فقط</option>
              <option value="departureOnly">سجل انصراف فقط</option>
              <option value="noRecord">بدون سجل</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">الأعمدة الظاهرة للطلاب:</label>
            <select id="studentSummaryColumns" class="form-input">
              <option value="name">اسم الطالبة فقط</option>
              <option value="name-type">اسم الطالبة + النوع</option>
              <option value="name-attendance">اسم الطالبة + حضور</option>
              <option value="name-departure">اسم الطالبة + انصراف</option>
              <option value="name-both">اسم الطالبة + حضور + انصراف</option>
              <option value="all">جميع الأعمدة</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">تنبيهات وملاحظات للطلاب:</label>
            <textarea id="sessionWarnings" class="form-input" placeholder="اكتب هنا أي تنبيهات أو ملاحظات تريد إظهارها للطلاب تحت الجدول" rows="3" style="resize: vertical;"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">إظهار حقل التنبيهات للطلاب:</label>
            <select id="showWarningsToStudents" class="form-input">
              <option value="false">لا</option>
              <option value="true" selected>نعم</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">إظهار قائمة ملخصات الحلقات للطلاب:</label>
            <select id="showSessionHistoryToStudents" class="form-input">
              <option value="false" selected>لا (ملخص اليوم فقط)</option>
              <option value="true">نعم (جميع الملخصات)</option>
            </select>
          </div>
          
          <button type="button" id="saveSummaryDisplayBtn" class="admin-btn green-btn" onclick="saveSummaryDisplaySettings()">حفظ إعدادات العرض للطلاب</button>
        </div>
        
        <!-- إعدادات عرض ملخص الحلقة للإدارة -->
        <div class="summary-admin-settings">
          <h4>إعدادات العرض للإدارة</h4>
          
          <div class="form-group">
            <label class="form-label">إظهار ملخص الحلقة للإدارة:</label>
            <select id="summaryVisibleToAdmin" class="form-input">
              <option value="true" selected>نعم (افتراضي)</option>
              <option value="false">لا</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">نوع قائمة الأسماء المعروضة للإدارة:</label>
            <select id="summaryNamesTypeAdmin" class="form-input">
              <option value="all" selected>كل من سجل حضور أو انصراف</option>
              <option value="attendanceOnly">سجل حضور فقط</option>
              <option value="departureOnly">سجل انصراف فقط</option>
              <option value="noRecord">بدون سجل</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">الأعمدة الظاهرة في ملخص الإدارة:</label>
            <select id="adminSummaryColumns" class="form-input">
              <option value="name">اسم الطالبة فقط</option>
              <option value="name-type">اسم الطالبة + النوع</option>
              <option value="name-attendance">اسم الطالبة + حضور</option>
              <option value="name-departure">اسم الطالبة + انصراف</option>
              <option value="name-both" selected>اسم الطالبة + حضور+انصراف</option>
              <option value="all">جميع الأعمدة</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">إظهار حقل التنبيهات للإدارة:</label>
            <select id="showWarningsToAdmin" class="form-input">
              <option value="true" selected>نعم</option>
              <option value="false">لا</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">إظهار زر تصدير PDF:</label>
            <select id="showExportPDFBtn" class="form-input">
              <option value="true" selected>نعم</option>
              <option value="false">لا</option>
            </select>
          </div>
          
          <button type="button" id="saveSummaryAdminBtn" class="admin-btn blue-btn" onclick="saveSummaryAdminSettings()">حفظ إعدادات العرض للإدارة</button>
        </div>
      </div>

      <!-- خيارات عرض الملخص للطلاب والإدارة -->
      <div class="admin-section" id="summaryOptionsSection">
        <h3>خيارات عرض الملخص للطلاب والإدارة</h3>
        <div class="form-group">
          <label class="form-label">إظهار الملخص للطلاب:</label>
          <select id="summaryVisibleToStudents" class="form-input">
            <option value="false">لا (افتراضي)</option>
            <option value="true">نعم</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">نوع قائمة الأسماء المعروضة:</label>
          <select id="summaryNamesType" class="form-input">
            <option value="all">كل من سجل حضور أو انصراف</option>
            <option value="attendanceOnly">سجل حضور فقط</option>
            <option value="departureOnly">سجل انصراف فقط</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">الأعمدة الظاهرة للطلاب:</label>
          <select id="studentSummaryColumns" class="form-input">
            <option value="name">اسم الطالبة فقط</option>
            <option value="name-type">اسم الطالبة + النوع</option>
            <option value="name-attendance">اسم الطالبة + حضور</option>
            <option value="name-departure">اسم الطالبة + انصراف</option>
            <option value="name-both">اسم الطالبة + حضور + انصراف</option>
            <option value="all">جميع الأعمدة</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">الأعمدة الظاهرة في ملخص الإدارة:</label>
          <select id="adminSummaryColumns" class="form-input">
            <option value="name">اسم الطالبة فقط</option>
            <option value="name-type">اسم الطالبة + النوع</option>
            <option value="name-attendance">اسم الطالبة + حضور</option>
            <option value="name-departure">اسم الطالبة + انصراف</option>
            <option value="name-both">اسم الطالبة + حضور+انصراف</option>
            <option value="all">جميع الأعمدة</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">إظهار حقل التنبيهات للطلاب:</label>
          <select id="showWarningsToStudents" class="form-input">
            <option value="false">لا</option>
            <option value="true">نعم</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">إظهار قائمة ملخصات الحلقات للطلاب:</label>
          <select id="showSessionHistoryToStudents" class="form-input">
            <option value="false">لا (ملخص اليوم فقط)</option>
            <option value="true">نعم (جميع الملخصات)</option>
          </select>
        </div>
        <button type="button" id="saveSummaryOptionsBtn" class="form-btn blue-btn">حفظ الخيارات</button>
      </div>

      <!-- إدارة ملخصات الحلقات التاريخية -->
      <div class="admin-section">
        <h3>إدارة ملخصات الحلقات التاريخية</h3>
        <div class="form-group">
          <label class="form-label">حفظ ملخص اليوم الحالي:</label>
          <button type="button" id="saveCurrentSessionBtn" class="form-btn green-btn">حفظ ملخص اليوم</button>
        </div>
        <div class="form-group">
          <label class="form-label">عرض ملخص تاريخي:</label>
          <select id="sessionHistorySelect" class="form-input">
            <option value="">اختر ملخص لعرضه</option>
          </select>
        </div>
        <div id="sessionHistoryPreview" style="display: none;">
          <!-- سيظهر هنا ملخص الحلقة المختار -->
        </div>
      </div>

      <!-- إدارة سجلات الحضور (إضافة/تعديل/حذف) -->
      <div class="admin-section">
        <h3>إدارة سجلات الحضور والانصراف</h3>
        
        <!-- إضافة سجل جديد -->
        <div class="form-group">
          <label class="form-label">إضافة سجل جديد:</label>
          <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="adminNewStudentName" class="form-input" placeholder="اسم الطالبة" style="flex: 1; min-width: 200px;">
            <select id="adminNewRecordType" class="form-input" style="min-width: 120px;">
              <option value="checkin">حضور</option>
              <option value="checkout">انصراف</option>
            </select>
            <input type="time" id="adminNewRecordTime" class="form-input" style="min-width: 120px;">
            <button type="button" id="adminAddRecordBtn" class="form-btn green-btn">إضافة سجل</button>
          </div>
        </div>

        <!-- معاينة ملخص الطلاب مع إدارة السجلات -->
        <div class="admin-summary-preview-box">
          <div id="adminSummaryWarning" style="display:none; background:#fff3cd; color:#856404; border:1.5px solid #ffeaa7; border-radius:8px; padding:12px 18px; margin-bottom:12px; font-weight:bold; font-size:1.08rem; text-align:center;"></div>
          <h4 style="text-align: center; color: #BD9750; margin-bottom: 15px;">معاينة ملخص الطلاب</h4>
          <div id="adminStudentSummaryPreview">
            <!-- سيظهر ملخص الحلقة هنا -->
          </div>
          <div id="adminStudentNamesPreview">
            <!-- سيظهر جدول الأسماء مع أزرار الإدارة هنا -->
          </div>
          <div style="text-align: center; margin-top: 15px;">
            <button type="button" id="exportStudentSummaryBtn" class="form-btn blue-btn">تصدير الملخص PDF</button>
          </div>
        </div>
      </div>

      <!-- أضف في لوحة الإدارة (قبل نهاية admin-panel) -->
      <button type="button" id="logoutBtn" class="logout-btn">تسجيل الخروج</button>
    </div>

    <!-- ====== الفوتر الجديد ====== -->
    <footer class="afnan-footer">
      <div class="footer-content">
        <div class="footer-hadith-container">
          <div class="footer-hadith-title">قال رسول الله صلى الله عليه وسلم</div>
          <div class="footer-hadith-text">خيركم من تعلم القرآن وعلمه</div>
          <div class="footer-narrator">رواه البخاري</div>
        </div>
        <div class="footer-academy-info">
          <div class="footer-logo">
            <div class="footer-logo-icon">📖</div>
            <div class="footer-logo-text">أكاديمية أفنان</div>
          </div>
          <div class="footer-copyright">جميع الحقوق محفوظة © أكاديمية أفنان لتعليم القرآن وعلومه ٢٠٢٢
            
          </div>
        </div>
      </div>
    </footer>
    <!-- ====== نهاية الفوتر ====== -->
  </div>

  <!-- زر الدعم الفني -->
  <a class="support-btn" href="https://t.me/+201559196041" target="_blank" title="تواصل معنا" rel="noopener">
    <i class="fab fa-telegram-plane"></i>
    <div class="support-tooltip">تواصل معنا</div>
  </a>

  <!-- القائمة المنسدلة للموبايل -->
  <div id="mobileSideMenu" class="mobile-side-menu">
    <div class="mobile-side-menu-overlay" id="mobileSideMenuOverlay"></div>
    <div class="mobile-side-menu-content">
      <div class="mobile-side-menu-header">
        <img src="logo-afnan.png" alt="Afnan Academy Logo" class="mobile-side-menu-logo" />
        <button class="mobile-side-menu-close" id="mobileSideMenuClose">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <nav class="mobile-side-menu-nav">
        <ul class="mobile-side-menu-list">
          <li><a href="index.html" class="mobile-side-menu-link" id="mobileHomeLink">
            <i class="fas fa-home"></i>
            <span>الصفحة الرئيسية</span>
          </a></li>
          <!-- روابط غير نشطة -->
          <li><a href="#" class="mobile-side-menu-link disabled-link" id="mobileAboutLink">
            <i class="fas fa-mosque"></i>
            <span>أكاديمية أفنان</span>
          </a></li>
          <li><a href="#" class="mobile-side-menu-link disabled-link" id="mobileProgramsLink">
            <i class="fas fa-book-open"></i>
            <span>حلقات التجويد</span>
          </a></li>
          <li>
            <a href="#" class="mobile-side-menu-link" id="mobileHomeworkLink" onclick="toggleMobileHomeworkMenu()">
              <i class="fas fa-tasks"></i>
              <span>الواجبات</span>
            </a>
            <div class="mobile-homework-submenu" id="mobileHomeworkSubmenu">
              <a href="#" onclick="showHomeworkLevel('level2-batch1'); closeMobileMenu();">المستوى الثاني الدُفعة الأولى</a>
              <a href="#" onclick="showHomeworkLevel('level1-batch2'); closeMobileMenu();">المستوى الأول الدُفعة الثانية</a>
              <a href="#" onclick="showHomeworkLevel('level1-batch3'); closeMobileMenu();">المستوى الأول الدُفعة الثالثة</a>
            </div>
          </li>
          <li><a href="https://t.me/+201559196041" target="_blank" class="mobile-side-menu-link" id="mobileContactLink">
            <i class="fab fa-telegram-plane"></i>
            <span>تواصل معنا</span>
          </a></li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- شريط أيقونات سفلي للموبايل فقط -->
  <div class="afnan-bottom-navbar">
    <a class="bottom-nav-btn" href="https://t.me/+201559196041" target="_blank"><i class="fab fa-telegram-plane"></i><span>مساعدة</span></a>
    <button class="bottom-nav-btn" id="mobileFavBtn"><i class="fas fa-heart"></i><span>المفضلة</span></button>
    <button class="bottom-nav-btn" id="mobileHomeBtn"><i class="fas fa-home"></i><span>الرئيسية</span></button>
    <button class="bottom-nav-btn" id="mobileHomeworkBtn"><i class="fas fa-tasks"></i><span>الواجبات</span></button>
    <button class="bottom-nav-btn" id="mobileLangBtn"><i class="fas fa-globe"></i><span>اللغة</span></button>
    <button class="bottom-nav-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i><span>القائمة</span></button>
  </div>
  <style>
  .afnan-bottom-navbar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 8px 0;
    gap: 5px;
    background: white;
    border-top: 1px solid #e5e0d3;
  }
  
  .afnan-bottom-navbar .bottom-nav-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px 4px;
    font-size: 0.75rem;
    background: none;
    border: none;
    cursor: pointer;
    color: #8B6F2F;
    transition: color 0.2s;
  }
  
  .afnan-bottom-navbar .bottom-nav-btn:hover {
    color: #BD9750;
  }
  
  /* إخفاء الشريط السفلي على الديسكتوب */
  @media (min-width: 768px) {
    .afnan-bottom-navbar {
      display: none !important;
    }
  }
  
  /* تحسين الشريط السفلي للهاتف */
  @media (max-width: 767px) {
    .afnan-bottom-navbar {
      position: fixed !important;
      bottom: 0 !important;
      left: 0 !important;
      right: 0 !important;
      width: 100vw !important;
      max-width: 100vw !important;
      z-index: 999 !important;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
      box-sizing: border-box !important;
      padding: 8px 0 !important;
      margin: 0 !important;
    }
    
    .afnan-bottom-navbar .bottom-nav-btn {
      flex: 1 !important;
      min-width: 0 !important;
      max-width: none !important;
      padding: 8px 4px !important;
      font-size: 0.75rem !important;
      text-align: center !important;
    }
  }
  
  @media (max-width: 480px) {
    .afnan-bottom-navbar .bottom-nav-btn {
      font-size: 0.7rem;
      padding: 6px 2px;
      min-width: 0 !important;
      max-width: none !important;
    }
    
    .afnan-bottom-navbar {
      padding: 6px 0 !important;
      gap: 2px !important;
    }
  }
  </style>
  <style>
  .afnan-bottom-navbar i {
    color: #8B6F2F !important;
    transition: color 0.2s;
  }
  .afnan-bottom-navbar .bottom-nav-btn:active i,
  .afnan-bottom-navbar .bottom-nav-btn:focus i {
    color: #BD9750 !important;
  }
  </style>
  <script>
  // تحسين الأداء - تجميع الأحداث
  document.addEventListener('DOMContentLoaded', function() {
    // تحسين الأداء - استخدام event delegation
    const bottomNav = document.querySelector('.afnan-bottom-navbar');
    if (bottomNav) {
      bottomNav.addEventListener('click', function(e) {
        const target = e.target.closest('.bottom-nav-btn');
        if (!target) return;
        
        const id = target.id;
        
        switch(id) {
          case 'mobileHomeBtn':
            window.location = 'index.html';
            break;
          case 'mobileLangBtn':
            if(typeof window.currentLang === 'undefined') window.currentLang = 'ar';
            window.currentLang = (window.currentLang === 'ar') ? 'en' : 'ar';
            if(typeof window.switchLang === 'function') window.switchLang(window.currentLang);
            break;
          case 'mobileMenuBtn':
            if(typeof window.openMobileMenu === 'function') window.openMobileMenu();
            else if(typeof openMobileMenu === 'function') openMobileMenu();
            break;
          case 'mobileFavBtn':
            alert('قريبًا');
            break;
          case 'mobileHomeworkBtn':
            if(typeof window.openMobileMenu === 'function') {
              openMobileMenu();
              setTimeout(() => {
                toggleMobileHomeworkMenu();
              }, 300);
            }
            break;
        }
      });
    }
  });
  </script>

  <style>
    /* ستايل الروابط غير النشطة */
    .disabled-link {
      pointer-events: none;
      cursor: not-allowed !important;
      background: none !important;
      transition: none !important;
    }
  </style>

  <script>
    // منع أي حدث افتراضي عند الضغط على الروابط غير النشطة (الهيدر والموبايل)
    document.addEventListener('DOMContentLoaded', function() {
      var disabledLinks = document.querySelectorAll('.disabled-link');
      disabledLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          return false;
        });
      });
    });
  </script>

  <script>
document.addEventListener('DOMContentLoaded', function() {
  // تفعيل أزرار الشريط السفلي للموبايل
  var mobileHomeBtn = document.getElementById('mobileHomeBtn');
  if(mobileHomeBtn) {
    mobileHomeBtn.onclick = function() {
      window.location = 'index.html';
    };
  }
  var mobileLangBtn = document.getElementById('mobileLangBtn');
  if(mobileLangBtn) {
    mobileLangBtn.onclick = function() {
      currentLang = (currentLang === 'ar') ? 'en' : 'ar';
      switchLang(currentLang);
    };
  }
  var mobileMenuBtn = document.getElementById('mobileMenuBtn');
  if(mobileMenuBtn) {
    mobileMenuBtn.onclick = function() {
      if(typeof openMobileMenu === 'function') openMobileMenu();
      else if(window.openMobileMenu) window.openMobileMenu();
    };
  }
  var mobileFavBtn = document.getElementById('mobileFavBtn');
  if(mobileFavBtn) {
    mobileFavBtn.onclick = function() {
      alert('قريبًا');
    };
  }
});
</script>
<script>
// تعريف متغير اللغة في النطاق الأعلى
if(typeof window.currentLang === 'undefined') window.currentLang = 'ar';

// دالة تبديل اللغة
function switchLang(to) {
  const html = document.documentElement;
  if (to === 'en') {
    html.lang = 'en';
    html.dir = 'ltr';
    if(document.getElementById('langToggleBtn')) document.getElementById('langToggleBtn').textContent = 'AR';
    if(document.getElementById('mobileLangBtn')) document.getElementById('mobileLangBtn').querySelector('span').textContent = 'AR';
    // استبدال النصوص الأساسية (يمكنك إضافة المزيد)
    const enTexts = {
      'تسجيل الطالبة': 'Student Attendance',
      'الإدارة': 'Admin',
      'تسجيل الحضور / الانصراف': 'Attendance / Departure',
      'مواعيد تسجيل الحضور:': 'Attendance Times:',
      'مواعيد تسجيل الانصراف:': 'Departure Times:',
      'التسجيل مغلق الآن': 'Registration is closed now',
      'اسم الطالبة:': 'Student Name:',
      'تسجيل الحضور': 'Check In',
      'تسجيل الانصراف': 'Check Out',
      'الصفحة الرئيسية': 'Home',
      'أكاديمية أفنان': 'Afnan Academy',
      'حلقات التجويد': 'Tajweed Circles',
      'تواصل معنا': 'Contact Us',
      'القائمة': 'Menu',
      'المفضلة': 'Favorites',
      'اللغة': 'Language',
      'مساعدة': 'Support',
    };
    document.querySelectorAll('*').forEach(el => {
      if (el.childNodes.length === 1 && el.childNodes[0].nodeType === 3) {
        const txt = el.textContent.trim();
        if (enTexts[txt]) el.textContent = enTexts[txt];
      }
    });
  } else {
    html.lang = 'ar';
    html.dir = 'rtl';
    if(document.getElementById('langToggleBtn')) document.getElementById('langToggleBtn').textContent = 'EN';
    if(document.getElementById('mobileLangBtn')) document.getElementById('mobileLangBtn').querySelector('span').textContent = 'اللغة';
    const arTexts = {
      'Student Attendance': 'تسجيل الطالبة',
      'Admin': 'الإدارة',
      'Attendance / Departure': 'تسجيل الحضور / الانصراف',
      'Attendance Times:': 'مواعيد تسجيل الحضور:',
      'Departure Times:': 'مواعيد تسجيل الانصراف:',
      'Registration is closed now': 'التسجيل مغلق الآن',
      'Student Name:': 'اسم الطالبة:',
      'Check In': 'تسجيل الحضور',
      'Check Out': 'تسجيل الانصراف',
      'Home': 'الصفحة الرئيسية',
      'Afnan Academy': 'أكاديمية أفنان',
      'Tajweed Circles': 'حلقات التجويد',
      'Contact Us': 'تواصل معنا',
      'Menu': 'القائمة',
      'Favorites': 'المفضلة',
      'Language': 'اللغة',
      'Support': 'مساعدة',
    };
    document.querySelectorAll('*').forEach(el => {
      if (el.childNodes.length === 1 && el.childNodes[0].nodeType === 3) {
        const txt = el.textContent.trim();
        if (arTexts[txt]) el.textContent = arTexts[txt];
      }
    });
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // تفعيل زر اللغة في الهيدر
  var langBtn = document.getElementById('langToggleBtn');
  if(langBtn) langBtn.onclick = function() {
    window.currentLang = (window.currentLang === 'ar') ? 'en' : 'ar';
    switchLang(window.currentLang);
  };
  // تفعيل زر اللغة في الشريط السفلي
  var mobileLangBtn = document.getElementById('mobileLangBtn');
  if(mobileLangBtn) mobileLangBtn.onclick = function() {
    window.currentLang = (window.currentLang === 'ar') ? 'en' : 'ar';
    switchLang(window.currentLang);
  };
  // تفعيل زر القائمة الجانبية
  var mobileMenuBtn = document.getElementById('mobileMenuBtn');
  if(mobileMenuBtn) mobileMenuBtn.onclick = function() {
    if(typeof window.openMobileMenu === 'function') window.openMobileMenu();
    else if(typeof openMobileMenu === 'function') openMobileMenu();
  };
  // تفعيل زر الرئيسية
  var mobileHomeBtn = document.getElementById('mobileHomeBtn');
  if(mobileHomeBtn) mobileHomeBtn.onclick = function() { window.location = 'index.html'; };
  // تفعيل زر المفضلة
  var mobileFavBtn = document.getElementById('mobileFavBtn');
  if(mobileFavBtn) mobileFavBtn.onclick = function() { alert('قريبًا'); };

  // تفعيل التبويبات (تسجيل الطالبة/الإدارة)
  var tabBtns = document.querySelectorAll('.tab-btn');
  tabBtns.forEach(function(btn) {
    btn.addEventListener('click', function() {
      tabBtns.forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active');
      var tabName = btn.textContent.trim();
      var studentSection = document.getElementById('studentSection');
      var adminSection = document.getElementById('adminSection');
      if(tabName === 'تسجيل الطالبة' || tabName === 'Student Attendance') {
        if(studentSection) studentSection.classList.add('active');
        if(adminSection) adminSection.classList.remove('active');
      } else {
        if(studentSection) studentSection.classList.remove('active');
        if(adminSection) adminSection.classList.add('active');
      }
    });
  });
});
</script>

<script>
// دوال القائمة الجانبية للموبايل
function openMobileMenu() {
  var menu = document.getElementById('mobileSideMenu');
  if(menu) {
    menu.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  // إغلاق القائمة عند الضغط على الخلفية أو زر الإغلاق
  var overlay = document.getElementById('mobileSideMenuOverlay');
  var closeBtn = document.getElementById('mobileSideMenuClose');
  if(overlay) overlay.onclick = closeMobileMenu;
  if(closeBtn) closeBtn.onclick = closeMobileMenu;
  // إغلاق عند الضغط على ESC
  document.onkeydown = function(e) {
    if(e.key === 'Escape') closeMobileMenu();
  };
}
function closeMobileMenu() {
  var menu = document.getElementById('mobileSideMenu');
  if(menu) {
    menu.classList.remove('active');
    document.body.style.overflow = '';
  }
  document.onkeydown = null;
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var adminLoginBtn = document.getElementById('adminLoginBtn');
  if(adminLoginBtn && typeof adminLogin === 'function') {
    adminLoginBtn.onclick = function() {
      adminLogin();
    };
  }
});
// أضف alert بعد نجاح الدخول في دالة adminLogin (مؤقتًا)
// ابحث عن: if (admin) { ... }
// أضف: alert("تم تسجيل الدخول"); بعد showAdminPanel();
</script>

  <style>
  /* أنماط الأقسام الجديدة */
  .form-container {
    background: #fff;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .form-container h4 {
    color: #BD9750;
    margin-bottom: 15px;
    font-size: 1.1rem;
  }

  .days-selector {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 5px;
  }

  .days-selector label {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 8px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .days-selector label:hover {
    background: #e9ecef;
  }

  .days-selector input[type="checkbox"] {
    margin: 0;
  }

  /* أنماط الإحصائيات */
  .stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
  }

  .stat-card {
    background: linear-gradient(135deg, #fff, #f8f9fa);
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .stat-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #BD9750, #8B4513);
    border-radius: 50%;
    color: white;
  }

  .stat-content {
    flex: 1;
  }

  .stat-number {
    font-size: 1.8rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
  }

  .stat-label {
    font-size: 0.9rem;
    color: #666;
  }

  /* أنماط التقارير */
  .reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
  }

  .report-card {
    background: #fff;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
  }

  .report-card:hover {
    transform: translateY(-2px);
  }

  .report-card h5 {
    color: #BD9750;
    margin-bottom: 10px;
    font-size: 1.1rem;
  }

  .report-card p {
    color: #666;
    margin-bottom: 15px;
    font-size: 0.9rem;
  }



  /* أنماط إضافية للقوائم */
  .items-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background: #fff;
  }

  .item-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #f1f3f4;
    transition: background-color 0.2s;
  }

  .item-card:hover {
    background: #f8f9fa;
  }

  .item-card:last-child {
    border-bottom: none;
  }

  .item-info {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .item-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1rem;
  }

  .item-details h5 {
    margin: 0 0 5px 0;
    color: #333;
    font-size: 1rem;
  }

  .item-details p {
    margin: 0;
    color: #666;
    font-size: 0.85rem;
  }

  .item-actions {
    display: flex;
    gap: 8px;
  }

  /* أنماط متجاوبة */
  @media (max-width: 768px) {
    .stats-cards {
      grid-template-columns: 1fr;
    }
    
    .reports-grid {
      grid-template-columns: 1fr;
    }
    
    .settings-grid {
      grid-template-columns: 1fr;
    }
    
    .days-selector {
      flex-direction: column;
    }
    
    .settings-actions {
      flex-direction: column;
    }
  }
  /* ========== تحسينات شاملة للهاتف المحمول ========== */
  @media (max-width: 768px) {
    /* تحسين الحاوية الرئيسية */
    .container {
      padding: 2px;
      max-width: 100%;
      margin: 0;
      overflow-x: hidden;
    }
    
    /* تحسين الهيدر */
    .header {
      flex-direction: column;
      text-align: center;
      padding: 2px;
      margin-bottom: 4px;
    }
    
    .logo {
      width: 45px;
      height: 45px;
      margin-bottom: 2px;
    }
    
    .header h1 {
      font-size: 0.9rem;
      margin: 1px 0;
      line-height: 1.1;
    }
    
    .header p {
      font-size: 0.65rem;
      margin: 0;
    }
    
    /* تحسين التبويبات */
    .nav-tabs {
      flex-direction: column;
      gap: 3px;
      margin-bottom: 35px;
    }
    
    .nav-tabs button {
      padding: 10px 15px;
      font-size: 0.85rem;
      border-radius: 6px;
      width: 100%;
    }
    
    /* تحسين المسافة بين التبويبات والعنوان للهاتف */
    .tabs {
      margin-bottom: 40px;
    }
    
    .form-title {
      margin-top: 25px;
      margin-bottom: 25px;
    }
    
    /* تحسين المحتوى */
    .tab-content {
      padding: 12px;
    }
    
    /* تحسين قسم التسجيل */
    .registration-section {
      margin-bottom: 15px;
    }
    
    .time-display {
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
    }
    
    .time-display h3 {
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .time-display p {
      font-size: 0.8rem;
      margin: 5px 0;
    }
    
    /* تحسين النماذج */
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      font-size: 0.9rem;
      margin-bottom: 8px;
      display: block;
    }
    
    .form-group input,
    .form-group select {
      padding: 12px;
      font-size: 0.9rem;
      border-radius: 8px;
      width: 100%;
    }
    
    /* تحسين الأزرار */
    .btn {
      padding: 8px 12px;
      font-size: 0.8rem;
      margin: 2px;
      border-radius: 6px;
      white-space: nowrap;
      min-width: auto;
    }
    
    /* تحسين أزرار تسجيل الحضور والانصراف */
    .btn-group {
      flex-direction: row;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 15px;
    }
    
    .btn-group .btn {
      width: auto;
      margin: 0;
      flex: 1;
      min-width: 100px;
      max-width: 140px;
      padding: 12px 8px;
      font-size: 0.8rem;
      white-space: nowrap;
      text-align: center;
    }
    
    /* تحسين قسم الإدارة */
    .admin-section {
      margin-bottom: 15px;
    }
    
    .admin-section h3 {
      font-size: 0.95rem;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .admin-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }
    
    .admin-card {
      padding: 12px;
      border-radius: 8px;
    }
    
    .admin-card h4 {
      font-size: 0.85rem;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .admin-card p {
      font-size: 0.75rem;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .admin-card .btn {
      width: 100%;
      padding: 10px;
      font-size: 0.8rem;
      margin: 0;
    }
    
    /* تحسين أزرار التحكم في الإدارة */
    .admin-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .admin-controls .btn {
      width: 100%;
      padding: 12px;
      font-size: 0.9rem;
      margin: 0;
    }
    
    /* تحسين الجداول */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    table {
      font-size: 0.8rem;
    }
    
    th, td {
      padding: 8px 6px;
      white-space: nowrap;
    }
    
    /* تحسين النماذج المتقدمة */
    .form-row {
      flex-direction: column;
      gap: 10px;
    }
    
    .form-row .form-group {
      width: 100%;
      margin: 0;
    }
    
    /* تحسين القوائم المنسدلة */
    select {
      font-size: 0.9rem;
      padding: 10px;
    }
    
    /* تحسين النصوص */
    h1, h2, h3, h4, h5, h6 {
      word-wrap: break-word;
      hyphens: auto;
    }
    
    /* تحسين المسافات */
    .section {
      margin-bottom: 15px;
      padding: 10px;
    }
    
    /* تحسين الأيقونات */
    .icon {
      width: 16px;
      height: 16px;
    }
    
    /* تحسين التنبيهات */
    .alert {
      padding: 10px;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    /* تحسين الفوتر */
    .footer {
      padding: 15px 10px;
      text-align: center;
    }
    
    .footer-content {
      flex-direction: column;
      gap: 12px;
    }
    
    .footer-section {
      width: 100%;
    }
    
    .footer-section h3 {
      font-size: 1rem;
      margin-bottom: 8px;
    }
    
    .footer-section p {
      font-size: 0.8rem;
    }
    
    /* تحسين القوائم */
    .list-group-item {
      padding: 10px;
      font-size: 0.9rem;
    }
    
    /* تحسين البطاقات */
    .card {
      margin-bottom: 15px;
      border-radius: 8px;
    }
    
    .card-header {
      padding: 12px;
      font-size: 1rem;
    }
    
    .card-body {
      padding: 12px;
    }
    
    /* تحسين النماذج المتقدمة */
    .modal-dialog {
      margin: 10px;
      max-width: calc(100% - 20px);
    }
    
    .modal-header {
      padding: 12px;
    }
    
    .modal-body {
      padding: 12px;
    }
    
    .modal-footer {
      padding: 12px;
    }
    
    /* تحسين الإحصائيات */
    .stats-card {
      padding: 15px;
      margin-bottom: 10px;
    }
    
    .stats-number {
      font-size: 1.5rem;
    }
    
    .stats-label {
      font-size: 0.8rem;
    }
    
    /* تحسين الرسائل */
    .message-item {
      padding: 10px;
      margin-bottom: 8px;
    }
    
    .message-content {
      font-size: 0.85rem;
    }
    
    .message-time {
      font-size: 0.7rem;
    }
  }

  /* تحسينات إضافية للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .container {
      padding: 2px;
    }
    
    .header h1 {
      font-size: 0.9rem;
    }
    
    .btn {
      padding: 4px 8px;
      font-size: 0.7rem;
    }
    
    .btn-group .btn {
      min-width: 70px;
      font-size: 0.7rem;
    }
    
    .admin-card {
      padding: 8px;
    }
    
    .time-display {
      padding: 10px;
    }
    
    .form-group input,
    .form-group select {
      padding: 8px;
      font-size: 0.8rem;
    }
    
    /* تحسين الخطوط للشاشات الصغيرة */
    .form-title {
      font-size: 0.9rem;
    }
    
    .form-label {
      font-size: 0.7rem;
    }
    
    .form-input {
      font-size: 0.75rem;
    }
    
    .time-display h3 {
      font-size: 0.75rem;
    }
    
    .time-display p {
      font-size: 0.65rem;
    }
    
    .admin-section h3 {
      font-size: 0.8rem;
    }
    
    .admin-section h4 {
      font-size: 0.7rem;
    }
    
    .admin-section p {
      font-size: 0.65rem;
    }
    
    /* تحسين الأزرار للشاشات الصغيرة جداً */
    .registration-buttons {
      flex-direction: column;
      gap: 6px;
      margin-top: 12px;
    }
    
    .registration-buttons .form-btn {
      width: 100%;
      max-width: none;
      min-width: auto;
      padding: 10px;
      font-size: 0.8rem;
    }
    
    /* تحسين الفوتر للشاشات الصغيرة جداً */
    .afnan-footer {
      padding: 1px;
      font-size: 0.65rem;
      margin-bottom: 0; /* إزالة الفراغ الزائد */
      z-index: 1000;
    }
    
    .afnan-footer .footer-hadith {
      font-size: 0.6rem;
    }
    
    .afnan-footer .footer-ayah-img {
      max-width: 80px;
      width: 35vw;
      opacity: 0.8;
    }
    
    .afnan-footer .footer-narrator {
      font-size: 0.6rem;
    }
    
    .afnan-footer .footer-copyright {
      font-size: 0.55rem;
    }
    
    /* تحسين المسافة بين التبويبات والعنوان للشاشات الصغيرة جداً */
    .tabs {
      margin-bottom: 45px;
    }
    
    .form-title {
      margin-top: 30px;
      margin-bottom: 20px;
    }
    
    .admin-controls .form-btn {
      padding: 6px;
      font-size: 0.75rem;
    }
    
    /* تحسين التبويبات */
    .nav-tabs button {
      padding: 4px 8px;
      font-size: 0.7rem;
    }
    
    /* تحسين النماذج */
    .form-group {
      margin-bottom: 12px;
    }
    
    .form-group label {
      font-size: 0.8rem;
      margin-bottom: 6px;
    }
    
    /* تحسين المسافات */
    .section {
      margin-bottom: 8px;
      padding: 6px;
    }
    
    .admin-section {
      margin-bottom: 10px;
    }
    
    .admin-section h3 {
      margin-bottom: 6px;
    }
    
    .admin-card {
      margin-bottom: 8px;
    }
  }

  /* ========== تحسينات إضافية للأزرار ========== */
  .registration-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .registration-buttons .form-btn {
    flex: 1;
    min-width: 140px;
    max-width: 180px;
    padding: 12px 8px;
    font-size: 0.9rem;
    white-space: nowrap;
    text-align: center;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .admin-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }

  .admin-controls .form-btn {
    width: 100%;
    padding: 15px;
    font-size: 1rem;
    margin: 0;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 600;
  }

  /* تحسين الأزرار للهاتف */
  @media (max-width: 768px) {
    .registration-buttons {
      flex-direction: row;
      gap: 6px;
    }

    .registration-buttons .form-btn {
      flex: 1;
      min-width: 100px;
      max-width: 140px;
      padding: 8px 4px;
      font-size: 0.75rem;
    }

    .admin-controls {
      gap: 6px;
    }

    .admin-controls .form-btn {
      padding: 10px;
      font-size: 0.8rem;
    }
  }

  /* تحسين الأزرار للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .registration-buttons {
      flex-direction: column;
      gap: 4px;
    }

    .registration-buttons .form-btn {
      width: 100%;
      max-width: none;
      min-width: auto;
      padding: 8px;
      font-size: 0.75rem;
    }

    .admin-controls .form-btn {
      padding: 8px;
      font-size: 0.8rem;
    }
  }
  /* ========== تحسينات شاملة للمرونة ========== */
  /* تحسين النماذج للهاتف */
  @media (max-width: 768px) {
    .form-container {
      padding: 15px;
      margin: 10px 0;
    }
    
    .form-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
    
    .form-section {
      margin-bottom: 20px;
    }
    
    .time-settings {
      flex-direction: column;
      gap: 15px;
    }
    
    .time-group {
      width: 100%;
    }
    
    .time-inputs {
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }
    
    .time-inputs input {
      width: 100%;
      max-width: 200px;
    }
    
    .students-list {
      margin-top: 15px;
    }
    
    /* تحسين الجداول للهاتف */
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    table {
      min-width: 600px;
      font-size: 0.8rem;
    }
    
    th, td {
      padding: 8px 6px;
      white-space: nowrap;
    }
    
    /* تحسين النماذج المتقدمة */
    .modal-content {
      margin: 10px;
      max-width: calc(100% - 20px);
    }
    
    .modal-header,
    .modal-body,
    .modal-footer {
      padding: 12px;
    }
    
    /* تحسين القوائم */
    .list-group {
      margin-bottom: 15px;
    }
    
    .list-group-item {
      padding: 12px;
      font-size: 0.9rem;
    }
    
    /* تحسين البطاقات */
    .card {
      margin-bottom: 15px;
    }
    
    .card-header {
      padding: 12px;
      font-size: 1rem;
    }
    
    .card-body {
      padding: 12px;
    }
    
    /* تحسين الإحصائيات */
    .stats-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }
    
    .stats-card {
      padding: 15px;
    }
    
    .stats-number {
      font-size: 1.5rem;
    }
    
    .stats-label {
      font-size: 0.8rem;
    }
    
    /* تحسين الرسائل */
    .message {
      padding: 10px;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    /* تحسين التنبيهات */
    .alert {
      padding: 10px;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    /* تحسين الأيقونات */
    .icon {
      width: 16px;
      height: 16px;
    }
    
    /* تحسين المسافات */
    .section {
      margin-bottom: 15px;
      padding: 10px;
    }
    
    /* تحسين النصوص */
    h1, h2, h3, h4, h5, h6 {
      word-wrap: break-word;
      hyphens: auto;
      line-height: 1.3;
    }
    
    /* تحسين الحقول */
    .form-input,
    .form-select {
      font-size: 0.9rem;
      padding: 10px;
    }
    
    /* تحسين القوائم المنسدلة */
    select {
      font-size: 0.9rem;
      padding: 10px;
    }
    
    /* تحسين الأزرار العامة */
    .btn {
      font-size: 0.9rem;
      padding: 10px 15px;
    }
    
    /* تحسين التبويبات */
    .nav-tabs {
      flex-direction: column;
      gap: 3px;
    }
    
    .nav-tabs button {
      width: 100%;
      padding: 12px;
    }
    
    /* تحسين المحتوى */
    .tab-content {
      padding: 10px;
    }
  }

  /* تحسينات للشاشات الصغيرة جداً */
  @media (max-width: 480px) {
    .container {
      padding: 5px;
    }
    
    .form-container {
      padding: 10px;
    }
    
    .form-title {
      font-size: 1.1rem;
    }
    
    .btn {
      padding: 8px 12px;
      font-size: 0.8rem;
    }
    
    .form-input,
    .form-select {
      padding: 8px;
      font-size: 0.85rem;
    }
    
    .time-inputs input {
      max-width: 150px;
    }
    
    table {
      font-size: 0.7rem;
    }
    
    th, td {
      padding: 6px 4px;
    }
    
    /* تحسين الفوتر للشاشات الصغيرة جداً */
    .afnan-footer {
      padding: 8px 10px;
      font-size: 0.65rem;
      margin-bottom: 0;
    }
    
    .afnan-footer .footer-hadith {
      font-size: 0.9rem;
      margin-bottom: 6px;
      margin-top: 3px;
      color: #2c1810;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
    }
    
    .afnan-footer .footer-narrator {
      font-size: 0.6rem;
      margin-bottom: 3px;
    }
    
    .afnan-footer .footer-copyright {
      font-size: 0.55rem;
      margin-top: 4px;
    }
    
    .afnan-footer .footer-ayah-img {
      margin: 4px auto;
      max-width: 50vw;
    }
  }

  /* ========== تحسينات جمالية لجذب الطالبات ========== */
  /* تحسين الألوان والظلال */
  .form-container {
    box-shadow: 0 4px 15px rgba(189, 151, 80, 0.1);
    border-radius: 12px;
    transition: all 0.3s ease;
    padding: 20px;
    margin: 15px 0;
  }
  
  /* ضمان ظهور الفوتر كاملاً */
  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  .main-container {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .afnan-footer {
    margin-top: auto;
    flex-shrink: 0;
    position: relative;
    z-index: 1000;
  }

  .form-container:hover {
    box-shadow: 0 6px 20px rgba(189, 151, 80, 0.15);
    transform: translateY(-2px);
  }

  /* تحسين الأزرار */
  .form-btn {
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .form-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .form-btn:active {
    transform: translateY(0);
  }

  /* تحسين الحقول */
  .form-input {
    border-radius: 8px;
    transition: all 0.3s ease;
    border: 2px solid #e9ecef;
  }

  .form-input:focus {
    border-color: #BD9750;
    box-shadow: 0 0 0 3px rgba(189, 151, 80, 0.1);
    transform: scale(1.02);
  }

  /* تحسين التبويبات */
  .nav-tabs button {
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 600;
  }

  .nav-tabs button.active {
    box-shadow: 0 2px 8px rgba(189, 151, 80, 0.2);
  }

  /* تحسين عرض المواعيد */
  .time-display {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 10px;
    border: 2px solid #BD9750;
  }

  /* تحسين الرسائل */
  .message {
    border-radius: 8px;
    border-right: 4px solid #BD9750;
  }

  /* تحسين للهاتف */
  @media (max-width: 768px) {
    .form-container {
      box-shadow: 0 2px 10px rgba(189, 151, 80, 0.1);
      padding: 15px;
      margin: 10px 0;
    }
    
    .form-btn {
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    
    .form-input:focus {
      transform: scale(1.01);
    }
    
    /* تحسين وضوح النصوص */
    .form-title {
      font-size: 1.3rem;
      margin-top: 25px;
      margin-bottom: 25px;
      text-align: center;
      color: #BD9750;
      font-weight: bold;
    }
    
    .time-display {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #BD9750;
      padding: 15px;
      margin: 15px 0;
      border-radius: 10px;
    }
    
    .time-display h3 {
      font-size: 1rem;
      margin-bottom: 10px;
      color: #333;
      font-weight: bold;
    }
    
    .time-display p {
      font-size: 0.9rem;
      margin: 8px 0;
      color: #666;
      line-height: 1.4;
    }
    
    .form-group label {
      font-size: 1rem;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
    }
    
    .form-input {
      font-size: 1rem;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
    }
    
    .form-input:focus {
      border-color: #BD9750;
      box-shadow: 0 0 0 3px rgba(189, 151, 80, 0.1);
    }
    
    /* تحسين الفوتر للهاتف */
    .afnan-footer {
      padding: 10px 12px;
      font-size: 0.7rem;
      margin-top: 10px;
      margin-bottom: 70px; /* مساحة أكبر لشريط التنقل */
      z-index: 1000;
    }
    
    .afnan-footer .footer-hadith {
      font-size: 0.85rem;
      margin-bottom: 6px;
      margin-top: 3px;
      color: #2c1810;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
    }
    
    .afnan-footer .footer-narrator {
      font-size: 0.65rem;
      margin-bottom: 4px;
    }
    
    .afnan-footer .footer-copyright {
      font-size: 0.6rem;
      margin-top: 5px;
    }
    
    .afnan-footer .footer-ayah-img {
      margin: 5px auto;
    }
    
    .afnan-footer .footer-hadith {
      font-size: 0.8rem;
      margin-bottom: 4px;
      margin-top: 2px;
      color: #2c1810;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
    }
    
    .afnan-footer .footer-ayah-img {
      max-width: 100px;
      width: 45vw;
      margin: 1px auto;
      opacity: 0.85;
    }
    
    .afnan-footer .footer-narrator {
      font-size: 0.65rem;
      margin-bottom: 1px;
    }
    
    .afnan-footer .footer-copyright {
      font-size: 0.6rem;
      margin-top: 1px;
    }
  }
    </style>

  <script>
// تعيين مشرف افتراضي دائمًا إذا لم يوجد مشرفون
(function(){
  let settings;
  try {
    settings = JSON.parse(localStorage.getItem('academySettings') || '{}');
  } catch(e) { settings = {}; }
  if (!settings.admins || !Array.isArray(settings.admins) || settings.admins.length === 0) {
    settings.admins = [{ username: 'Afnan Academy', password: 'admin123' }];
    localStorage.setItem('academySettings', JSON.stringify(settings));
  }
})();
// ========== صيانة شاملة لأزرار الحضور والانصراف والمواعيد ========== //
document.addEventListener('DOMContentLoaded', function() {
  console.log('بدء تحميل النظام...');
  
  // دوال إدارة الحالة
  function getRegStatus() {
    try {
      return JSON.parse(localStorage.getItem('registrationStatus') || '{"checkIn": false, "checkOut": false}');
    } catch (e) {
      return { checkIn: false, checkOut: false };
    }
  }
  
  function setRegStatus(status) {
    localStorage.setItem('registrationStatus', JSON.stringify(status));
  }
  
  function getRegTimes() {
    try {
      return JSON.parse(localStorage.getItem('registrationTimes') || '{"attendanceStart": "06:00", "attendanceEnd": "08:00", "departureStart": "08:00", "departureEnd": "10:00"}');
    } catch (e) {
      return { attendanceStart: "06:00", attendanceEnd: "08:00", departureStart: "08:00", departureEnd: "10:00" };
    }
  }
  
  function setRegTimes(times) {
    localStorage.setItem('registrationTimes', JSON.stringify(times));
  }
  
  function updateRegStatusUI() {
    const status = getRegStatus();
    const checkInBtn = document.getElementById('checkInBtn');
    const checkOutBtn = document.getElementById('checkOutBtn');
    const studentName = document.getElementById('studentName');
    
    if (checkInBtn) checkInBtn.disabled = !status.checkIn;
    if (checkOutBtn) checkOutBtn.disabled = !status.checkOut;
    if (studentName) studentName.disabled = !(status.checkIn || status.checkOut);
    
    console.log('تم تحديث حالة التسجيل:', status);
  }
  
  function updateRegTimesUI() {
    const times = getRegTimes();
    const attendanceTimes = document.getElementById('attendanceTimes');
    const departureTimes = document.getElementById('departureTimes');
    
    if (attendanceTimes) {
      attendanceTimes.textContent = `${times.attendanceStart} - ${times.attendanceEnd}`;
    }
    if (departureTimes) {
      departureTimes.textContent = `${times.departureStart} - ${times.departureEnd}`;
    }
    
    console.log('تم تحديث المواعيد:', times);
  }
  
  // --- إدارة حالة التسجيل ---
  function getRegStatus() {
    return JSON.parse(localStorage.getItem('afnan_reg_status') || '{"checkIn":false,"checkOut":false}');
  }
  
  function setRegStatus(status) {
    localStorage.setItem('afnan_reg_status', JSON.stringify(status));
    console.log('تم حفظ حالة التسجيل:', status);
  }
  
  function updateRegStatusUI() {
    const status = getRegStatus();
    const timeStatus = document.getElementById('timeStatus');
    const studentName = document.getElementById('studentName');
    const checkInBtn = document.getElementById('checkInBtn');
    const checkOutBtn = document.getElementById('checkOutBtn');
    
    if (timeStatus) {
      if (status.checkIn && status.checkOut) {
        timeStatus.innerHTML = '✅ الحضور والانصراف مفتوحان الآن';
        timeStatus.style.color = '#28a745';
        timeStatus.style.fontWeight = 'bold';
      } else if (status.checkIn) {
        timeStatus.innerHTML = '✅ تسجيل الحضور مفتوح الآن';
        timeStatus.style.color = '#ffc107';
        timeStatus.style.fontWeight = 'bold';
      } else if (status.checkOut) {
        timeStatus.innerHTML = '✅ تسجيل الانصراف مفتوح الآن';
        timeStatus.style.color = '#218838';
        timeStatus.style.fontWeight = 'bold';
      } else {
        timeStatus.innerHTML = '❌ التسجيل مغلق الآن';
        timeStatus.style.color = '#dc3545';
        timeStatus.style.fontWeight = 'bold';
      }
      
      // إضافة تأثير بصري للحالة
      timeStatus.style.transition = 'all 0.3s ease';
      timeStatus.style.padding = '8px 12px';
      timeStatus.style.borderRadius = '6px';
      timeStatus.style.backgroundColor = 'rgba(255,255,255,0.1)';
    }
    
    // تفعيل/تعطيل حقول الطلاب مع تأثيرات بصرية
    if (studentName) {
      studentName.disabled = !(status.checkIn || status.checkOut);
      if (status.checkIn || status.checkOut) {
        studentName.style.borderColor = '#28a745';
        studentName.style.backgroundColor = '#f8fff9';
      } else {
        studentName.style.borderColor = '#dc3545';
        studentName.style.backgroundColor = '#fff5f5';
      }
    }
    
    if (checkInBtn) {
      checkInBtn.disabled = !status.checkIn;
      if (status.checkIn) {
        checkInBtn.style.opacity = '1';
        checkInBtn.style.cursor = 'pointer';
      } else {
        checkInBtn.style.opacity = '0.5';
        checkInBtn.style.cursor = 'not-allowed';
      }
    }
    
    if (checkOutBtn) {
      checkOutBtn.disabled = !status.checkOut;
      if (status.checkOut) {
        checkOutBtn.style.opacity = '1';
        checkOutBtn.style.cursor = 'pointer';
      } else {
        checkOutBtn.style.opacity = '0.5';
        checkOutBtn.style.cursor = 'not-allowed';
      }
    }
  }
  
  // --- إدارة مواعيد التسجيل ---
  function getRegTimes() {
    return JSON.parse(localStorage.getItem('afnan_reg_times') || '{"attendanceStart":"06:00","attendanceEnd":"08:00","departureStart":"08:00","departureEnd":"10:00"}');
  }
  
  function setRegTimes(times) {
    localStorage.setItem('afnan_reg_times', JSON.stringify(times));
    console.log('تم حفظ المواعيد:', times);
  }
  
  function updateRegTimesUI() {
    const times = getRegTimes();
    
    // تحديث حقول الإدخال
    if (document.getElementById('attendanceStart')) document.getElementById('attendanceStart').value = times.attendanceStart;
    if (document.getElementById('attendanceEnd')) document.getElementById('attendanceEnd').value = times.attendanceEnd;
    if (document.getElementById('departureStart')) document.getElementById('departureStart').value = times.departureStart;
    if (document.getElementById('departureEnd')) document.getElementById('departureEnd').value = times.departureEnd;
    
    // تحديث العرض
    if (document.getElementById('attendanceTimes')) {
      document.getElementById('attendanceTimes').textContent = `${times.attendanceStart} - ${times.attendanceEnd}`;
    }
    if (document.getElementById('departureTimes')) {
      document.getElementById('departureTimes').textContent = `${times.departureStart} - ${times.departureEnd}`;
    }
    
    console.log('تم تحديث واجهة المواعيد:', times);
  }
  
  // --- دالة التحقق من المواعيد ---
  function checkRegistrationTime() {
    const now = new Date();
    const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
    const times = getRegTimes();
    const status = getRegStatus();
    
    console.log('الوقت الحالي:', currentTime);
    console.log('مواعيد التسجيل:', times);
    console.log('حالة التسجيل:', status);
    
    // التحقق من موعد الحضور
    const isAttendanceTime = currentTime >= times.attendanceStart && currentTime <= times.attendanceEnd;
    const isDepartureTime = currentTime >= times.departureStart && currentTime <= times.departureEnd;
    
    console.log('هل هو موعد الحضور؟', isAttendanceTime);
    console.log('هل هو موعد الانصراف؟', isDepartureTime);
    
    // إذا كان التسجيل مفتوح يدوياً، لا نحتاج للتحقق من المواعيد
    if (status.checkIn || status.checkOut) {
      console.log('التسجيل مفتوح يدوياً');
      return;
    }
    
    // فتح التسجيل تلقائياً حسب المواعيد
    if (isAttendanceTime && !status.checkIn) {
      status.checkIn = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الحضور تلقائياً', 'success');
      console.log('تم فتح تسجيل الحضور تلقائياً');
    }
    
    if (isDepartureTime && !status.checkOut) {
      status.checkOut = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الانصراف تلقائياً', 'success');
      console.log('تم فتح تسجيل الانصراف تلقائياً');
    }
    
    // إغلاق التسجيل تلقائياً بعد انتهاء المواعيد
    if (!isAttendanceTime && status.checkIn) {
      status.checkIn = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الحضور تلقائياً', 'warning');
      console.log('تم إغلاق تسجيل الحضور تلقائياً');
    }
    
    if (!isDepartureTime && status.checkOut) {
      status.checkOut = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الانصراف تلقائياً', 'warning');
      console.log('تم إغلاق تسجيل الانصراف تلقائياً');
    }
  }
  
  // --- ربط أزرار التحكم في الإدارة ---
  const openCheckInBtn = document.getElementById('openCheckInManual');
  const closeCheckInBtn = document.getElementById('closeCheckInManual');
  const openCheckOutBtn = document.getElementById('openCheckOutManual');
  const closeCheckOutBtn = document.getElementById('closeCheckOutManual');
  const saveTimesBtn = document.getElementById('saveTimesBtn');
  
  console.log('البحث عن الأزرار:', {
    openCheckIn: !!openCheckInBtn,
    closeCheckIn: !!closeCheckInBtn,
    openCheckOut: !!openCheckOutBtn,
    closeCheckOut: !!closeCheckOutBtn,
    saveTimes: !!saveTimesBtn
  });
  
  // إضافة event listeners لجميع الأزرار
  if (openCheckInBtn) {
    openCheckInBtn.addEventListener('click', function() {
      console.log('تم الضغط على فتح الحضور');
      const status = getRegStatus();
      status.checkIn = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الحضور', 'success');
    });
  }
  
  if (closeCheckInBtn) {
    closeCheckInBtn.addEventListener('click', function() {
      console.log('تم الضغط على إغلاق الحضور');
      const status = getRegStatus();
      status.checkIn = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الحضور', 'warning');
    });
  }
  
  if (openCheckOutBtn) {
    openCheckOutBtn.addEventListener('click', function() {
      console.log('تم الضغط على فتح الانصراف');
      const status = getRegStatus();
      status.checkOut = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الانصراف', 'success');
    });
  }
  
  if (closeCheckOutBtn) {
    closeCheckOutBtn.addEventListener('click', function() {
      console.log('تم الضغط على إغلاق الانصراف');
      const status = getRegStatus();
      status.checkOut = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الانصراف', 'warning');
    });
  }
  
  // ربط زر حفظ المواعيد
  if (saveTimesBtn) {
    saveTimesBtn.addEventListener('click', function() {
      console.log('تم الضغط على حفظ المواعيد');
      
      const attendanceStart = document.getElementById('attendanceStart');
      const attendanceEnd = document.getElementById('attendanceEnd');
      const departureStart = document.getElementById('departureStart');
      const departureEnd = document.getElementById('departureEnd');
      
      if (!attendanceStart || !attendanceEnd || !departureStart || !departureEnd) {
        showToast('لم يتم العثور على حقول المواعيد', 'error');
        return;
      }
      
      if (!attendanceStart.value || !attendanceEnd.value || !departureStart.value || !departureEnd.value) {
        showToast('يرجى ملء جميع المواعيد', 'error');
        return;
      }
      
      const times = {
        attendanceStart: attendanceStart.value,
        attendanceEnd: attendanceEnd.value,
        departureStart: departureStart.value,
        departureEnd: departureEnd.value
      };
      
      setRegTimes(times);
      updateRegTimesUI();
      showToast('تم حفظ المواعيد بنجاح', 'success');
      
      // إضافة تأثير بصري للزر
      this.style.background = '#007bff';
      this.style.color = 'white';
      setTimeout(() => {
        this.style.background = '';
        this.style.color = '';
      }, 300);
    });
  }
  
  // تفعيل أزرار التحكم مع رسائم محسنة
  if (openCheckInBtn) {
    openCheckInBtn.onclick = function() {
      console.log('تم الضغط على فتح الحضور');
      const status = getRegStatus();
      status.checkIn = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الحضور', 'success');
      
      // إضافة تأثير بصري للزر
      this.style.background = '#28a745';
      this.style.color = 'white';
      setTimeout(() => {
        this.style.background = '';
        this.style.color = '';
      }, 300);
    };
  }
  
  if (closeCheckInBtn) {
    closeCheckInBtn.onclick = function() {
      console.log('تم الضغط على إغلاق الحضور');
      const status = getRegStatus();
      status.checkIn = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الحضور', 'warning');
      
      // إضافة تأثير بصري للزر
      this.style.background = '#dc3545';
      this.style.color = 'white';
      setTimeout(() => {
        this.style.background = '';
        this.style.color = '';
      }, 300);
    };
  }
  
  if (openCheckOutBtn) {
    openCheckOutBtn.onclick = function() {
      console.log('تم الضغط على فتح الانصراف');
      const status = getRegStatus();
      status.checkOut = true;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم فتح تسجيل الانصراف', 'success');
      
      // إضافة تأثير بصري للزر
      this.style.background = '#28a745';
      this.style.color = 'white';
      setTimeout(() => {
        this.style.background = '';
        this.style.color = '';
      }, 300);
    };
  }
  
  if (closeCheckOutBtn) {
    closeCheckOutBtn.onclick = function() {
      console.log('تم الضغط على إغلاق الانصراف');
      const status = getRegStatus();
      status.checkOut = false;
      setRegStatus(status);
      updateRegStatusUI();
      showToast('تم إغلاق تسجيل الانصراف', 'warning');
      
      // إضافة تأثير بصري للزر
      this.style.background = '#dc3545';
      this.style.color = 'white';
      setTimeout(() => {
        this.style.background = '';
        this.style.color = '';
      }, 300);
    };
  }
  
  if (saveTimesBtn) {
    saveTimesBtn.onclick = function() {
      console.log('تم الضغط على حفظ المواعيد');
      const attendanceStart = document.getElementById('attendanceStart').value;
      const attendanceEnd = document.getElementById('attendanceEnd').value;
      const departureStart = document.getElementById('departureStart').value;
      const departureEnd = document.getElementById('departureEnd').value;
      
      if (!attendanceStart || !attendanceEnd || !departureStart || !departureEnd) {
        showToast('يرجى ملء جميع المواعيد', 'error');
        return;
      }
      
      const times = {
        attendanceStart: attendanceStart,
        attendanceEnd: attendanceEnd,
        departureStart: departureStart,
        departureEnd: departureEnd
      };
      
      setRegTimes(times);
      updateRegTimesUI();
      showToast('تم حفظ مواعيد التسجيل بنجاح', 'success');
    };
  }
  
  // --- ربط أزرار تسجيل الطلاب ---
  const checkInBtn = document.getElementById('checkInBtn');
  const checkOutBtn = document.getElementById('checkOutBtn');
  const studentName = document.getElementById('studentName');
  
  if (checkInBtn) {
    checkInBtn.onclick = function() {
      const name = studentName.value.trim();
      if (!name) {
        showToast('يرجى إدخال اسم الطالبة', 'error');
        studentName.focus();
        return;
      }
      
      const attendance = {
        name: name,
        type: 'حضور',
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString('ar-SA')
      };
      
      let attendances = JSON.parse(localStorage.getItem('attendances') || '[]');
      attendances.push(attendance);
      localStorage.setItem('attendances', JSON.stringify(attendances));
      
      showToast(`تم تسجيل حضور الطالبة "${name}" بنجاح`, 'success');
      studentName.value = '';
      studentName.focus();
    };
  }
  
  if (checkOutBtn) {
    checkOutBtn.onclick = function() {
      const name = studentName.value.trim();
      if (!name) {
        showToast('يرجى إدخال اسم الطالبة', 'error');
        studentName.focus();
        return;
      }
      
      const attendance = {
        name: name,
        type: 'انصراف',
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString('ar-SA')
      };
      
      let attendances = JSON.parse(localStorage.getItem('attendances') || '[]');
      attendances.push(attendance);
      localStorage.setItem('attendances', JSON.stringify(attendances));
      
      showToast(`تم تسجيل انصراف الطالبة "${name}" بنجاح`, 'success');
      studentName.value = '';
      studentName.focus();
    };
  }
  
  // --- تفعيل Enter في حقل اسم الطالبة ---
  if (studentName) {
    studentName.onkeypress = function(e) {
      if (e.key === 'Enter') {
        const status = getRegStatus();
        
        if (status.checkIn && status.checkOut) {
          const choice = confirm('اختر نوع التسجيل:\n\nموافق = تسجيل حضور\nإلغاء = تسجيل انصراف');
          if (choice) {
            checkInBtn.click();
          } else {
            checkOutBtn.click();
          }
        } else if (status.checkIn) {
          checkInBtn.click();
        } else if (status.checkOut) {
          checkOutBtn.click();
        }
      }
    };
  }
  
  // --- تحديث الواجهة عند التحميل ---
  console.log('تحديث الواجهة...');
  
  // تحميل البيانات الأولية
  const times = getRegTimes();
  const attendanceStart = document.getElementById('attendanceStart');
  const attendanceEnd = document.getElementById('attendanceEnd');
  const departureStart = document.getElementById('departureStart');
  const departureEnd = document.getElementById('departureEnd');
  
  if (attendanceStart) attendanceStart.value = times.attendanceStart;
  if (attendanceEnd) attendanceEnd.value = times.attendanceEnd;
  if (departureStart) departureStart.value = times.departureStart;
  if (departureEnd) departureEnd.value = times.departureEnd;
  
  // تحديث فوري للواجهة
  requestAnimationFrame(() => {
    updateRegTimesUI();
    updateRegStatusUI();
    checkRegistrationTime(); // التحقق من المواعيد عند التحميل
    console.log('تم تحميل النظام بنجاح');
  });
  
  // تشغيل التحقق من المواعيد كل دقيقة
  setInterval(() => {
    checkRegistrationTime();
  }, 60000); // كل دقيقة
  
  // --- إضافة حماية إضافية للأزرار ---
  setTimeout(() => {
    console.log('فحص الأزرار مرة أخرى...');
    const buttons = {
      openCheckIn: document.getElementById('openCheckInManual'),
      closeCheckIn: document.getElementById('closeCheckInManual'),
      openCheckOut: document.getElementById('openCheckOutManual'),
      closeCheckOut: document.getElementById('closeCheckOutBtn'),
      saveTimes: document.getElementById('saveTimesBtn'),
      checkIn: document.getElementById('checkInBtn'),
      checkOut: document.getElementById('checkOutBtn')
    };
    
    Object.keys(buttons).forEach(key => {
      if (buttons[key]) {
        console.log(`زر ${key} موجود ويعمل`);
        
        // إضافة تأثيرات بصرية للأزرار
        buttons[key].style.transition = 'all 0.2s ease';
        buttons[key].addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.05)';
          this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        });
        
        buttons[key].addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
          this.style.boxShadow = '';
        });
        
        buttons[key].addEventListener('click', function() {
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 150);
        });
      } else {
        console.warn(`زر ${key} غير موجود`);
      }
    });
  }, 1000);
});

// دالة عرض رسائم التنبيه المحسنة والسريعة
function showToast(message, type = 'info') {
  // إزالة الرسائم السابقة فوراً
  const existingToasts = document.querySelectorAll('.afnan-toast');
  existingToasts.forEach(toast => {
    toast.style.transform = 'translateX(100%)';
    setTimeout(() => toast.remove(), 200);
  });
  
  const toast = document.createElement('div');
  toast.className = 'afnan-toast';
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 18px;
    border-radius: 6px;
    color: white;
    font-weight: 700;
    font-family: 'Cairo', 'Tajawal', sans-serif;
    z-index: 10000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transform: translateX(100%);
    transition: transform 0.2s ease;
    max-width: 280px;
    word-wrap: break-word;
    font-size: 13px;
    border: 2px solid rgba(255,255,255,0.3);
  `;
  
  const colors = {
    success: '#28a745',
    error: '#dc3545',
    warning: '#ffc107',
    info: '#17a2b8'
  };
  
  toast.style.background = colors[type] || colors.info;
  toast.textContent = message;
  
  document.body.appendChild(toast);
  
  // إظهار الرسالة فوراً
  requestAnimationFrame(() => {
    toast.style.transform = 'translateX(0)';
  });
  
  // إخفاء الرسالة بعد ثانيتين فقط
  setTimeout(() => {
    toast.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 200);
  }, 2000);
}

// إضافة CSS للرسائم
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
`;
document.head.appendChild(style);



// دالة تفعيل التبويبات بين تسجيل الطالبة والإدارة
function showTab(tab) {
  console.log('تفعيل التبويب:', tab);
  document.querySelectorAll('.form-section').forEach(function(section) {
    section.classList.remove('active');
  });
  const targetSection = document.getElementById(tab + 'Section');
  if (targetSection) {
    targetSection.classList.add('active');
    console.log('تم تفعيل التبويب بنجاح');
  } else {
    console.error('لم يتم العثور على التبويب:', tab + 'Section');
  }
}

// دالة تفعيل القائمة المنسدلة في الهاتف
function toggleMobileMenu() {
  const mobileMenu = document.querySelector('.mobile-menu');
  if (mobileMenu) {
    mobileMenu.classList.toggle('active');
    console.log('تم تبديل حالة القائمة المنسدلة');
  } else {
    console.error('لم يتم العثور على القائمة المنسدلة');
  }
}

// دالة إظهار الرسائم
function showToast(message, type = 'info') {
  console.log('إظهار رسالة:', message, type);
  
  // إنشاء عنصر الرسالة
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    font-weight: bold;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    max-width: 300px;
    word-wrap: break-word;
  `;
  
  toast.textContent = message;
  document.body.appendChild(toast);
  
  // إظهار الرسالة
  setTimeout(() => {
    toast.style.transform = 'translateX(0)';
  }, 100);
  
  // إخفاء الرسالة بعد ثانيتين
  setTimeout(() => {
    toast.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 300);
  }, 2000);
}

// إضافة event listeners للقائمة المنسدلة
document.addEventListener('DOMContentLoaded', function() {
  const menuToggle = document.querySelector('.menu-toggle');
  if (menuToggle) {
    menuToggle.addEventListener('click', toggleMobileMenu);
    console.log('تم ربط زر القائمة المنسدلة');
  }
  
  // إغلاق القائمة عند النقر خارجها
  document.addEventListener('click', function(e) {
    const mobileMenu = document.querySelector('.mobile-menu');
    const menuToggle = document.querySelector('.menu-toggle');
    
    if (mobileMenu && mobileMenu.classList.contains('active') && 
        !mobileMenu.contains(e.target) && 
        !menuToggle.contains(e.target)) {
      mobileMenu.classList.remove('active');
    }
  });
  
  // تفعيل زر تبديل اللغة
  const langBtn = document.querySelector('.lang-btn');
  if (langBtn) {
    langBtn.addEventListener('click', function() {
      const currentLang = document.documentElement.lang;
      const newLang = currentLang === 'ar' ? 'en' : 'ar';
      
      document.documentElement.lang = newLang;
      document.documentElement.dir = newLang === 'ar' ? 'rtl' : 'ltr';
      
      // حفظ اللغة المفضلة
      localStorage.setItem('preferredLanguage', newLang);
      
      showToast(newLang === 'ar' ? 'تم التبديل إلى العربية' : 'Switched to English', 'info');
      
      // إعادة تحميل الصفحة لتطبيق التغييرات
      setTimeout(() => {
        location.reload();
      }, 1000);
    });
    console.log('تم ربط زر تبديل اللغة');
  }
  });
  
  // --- تحسينات إضافية لضمان العمل ---
  window.addEventListener('load', function() {
    console.log('تم تحميل الصفحة بالكامل');
    
    // التأكد من عمل جميع الأزرار
    const allButtons = document.querySelectorAll('button');
    console.log(`عدد الأزرار في الصفحة: ${allButtons.length}`);
    
    // إضافة تأثيرات بصرية للأزرار
    allButtons.forEach(button => {
      button.style.transition = 'all 0.2s ease';
      
      button.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.02)';
        this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
      });
      
      button.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
        this.style.boxShadow = '';
      });
      
      button.addEventListener('click', function() {
        this.style.transform = 'scale(0.98)';
        setTimeout(() => {
          this.style.transform = 'scale(1)';
        }, 100);
      });
    });
    
    // تحسين تجربة المستخدم
    const inputs = document.querySelectorAll('input, textarea');
    inputs.forEach(input => {
      input.style.transition = 'all 0.2s ease';
      
      input.addEventListener('focus', function() {
        this.style.borderColor = '#BD9750';
        this.style.boxShadow = '0 0 0 2px rgba(189, 151, 80, 0.2)';
        this.style.transform = 'scale(1.01)';
      });
      
      input.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
        this.style.transform = 'scale(1)';
      });
    });
    
    // تحسين سرعة الاستجابة
    document.body.style.willChange = 'transform';
    
    console.log('تم تطبيق جميع التحسينات بنجاح');
  });
    </script>
  
  <!-- JavaScript لإعدادات وصف الأكاديمية -->
  <script>
  // إعدادات وصف الأكاديمية
  function loadAcademyDescSettings() {
    const desc = localStorage.getItem('academyDescText') || 'نظام تسجيل الحضور والانصراف لأكاديمية أفنان لتعليم القرآن وعلومه';
    const bg = localStorage.getItem('academyDescBg') || '#f9f6ef';
    const color = localStorage.getItem('academyDescColor') || '#3b2e13';
    const descBox = document.getElementById('academyDescBox');
    if(descBox) {
      descBox.textContent = desc;
      descBox.style.background = bg;
      descBox.style.color = color;
    }
    if(document.getElementById('academyDescInput')) {
      document.getElementById('academyDescInput').value = desc;
      document.getElementById('academyDescBgColor').value = bg;
      document.getElementById('academyDescTextColor').value = color;
    }
  }

  // تحميل إعدادات الوصف عند تحميل الصفحة
  document.addEventListener('DOMContentLoaded', function() {
    loadAcademyDescSettings();
    loadAdminSettings();
    loadAdmins();
    loadStudents();
    loadCustomColumns();
    loadSchedules();
    loadSessionSummaries();
    
    
    // تحديث المواعيد والحالة بعد تحميل الصفحة
    setTimeout(() => {
      updateAttendanceStatus();
      
      // تحديث حقل اسم الطالبة
      const studentNameInput = document.getElementById('studentName');
      if (studentNameInput) {
        const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
        const departureOpen = localStorage.getItem('departureOpen') === 'true';
        
        if (attendanceOpen || departureOpen) {
          studentNameInput.disabled = false;
          studentNameInput.placeholder = 'أدخلي اسمك الكامل';
          studentNameInput.style.backgroundColor = '#ffffff';
          studentNameInput.style.color = '#333';
          studentNameInput.style.borderColor = '#BD9750';
        } else {
          studentNameInput.disabled = true;
          studentNameInput.placeholder = 'التسجيل مغلق - انتظر موعد التسجيل';
          studentNameInput.style.backgroundColor = '#f5f5f5';
          studentNameInput.style.color = '#999';
          studentNameInput.style.borderColor = '#ddd';
          studentNameInput.value = '';
        }
      }
      
      // تطبيق إعدادات وصف الأكاديمية
      applyAcademyDescSettings();
    }, 500);
    
    // دالة تطبيق إعدادات وصف الأكاديمية
    function applyAcademyDescSettings() {
      const descBox = document.getElementById('academyDescBox');
      if (descBox) {
        const desc = localStorage.getItem('academyDescText') || 'نظام تسجيل الحضور والانصراف لأكاديمية أفنان لتعليم القرآن وعلومه';
        const bg = localStorage.getItem('academyDescBg') || '#f5f5f5';
        const color = localStorage.getItem('academyDescColor') || '#3b2e13';
        const font = localStorage.getItem('academyDescFont') || "'Cairo', sans-serif";
        const size = localStorage.getItem('academyDescSize') || '1rem';
        const weight = localStorage.getItem('academyDescWeight') || '400';
        const padding = localStorage.getItem('academyDescPadding') || '15px';
        const radius = localStorage.getItem('academyDescRadius') || '10px';
        const shadow = localStorage.getItem('academyDescShadow') || '0 2px 4px rgba(0,0,0,0.1)';
        
        descBox.textContent = desc;
        descBox.style.background = bg;
        descBox.style.color = color;
        descBox.style.fontFamily = font;
        descBox.style.fontSize = size;
        descBox.style.fontWeight = weight;
        descBox.style.padding = padding;
        descBox.style.borderRadius = radius;
        descBox.style.boxShadow = shadow;
        descBox.style.border = '1px solid rgba(189, 151, 80, 0.2)';
        descBox.style.textAlign = 'center';
        descBox.style.lineHeight = '1.6';
        descBox.style.transition = 'all 0.3s ease';
      }
    }
    
    // إضافة مستمع لزر حفظ الوصف
    if(document.getElementById('saveAcademyDescBtn')) {
      document.getElementById('saveAcademyDescBtn').addEventListener('click', function() {
        const desc = document.getElementById('academyDescInput').value.trim() || 'نظام تسجيل الحضور والانصراف لأكاديمية أفنان لتعليم القرآن وعلومه';
        const bg = document.getElementById('academyDescBgColor').value;
        const color = document.getElementById('academyDescTextColor').value;
        localStorage.setItem('academyDescText', desc);
        localStorage.setItem('academyDescBg', bg);
        localStorage.setItem('academyDescColor', color);
        loadAcademyDescSettings();
        
        showToast('تم حفظ إعدادات وصف الأكاديمية بنجاح', 'success');
      });
    }
    
    // تفعيل جميع أزرار الإدارة
    setupAdminButtons();
  });
  
  // ====== دوال إدارة الأزرار ======
  
  // تفعيل جميع أزرار الإدارة
  function setupAdminButtons() {
    // أزرار الحضور والانصراف
    setupAttendanceButtons();
    
    // أزرار إدارة الطالبات
    setupStudentButtons();
    
    // أزرار إدارة المشرفين
    setupAdminButtons();
    
    // أزرار الأعمدة المخصصة
    setupCustomColumnButtons();
    
    // أزرار الجداول الزمنية
    setupScheduleButtons();
    
    // أزرار ملخص الحلقة
    setupSummaryButtons();
    
    // أزرار الرسائم الإذاعية
    
    
    // أزرار الإحصائيات
    setupStatisticsButtons();
    
    // أزرار الإعدادات المتقدمة
    
  }
  
  // أزرار الحضور والانصراف
  function setupAttendanceButtons() {
    const openCheckInBtn = document.getElementById('openCheckInManual');
    const closeCheckInBtn = document.getElementById('closeCheckInManual');
    const openCheckOutBtn = document.getElementById('openCheckOutManual');
    const closeCheckOutBtn = document.getElementById('closeCheckOutManual');
    const saveTimesBtn = document.getElementById('saveTimesBtn');
    
    if (openCheckInBtn) {
      openCheckInBtn.addEventListener('click', function() {
        localStorage.setItem('attendanceOpen', 'true');
        showToast('تم فتح تسجيل الحضور', 'success');
        updateAttendanceStatus();
        console.log('تم فتح تسجيل الحضور');
      });
    }
    
    if (closeCheckInBtn) {
      closeCheckInBtn.addEventListener('click', function() {
        localStorage.setItem('attendanceOpen', 'false');
        showToast('تم إغلاق تسجيل الحضور', 'warning');
        updateAttendanceStatus();
        console.log('تم إغلاق تسجيل الحضور');
      });
    }
    
    if (openCheckOutBtn) {
      openCheckOutBtn.addEventListener('click', function() {
        localStorage.setItem('departureOpen', 'true');
        showToast('تم فتح تسجيل الانصراف', 'success');
        updateAttendanceStatus();
        console.log('تم فتح تسجيل الانصراف');
      });
    }
    
    if (closeCheckOutBtn) {
      closeCheckOutBtn.addEventListener('click', function() {
        localStorage.setItem('departureOpen', 'false');
        showToast('تم إغلاق تسجيل الانصراف', 'warning');
        updateAttendanceStatus();
        console.log('تم إغلاق تسجيل الانصراف');
      });
    }
    
    if (saveTimesBtn) {
      saveTimesBtn.addEventListener('click', function() {
        const attendanceStart = document.getElementById('attendanceStart').value;
        const attendanceEnd = document.getElementById('attendanceEnd').value;
        const departureStart = document.getElementById('departureStart').value;
        const departureEnd = document.getElementById('departureEnd').value;
        
        localStorage.setItem('attendanceStart', attendanceStart);
        localStorage.setItem('attendanceEnd', attendanceEnd);
        localStorage.setItem('departureStart', departureStart);
        localStorage.setItem('departureEnd', departureEnd);
        
        showToast('تم حفظ المواعيد بنجاح', 'success');
        updateAttendanceStatus();
      });
    }
  }
  
  // أزرار إدارة الطالبات
  function setupStudentButtons() {
    const addStudentBtn = document.getElementById('addStudentBtn');
    const saveStudentBtn = document.getElementById('saveStudentBtn');
    const deleteStudentBtn = document.getElementById('deleteStudentBtn');
    const editStudentBtn = document.getElementById('editStudentBtn');
    
    if (addStudentBtn) {
      addStudentBtn.addEventListener('click', function() {
        const name = document.getElementById('newStudentName').value.trim();
        const phone = document.getElementById('newStudentPhone').value.trim();
        const level = document.getElementById('newStudentLevel').value;
        
        if (!name) {
          showToast('يرجى إدخال اسم الطالبة', 'error');
          return;
        }
        
        const student = {
          id: Date.now(),
          name: name,
          phone: phone,
          level: level,
          addedAt: new Date().toISOString(),
          attendance: []
        };
        
        students.push(student);
        saveStudents();
        renderStudentsList();
        document.getElementById('newStudentName').value = '';
        document.getElementById('newStudentPhone').value = '';
        document.getElementById('newStudentLevel').value = 'المستوى الثاني';
        
        showToast('تم إضافة الطالبة بنجاح', 'success');
      });
    }
    
    if (saveStudentBtn) {
      saveStudentBtn.addEventListener('click', function() {
        const selectedStudent = document.querySelector('.student-item.selected');
        if (!selectedStudent) {
          showToast('يرجى اختيار طالبة للتعديل', 'warning');
          return;
        }
        
        const studentId = parseInt(selectedStudent.dataset.id);
        const student = students.find(s => s.id === studentId);
        
        if (student) {
          student.name = document.getElementById('editStudentName').value.trim();
          student.phone = document.getElementById('editStudentPhone').value.trim();
          student.level = document.getElementById('editStudentLevel').value;
          
          saveStudents();
          renderStudentsList();
          showToast('تم حفظ التعديلات بنجاح', 'success');
        }
      });
    }
    
    if (deleteStudentBtn) {
      deleteStudentBtn.addEventListener('click', function() {
        const selectedStudent = document.querySelector('.student-item.selected');
        if (!selectedStudent) {
          showToast('يرجى اختيار طالبة للحذف', 'warning');
          return;
        }
        
        if (confirm('هل أنت متأكد من حذف هذه الطالبة؟')) {
          const studentId = parseInt(selectedStudent.dataset.id);
          students = students.filter(s => s.id !== studentId);
          saveStudents();
          renderStudentsList();
          showToast('تم حذف الطالبة بنجاح', 'success');
        }
      });
    }
  }
  
  // أزرار إدارة المشرفين
  function setupAdminButtons() {
    const addAdminBtn = document.getElementById('addAdminBtn');
    
    if (addAdminBtn) {
      addAdminBtn.addEventListener('click', function() {
        const username = document.getElementById('newAdminUsername').value.trim();
        const password = document.getElementById('newAdminPassword').value.trim();
        
        if (!username || !password) {
          showToast('يرجى إدخال اسم المستخدم وكلمة المرور', 'error');
          return;
        }
        
        const admin = {
          username: username,
          password: password,
          addedAt: new Date().toISOString()
        };
        
        admins.push(admin);
        saveAdmins();
        renderAdminsList();
        
        document.getElementById('newAdminUsername').value = '';
        document.getElementById('newAdminPassword').value = '';
        
        showToast('تم إضافة المشرف بنجاح', 'success');
      });
    }
  }
  
  // أزرار الأعمدة المخصصة
  function setupCustomColumnButtons() {
    const addColumnBtn = document.getElementById('addColumnBtn');
    const saveColumnBtn = document.getElementById('saveColumnBtn');
    const deleteColumnBtn = document.getElementById('deleteColumnBtn');
    
    if (addColumnBtn) {
      addColumnBtn.addEventListener('click', function() {
        const name = document.getElementById('newColumnName').value.trim();
        const type = document.getElementById('newColumnType').value;
        const required = document.getElementById('newColumnRequired').checked;
        const description = document.getElementById('newColumnDescription').value.trim();
        
        if (!name) {
          showToast('يرجى إدخال اسم العمود', 'error');
          return;
        }
        
        const column = {
          id: Date.now(),
          name: name,
          type: type,
          required: required,
          description: description,
          createdAt: new Date().toISOString()
        };
        
        customColumns.push(column);
        saveCustomColumns();
        renderCustomColumnsList();
        
        document.getElementById('newColumnName').value = '';
        document.getElementById('newColumnType').value = 'text';
        document.getElementById('newColumnRequired').checked = false;
        document.getElementById('newColumnDescription').value = '';
        
        showToast('تم إضافة العمود بنجاح', 'success');
      });
    }
    
    if (saveColumnBtn) {
      saveColumnBtn.addEventListener('click', function() {
        const selectedColumn = document.querySelector('.column-item.selected');
        if (!selectedColumn) {
          showToast('يرجى اختيار عمود للتعديل', 'warning');
          return;
        }
        
        const columnId = parseInt(selectedColumn.dataset.id);
        const column = customColumns.find(c => c.id === columnId);
        
        if (column) {
          column.name = document.getElementById('editColumnName').value.trim();
          column.type = document.getElementById('editColumnType').value;
          column.required = document.getElementById('editColumnRequired').checked;
          column.description = document.getElementById('editColumnDescription').value.trim();
          
          saveCustomColumns();
          renderCustomColumnsList();
          showToast('تم حفظ التعديلات بنجاح', 'success');
        }
      });
    }
    
    if (deleteColumnBtn) {
      deleteColumnBtn.addEventListener('click', function() {
        const selectedColumn = document.querySelector('.column-item.selected');
        if (!selectedColumn) {
          showToast('يرجى اختيار عمود للحذف', 'warning');
          return;
        }
        
        if (confirm('هل أنت متأكد من حذف هذا العمود؟')) {
          const columnId = parseInt(selectedColumn.dataset.id);
          customColumns = customColumns.filter(c => c.id !== columnId);
          saveCustomColumns();
          renderCustomColumnsList();
          showToast('تم حذف العمود بنجاح', 'success');
        }
      });
    }
  }
  
  // أزرار الجداول الزمنية
  function setupScheduleButtons() {
    const addScheduleBtn = document.getElementById('addScheduleBtn');
    const saveScheduleBtn = document.getElementById('saveScheduleBtn');
    const deleteScheduleBtn = document.getElementById('deleteScheduleBtn');
    
    if (addScheduleBtn) {
      addScheduleBtn.addEventListener('click', function() {
        const title = document.getElementById('newScheduleTitle').value.trim();
        const day = document.getElementById('newScheduleDay').value;
        const startTime = document.getElementById('newScheduleStart').value;
        const endTime = document.getElementById('newScheduleEnd').value;
        const description = document.getElementById('newScheduleDescription').value.trim();
        
        if (!title || !startTime || !endTime) {
          showToast('يرجى إدخال جميع البيانات المطلوبة', 'error');
          return;
        }
        
        const schedule = {
          id: Date.now(),
          title: title,
          day: day,
          startTime: startTime,
          endTime: endTime,
          description: description,
          active: true,
          createdAt: new Date().toISOString()
        };
        
        schedules.push(schedule);
        saveSchedules();
        renderSchedulesList();
        
        document.getElementById('newScheduleTitle').value = '';
        document.getElementById('newScheduleDay').value = 'الأحد';
        document.getElementById('newScheduleStart').value = '';
        document.getElementById('newScheduleEnd').value = '';
        document.getElementById('newScheduleDescription').value = '';
        
        showToast('تم إضافة الجدول بنجاح', 'success');
      });
    }
  }
  // أزرار ملخص الحلقة
  function setupSummaryButtons() {
    const saveSummaryBtn = document.getElementById('saveSummaryBtn');
    const activateSummaryBtn = document.getElementById('activateSummaryBtn');
    
    if (saveSummaryBtn) {
      saveSummaryBtn.addEventListener('click', function() {
        const title = document.getElementById('summaryTitle').value.trim();
        const content = document.getElementById('summaryContent').value.trim();
        const date = document.getElementById('summaryDate').value;
        
        if (!title || !content) {
          showToast('يرجى إدخال عنوان ومحتوى الملخص', 'error');
          return;
        }
        
        const summary = {
          id: Date.now(),
          title: title,
          content: content,
          date: date,
          createdAt: new Date().toISOString(),
          active: false
        };
        
        sessionSummaries.push(summary);
        saveSessionSummaries();
        renderSessionSummariesList();
        
        document.getElementById('summaryTitle').value = '';
        document.getElementById('summaryContent').value = '';
        document.getElementById('summaryDate').value = new Date().toISOString().split('T')[0];
        
        showToast('تم حفظ ملخص الحلقة بنجاح', 'success');
      });
    }
    
    if (activateSummaryBtn) {
      activateSummaryBtn.addEventListener('click', function() {
        const selectedSummary = document.querySelector('.summary-item.selected');
        if (!selectedSummary) {
          showToast('يرجى اختيار ملخص للتفعيل', 'warning');
          return;
        }
        
        const summaryId = parseInt(selectedSummary.dataset.id);
        
        // إلغاء تفعيل جميع الملخصات
        sessionSummaries.forEach(s => s.active = false);
        
        // تفعيل الملخص المختار
        const summary = sessionSummaries.find(s => s.id === summaryId);
        if (summary) {
          summary.active = true;
          saveSessionSummaries();
          renderSessionSummariesList();
          showToast('تم تفعيل ملخص الحلقة بنجاح', 'success');
        }
      });
    }
  }
  

  
  // أزرار الإحصائيات
  function setupStatisticsButtons() {
    // تحديث الإحصائيات عند الضغط على أزرار التقارير
    const reportButtons = document.querySelectorAll('[onclick*="generate"]');
    reportButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        updateStatistics();
      });
    });
  }
  

  
  // تحديث حالة الحضور والانصراف
  function updateAttendanceStatus() {
    const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
    const departureOpen = localStorage.getItem('departureOpen') === 'true';
    
    const checkInBtn = document.getElementById('checkInBtn');
    const checkOutBtn = document.getElementById('checkOutBtn');
    const studentNameInput = document.getElementById('studentName');
    const timeStatus = document.getElementById('timeStatus');
    const attendanceTimes = document.getElementById('attendanceTimes');
    const departureTimes = document.getElementById('departureTimes');
    
    // تحديث المواعيد من الإعدادات
    const attendanceStart = localStorage.getItem('attendanceStart') || '06:00';
    const attendanceEnd = localStorage.getItem('attendanceEnd') || '08:00';
    const departureStart = localStorage.getItem('departureStart') || '08:00';
    const departureEnd = localStorage.getItem('departureEnd') || '10:00';
    
    if (attendanceTimes) {
      attendanceTimes.textContent = `${attendanceStart} - ${attendanceEnd}`;
    }
    
    if (departureTimes) {
      departureTimes.textContent = `${departureStart} - ${departureEnd}`;
    }
    
    // تحديث حالة التسجيل
    if (timeStatus) {
      if (attendanceOpen || departureOpen) {
        timeStatus.innerHTML = '✅ التسجيل مفتوح الآن';
        timeStatus.style.color = '#28a745';
      } else {
        timeStatus.innerHTML = '❌ التسجيل مغلق الآن';
        timeStatus.style.color = '#dc3545';
      }
    }
    
    if (checkInBtn) {
      checkInBtn.disabled = !attendanceOpen;
      checkInBtn.style.opacity = attendanceOpen ? '1' : '0.5';
      checkInBtn.textContent = attendanceOpen ? 'تسجيل الحضور' : 'تسجيل الحضور (مغلق)';
    }
    
    if (checkOutBtn) {
      checkOutBtn.disabled = !departureOpen;
      checkOutBtn.style.opacity = departureOpen ? '1' : '0.5';
      checkOutBtn.textContent = departureOpen ? 'تسجيل الانصراف' : 'تسجيل الانصراف (مغلق)';
    }
    
    if (studentNameInput) {
      const attendanceOpen = localStorage.getItem('attendanceOpen') === 'true';
      const departureOpen = localStorage.getItem('departureOpen') === 'true';
      
      if (attendanceOpen || departureOpen) {
        // التسجيل مفتوح
        studentNameInput.disabled = false;
        studentNameInput.placeholder = 'أدخلي اسمك الكامل';
        studentNameInput.style.backgroundColor = '#ffffff';
        studentNameInput.style.color = '#333';
        studentNameInput.style.borderColor = '#BD9750';
      } else {
        // التسجيل مغلق
        studentNameInput.disabled = true;
        studentNameInput.placeholder = 'التسجيل مغلق - انتظر موعد التسجيل';
        studentNameInput.style.backgroundColor = '#f5f5f5';
        studentNameInput.style.color = '#999';
        studentNameInput.style.borderColor = '#ddd';
        studentNameInput.value = ''; // مسح أي قيمة موجودة
      }
    }
  }
  
  // تحميل الإعدادات
  function loadAdminSettings() {
    // تحميل حالة الحضور والانصراف
    updateAttendanceStatus();
    
    // تحديث المواعيد والحالة عند تحميل الصفحة
    setTimeout(() => {
      updateAttendanceStatus();
    }, 100);
    
    // تحميل المواعيد
    const attendanceStart = localStorage.getItem('attendanceStart') || '06:00';
    const attendanceEnd = localStorage.getItem('attendanceEnd') || '08:00';
    const departureStart = localStorage.getItem('departureStart') || '08:00';
    const departureEnd = localStorage.getItem('departureEnd') || '10:00';
    
    if (document.getElementById('attendanceStart')) document.getElementById('attendanceStart').value = attendanceStart;
    if (document.getElementById('attendanceEnd')) document.getElementById('attendanceEnd').value = attendanceEnd;
    if (document.getElementById('departureStart')) document.getElementById('departureStart').value = departureStart;
    if (document.getElementById('departureEnd')) document.getElementById('departureEnd').value = departureEnd;
    
    // تحميل المشرفين
    try {
      const savedAdmins = localStorage.getItem('afnan_admins');
      admins = savedAdmins ? JSON.parse(savedAdmins) : [];
      
      // إضافة مشرف افتراضي إذا لم يكن هناك مشرفين
      if (admins.length === 0) {
        admins = [{ username: 'admin', password: 'admin123' }];
        localStorage.setItem('afnan_admins', JSON.stringify(admins));
      }
    } catch(e) {
      admins = [{ username: 'admin', password: 'admin123' }];
      localStorage.setItem('afnan_admins', JSON.stringify(admins));
    }
  }
  
  // دوال إعادة تعيين الإعدادات
  function resetAllSettings() {
    localStorage.removeItem('attendanceOpen');
    localStorage.removeItem('departureOpen');
    localStorage.removeItem('attendanceStart');
    localStorage.removeItem('attendanceEnd');
    localStorage.removeItem('departureStart');
    localStorage.removeItem('departureEnd');
    localStorage.removeItem('afnan_students');
    localStorage.removeItem('afnan_custom_columns');
    localStorage.removeItem('afnan_schedules');
    localStorage.removeItem('afnan_session_summaries');

    
    // إعادة تحميل الصفحة
    setTimeout(() => {
      window.location.reload();
    }, 1000);
  }
  
  // تصدير جميع البيانات
  function exportAllData() {
    const data = {
      students: students || [],
      customColumns: customColumns || [],
      schedules: schedules || [],
      sessionSummaries: sessionSummaries || [],

      settings: {
        attendanceOpen: localStorage.getItem('attendanceOpen'),
        departureOpen: localStorage.getItem('departureOpen'),
        attendanceStart: localStorage.getItem('attendanceStart'),
        attendanceEnd: localStorage.getItem('attendanceEnd'),
        departureStart: localStorage.getItem('departureStart'),
        departureEnd: localStorage.getItem('departureEnd')
      }
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `afnan_academy_data_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    showToast('تم تصدير البيانات بنجاح', 'success');
  }
  
  // استيراد البيانات
  function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            if (data.students) {
              students = data.students;
              saveStudents();
            }
            if (data.customColumns) {
              customColumns = data.customColumns;
              saveCustomColumns();
            }
            if (data.schedules) {
              schedules = data.schedules;
              saveSchedules();
            }
            if (data.sessionSummaries) {
              sessionSummaries = data.sessionSummaries;
              saveSessionSummaries();
            }

            if (data.settings) {
              Object.keys(data.settings).forEach(key => {
                if (data.settings[key]) {
                  localStorage.setItem(key, data.settings[key]);
                }
              });
            }
            
            // إعادة تحميل الصفحة
            window.location.reload();
            showToast('تم استيراد البيانات بنجاح', 'success');
          } catch (error) {
            showToast('خطأ في قراءة الملف', 'error');
          }
        };
        reader.readAsText(file);
      }
    };
    input.click();
  }
  
  // تحديث الإحصائيات
  function updateStatistics() {
    const totalStudents = students ? students.length : 0;
    const attendanceRate = calculateAttendanceRate();
    const activeSchedules = schedules ? schedules.filter(s => s.active).length : 0;
    
    if (document.getElementById('totalStudents')) {
      document.getElementById('totalStudents').textContent = totalStudents;
    }
    if (document.getElementById('attendanceRate')) {
      document.getElementById('attendanceRate').textContent = attendanceRate + '%';
    }
    if (document.getElementById('activeSchedules')) {
      document.getElementById('activeSchedules').textContent = activeSchedules;
    }
  }
  
  // حساب معدل الحضور
  function calculateAttendanceRate() {
    if (!students || students.length === 0) return 0;
    
    let totalAttendance = 0;
    let totalSessions = 0;
    
    students.forEach(student => {
      if (student.attendance) {
        totalSessions += student.attendance.length;
        totalAttendance += student.attendance.filter(a => a.status === 'present').length;
      }
    });
    
    return totalSessions > 0 ? Math.round((totalAttendance / totalSessions) * 100) : 0;
  }
  
  // دوال مساعدة إضافية
  function loadStudents() {
    try {
      const savedStudents = localStorage.getItem('afnan_students');
      students = savedStudents ? JSON.parse(savedStudents) : [];
    } catch(e) {
      students = [];
    }
  }
  
  function saveStudents() {
    localStorage.setItem('afnan_students', JSON.stringify(students));
  }
  
  function loadCustomColumns() {
    try {
      const savedColumns = localStorage.getItem('afnan_custom_columns');
      customColumns = savedColumns ? JSON.parse(savedColumns) : [];
    } catch(e) {
      customColumns = [];
    }
  }
  
  function saveCustomColumns() {
    localStorage.setItem('afnan_custom_columns', JSON.stringify(customColumns));
  }
  
  function loadSchedules() {
    try {
      const savedSchedules = localStorage.getItem('afnan_schedules');
      schedules = savedSchedules ? JSON.parse(savedSchedules) : [];
    } catch(e) {
      schedules = [];
    }
  }
  
  function saveSchedules() {
    localStorage.setItem('afnan_schedules', JSON.stringify(schedules));
  }
  
  function loadSessionSummaries() {
    try {
      const savedSummaries = localStorage.getItem('afnan_session_summaries');
      sessionSummaries = savedSummaries ? JSON.parse(savedSummaries) : [];
    } catch(e) {
      sessionSummaries = [];
    }
  }
  
  function saveSessionSummaries() {
    localStorage.setItem('afnan_session_summaries', JSON.stringify(sessionSummaries));
  }
  

  
  // دوال عرض القوائم
  function renderStudentsList() {
    const studentsList = document.getElementById('studentsList');
    if (!studentsList) return;
    
    if (!students || students.length === 0) {
      studentsList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #888;">
          لا توجد طالبات مسجلات حالياً
        </div>
      `;
      return;
    }
    
    studentsList.innerHTML = students.map((student, index) => `
      <div class="student-item" data-id="${student.id}" onclick="selectStudent(${student.id})">
        <div class="student-info">
          <h4>${student.name}</h4>
          <p>الهاتف: ${student.phone || 'غير محدد'}</p>
          <p>المستوى: ${student.level}</p>
        </div>
      </div>
    `).join('');
  }
  
  function renderAdminsList() {
    const adminsList = document.getElementById('adminsList');
    if (!adminsList) return;
    
    if (!admins || admins.length === 0) {
      adminsList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #888;">
          لا يوجد مشرفين مسجلين حالياً
        </div>
      `;
      return;
    }
    
    adminsList.innerHTML = admins.map((admin, index) => `
      <div class="admin-item" data-id="${admin.id || index}">
        <div class="admin-info">
          <h4>${admin.username}</h4>
          <p>تم الإضافة: ${new Date(admin.addedAt || Date.now()).toLocaleDateString('ar-SA')}</p>
        </div>
        <button onclick="deleteAdmin(${index})" class="form-btn red-btn">حذف</button>
      </div>
    `).join('');
  }
  
  function renderCustomColumnsList() {
    const columnsList = document.getElementById('customColumnsList');
    if (!columnsList) return;
    
    if (!customColumns || customColumns.length === 0) {
      columnsList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #888;">
          لا توجد أعمدة مخصصة مضافة حالياً
        </div>
      `;
      return;
    }
    
    columnsList.innerHTML = customColumns.map((column, index) => `
      <div class="column-item" data-id="${column.id}" onclick="selectColumn(${column.id})">
        <div class="column-info">
          <h4>${column.name}</h4>
          <p>النوع: ${column.type}</p>
          <p>إجباري: ${column.required ? 'نعم' : 'لا'}</p>
        </div>
      </div>
    `).join('');
  }
  
  function renderSchedulesList() {
    const schedulesList = document.getElementById('schedulesList');
    if (!schedulesList) return;
    
    if (!schedules || schedules.length === 0) {
      schedulesList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #888;">
          لا توجد جداول زمنية مضافة حالياً
        </div>
      `;
      return;
    }
    
    schedulesList.innerHTML = schedules.map((schedule, index) => `
      <div class="schedule-item" data-id="${schedule.id}">
        <div class="schedule-info">
          <h4>${schedule.title}</h4>
          <p>اليوم: ${schedule.day}</p>
          <p>الوقت: ${schedule.startTime} - ${schedule.endTime}</p>
          <p>الحالة: ${schedule.active ? 'نشط' : 'غير نشط'}</p>
        </div>
      </div>
    `).join('');
  }
  
  function renderSessionSummariesList() {
    const summariesList = document.getElementById('sessionSummariesList');
    if (!summariesList) return;
    
    if (!sessionSummaries || sessionSummaries.length === 0) {
      summariesList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #888;">
          لا توجد ملخصات حلقات مضافة حالياً
        </div>
      `;
      return;
    }
    
    summariesList.innerHTML = sessionSummaries.map((summary, index) => `
      <div class="summary-item" data-id="${summary.id}" onclick="selectSummary(${summary.id})">
        <div class="summary-info">
          <h4>${summary.title}</h4>
          <p>التاريخ: ${summary.date}</p>
          <p>الحالة: ${summary.active ? 'مفعل' : 'غير مفعل'}</p>
        </div>
      </div>
    `).join('');
  }
  

  
  // دوال اختيار العناصر
  function selectStudent(id) {
    document.querySelectorAll('.student-item').forEach(item => item.classList.remove('selected'));
    document.querySelector(`[data-id="${id}"]`).classList.add('selected');
    
    const student = students.find(s => s.id === id);
    if (student) {
      document.getElementById('editStudentName').value = student.name;
      document.getElementById('editStudentPhone').value = student.phone || '';
      document.getElementById('editStudentLevel').value = student.level;
    }
  }
  
  function selectColumn(id) {
    document.querySelectorAll('.column-item').forEach(item => item.classList.remove('selected'));
    document.querySelector(`[data-id="${id}"]`).classList.add('selected');
    
    const column = customColumns.find(c => c.id === id);
    if (column) {
      document.getElementById('editColumnName').value = column.name;
      document.getElementById('editColumnType').value = column.type;
      document.getElementById('editColumnRequired').checked = column.required;
      document.getElementById('editColumnDescription').value = column.description || '';
    }
  }
  
  function selectSummary(id) {
    document.querySelectorAll('.summary-item').forEach(item => item.classList.remove('selected'));
    document.querySelector(`[data-id="${id}"]`).classList.add('selected');
  }
  
  function deleteAdmin(index) {
    if (admins.length > 1) {
      admins.splice(index, 1);
      saveAdmins();
      renderAdminsList();
      showToast('تم حذف المشرف بنجاح', 'success');
    } else {
      showToast('يجب أن يبقى مشرف واحد على الأقل', 'warning');
    }
  }
  
  function saveAdmins() {
    localStorage.setItem('afnan_admins', JSON.stringify(admins));
  }
  
  // تعريف المتغيرات العامة (إذا لم تكن معرفة مسبقاً)
  if (typeof students === 'undefined') {
    window.students = [];
  }
  if (typeof customColumns === 'undefined') {
    window.customColumns = [];
  }
  if (typeof schedules === 'undefined') {
    window.schedules = [];
  }
  if (typeof sessionSummaries === 'undefined') {
    window.sessionSummaries = [];
  }

  if (typeof admins === 'undefined') {
    window.admins = [];
  }
  
  </script>
  
  <!-- CSS للحديث في الفوتر -->
  <style>
  .afnan-footer {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef) !important;
    color: #2c3e50 !important;
    border-top: 3px solid #BD9750 !important;
    padding: 20px 0 15px 0 !important;
    position: relative;
    overflow: hidden;
  }
  

  
  .afnan-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }
  
  .afnan-footer .footer-hadith-container {
    text-align: center;
    max-width: 600px;
  }
  
  .afnan-footer .footer-hadith-title {
    color: #BD9750 !important;
    font-size: 0.95rem !important;
    font-weight: 600 !important;
    margin-bottom: 8px !important;
    font-family: 'Cairo', sans-serif !important;
  }
  
  .afnan-footer .footer-hadith-text {
    color: #2c3e50 !important;
    font-size: 1.4rem !important;
    font-weight: bold !important;
    margin-bottom: 8px !important;
    line-height: 1.4 !important;
    padding: 0 15px !important;
    font-family: 'Amiri', 'Cairo', serif !important;
    position: relative;
    z-index: 2;
  }
  

  
  .afnan-footer .footer-narrator {
    color: #BD9750 !important;
    font-size: 0.85rem !important;
    font-weight: 500 !important;
    font-style: italic;
    margin-bottom: 5px;
  }
  
  .afnan-footer .footer-academy-info {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }
  
  .afnan-footer .footer-logo {
    margin-bottom: 10px;
  }
  
  .afnan-footer .footer-logo-icon {
    font-size: 1.8rem;
    margin-bottom: 5px;
  }
  
  .afnan-footer .footer-logo-text {
    color: #BD9750 !important;
    font-size: 0.95rem !important;
    font-weight: 600 !important;
    font-family: 'Cairo', sans-serif !important;
  }
  .afnan-footer .footer-copyright {
    color: #6c757d !important;
    font-size: 0.8rem !important;
    font-weight: 400 !important;
  }
  
  @media (max-width: 768px) {
    .afnan-footer {
      padding: 18px 0 12px 0 !important;
    }
    
    .afnan-footer .footer-content {
      padding: 0 15px;
      gap: 12px;
    }
    
    .afnan-footer .footer-hadith-text {
      font-size: 1.2rem !important;
      padding: 0 12px !important;
    }
    
    .afnan-footer .footer-hadith-title {
      font-size: 0.9rem !important;
    }
    
    .afnan-footer .footer-logo-icon {
      font-size: 1.6rem;
    }
    
    .afnan-footer .footer-logo-text {
      font-size: 0.9rem !important;
    }
  }
  
  @media (max-width: 480px) {
    .afnan-footer {
      padding: 15px 0 10px 0 !important;
    }
    
    .afnan-footer .footer-content {
      padding: 0 10px;
      gap: 10px;
    }
    
    .afnan-footer .footer-hadith-text {
      font-size: 1.1rem !important;
      padding: 0 8px !important;
    }
    
    .afnan-footer .footer-hadith-title {
      font-size: 0.85rem !important;
    }
    
    .afnan-footer .footer-narrator {
      font-size: 0.8rem !important;
    }
    
    .afnan-footer .footer-copyright {
      font-size: 0.75rem !important;
    }
    
    .afnan-footer .footer-logo-icon {
      font-size: 1.5rem;
    }
    
      .afnan-footer .footer-logo-text {
    font-size: 0.85rem !important;
  }
}

/* تحسين مظهر قسم إعدادات وصف الأكاديمية */
.academy-desc-settings .form-group {
  margin-bottom: 15px;
}

.academy-desc-settings .form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
  color: #2c3e50;
}

.academy-desc-settings .form-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.academy-desc-settings .form-input:focus {
  border-color: #BD9750;
  box-shadow: 0 0 0 2px rgba(189, 151, 80, 0.2);
  outline: none;
}

.academy-desc-settings select.form-input {
  cursor: pointer;
}

.academy-desc-settings .form-group-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  align-items: end;
}

  @media (max-width: 768px) {
    .academy-desc-settings .form-group-row {
      grid-template-columns: 1fr;
      gap: 10px;
    }
  }
  
  /* CSS لأزرار ملخص الحلقة */
  .summary-fields-container {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .summary-fields-container h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.1rem;
    border-bottom: 2px solid #BD9750;
    padding-bottom: 8px;
  }
  
  .summary-field-row {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    gap: 15px;
    flex-wrap: wrap;
  }
  
  .field-label {
    min-width: 120px;
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
  }
  
  .field-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    flex: 1;
  }
  
  .field-text {
    width: 120px;
    padding: 6px 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.85rem;
    background: white;
  }
  
  .field-font, .field-size, .field-weight {
    width: 100px;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.8rem;
    background: white;
    cursor: pointer;
  }
  
  .field-color {
    width: 40px;
    height: 32px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    padding: 0;
  }
  
  .field-color::-webkit-color-swatch-wrapper {
    padding: 0;
  }
  
  .field-color::-webkit-color-swatch {
    border: none;
    border-radius: 3px;
  }
  
  /* معاينة الحقول */
  .summary-preview {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
  }
  
  .summary-preview h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.1rem;
    border-bottom: 2px solid #BD9750;
    padding-bottom: 8px;
  }
  
  .preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .preview-field {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #f8f9fa;
    font-size: 0.9rem;
    min-width: 100px;
    text-align: center;
    transition: all 0.3s ease;
  }
  
  .preview-field:hover {
    border-color: #BD9750;
    box-shadow: 0 2px 4px rgba(189, 151, 80, 0.2);
  }
  
  /* CSS لقسم ملخص الحلقة للطلاب */
  .session-summary-section {
    background: #fffbe6;
    border: 1.5px solid #BD9750;
    border-radius: 12px;
    padding: 25px;
    margin-top: 30px;
    box-shadow: 0 4px 12px rgba(189, 151, 80, 0.15);
  }
  
  .summary-header {
    text-align: center;
    margin-bottom: 25px;
  }
  
  .summary-title {
    color: #BD9750;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 15px;
    border-bottom: 2px solid #BD9750;
    padding-bottom: 10px;
  }
  
  .summary-info {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
  }
  
  .summary-field {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.9rem;
    color: #2c3e50;
    min-width: 120px;
    text-align: center;
  }
  
  .summary-form-link {
    color: #8B4513;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    text-decoration: underline;
    transition: color 0.3s ease;
  }
  
  .summary-form-link:hover {
    color: #BD9750;
  }
  
  /* جدول الطالبات - محسن للهاتف */
  .students-table-container {
    margin: 25px 0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .students-table {
    width: 100%;
    min-width: 300px;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    table-layout: auto;
  }
  
  .students-table th {
    background: #BD9750;
    color: white;
    padding: 12px 8px;
    text-align: center;
    font-weight: 600;
    font-size: 0.9rem;
    white-space: nowrap;
    min-width: 80px;
  }
  
  .students-table td {
    padding: 10px 8px;
    text-align: center;
    border-bottom: 1px solid #e9ecef;
    font-size: 0.85rem;
    word-wrap: break-word;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px;
  }
  
  .students-table tr:hover {
    background: #f8f9fa;
  }
  
  /* تحسين عرض اسم الطالبة */
  .students-table td:first-child {
    text-align: right;
    font-weight: 500;
    color: #2c3e50;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 120px;
    min-width: 100px;
  }
  
  /* أنماط الأعمدة الجديدة */
  .attendance-type-header {
    background: #17a2b8;
    min-width: 80px;
  }
  
  .departure-status-header {
    background: #ffc107;
    color: #212529;
    min-width: 80px;
  }
  
  .time-header {
    background: #6f42c1;
    min-width: 100px;
  }
  
  .student-name-header {
    min-width: 120px;
  }
  
  .attendance-status-header {
    min-width: 80px;
  }
  
  /* تحسين عرض الأعمدة حسب عددها */
  .students-table th:nth-child(1) {
    min-width: 120px;
  }
  
  .students-table th:nth-child(2) {
    min-width: 80px;
  }
  
  .students-table th:nth-child(3) {
    min-width: 80px;
  }
  
  .students-table th:nth-child(4) {
    min-width: 80px;
  }
  
  .students-table th:nth-child(5) {
    min-width: 100px;
  }
  
  /* تحسينات للهاتف */
  @media (max-width: 768px) {
    .students-table-container {
      margin: 15px 0;
      border-radius: 6px;
    }
    
    .students-table {
      min-width: 280px;
      font-size: 0.8rem;
    }
    
    .students-table th {
      padding: 8px 6px;
      font-size: 0.8rem;
      min-width: 60px;
    }
    
    .students-table td {
      padding: 8px 6px;
      font-size: 0.75rem;
      max-width: 100px;
    }
    
    .students-table td:first-child {
      max-width: 80px;
      min-width: 80px;
      font-size: 0.8rem;
    }
    
    .students-table th:nth-child(1) {
      min-width: 80px;
    }
    
    .students-table th:nth-child(2) {
      min-width: 60px;
    }
    
    .students-table th:nth-child(3) {
      min-width: 60px;
    }
    
    .students-table th:nth-child(4) {
      min-width: 60px;
    }
    
    .students-table th:nth-child(5) {
      min-width: 80px;
    }
  }
  
  @media (max-width: 480px) {
    .students-table-container {
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .students-table {
      min-width: 250px;
      font-size: 0.7rem;
    }
    
    .students-table th {
      padding: 6px 4px;
      font-size: 0.7rem;
      min-width: 50px;
    }
    
    .students-table td {
      padding: 6px 4px;
      font-size: 0.65rem;
      max-width: 80px;
    }
    
    .students-table td:first-child {
      max-width: 70px;
      min-width: 70px;
      font-size: 0.7rem;
    }
    
    .students-table th:nth-child(1) {
      min-width: 70px;
    }
    
    .students-table th:nth-child(2) {
      min-width: 50px;
    }
    
    .students-table th:nth-child(3) {
      min-width: 50px;
    }
    
    .students-table th:nth-child(4) {
      min-width: 50px;
    }
    
    .students-table th:nth-child(5) {
      min-width: 70px;
    }
    
    /* تحسين tooltip على الهاتف */
    .students-table td:first-child[title]:hover::after {
      display: none;
    }
    
    /* إضافة tap للهاتف لعرض الاسم الكامل */
    .students-table td:first-child[title]:active::after {
      content: attr(title);
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 10000;
      pointer-events: none;
      max-width: 80vw;
      text-align: center;
    }
  }
  
  /* تحسينات للشاشات الصغيرة جداً */
  @media (max-width: 360px) {
    .students-table {
      min-width: 200px;
    }
    
    .students-table th {
      padding: 4px 2px;
      font-size: 0.65rem;
      min-width: 40px;
    }
    
    .students-table td {
      padding: 4px 2px;
      font-size: 0.6rem;
      max-width: 60px;
    }
    
    .students-table td:first-child {
      max-width: 60px;
      min-width: 60px;
      font-size: 0.65rem;
    }
  }
  
  /* تحسينات إضافية للجدول */
  .students-table {
    table-layout: auto;
    width: auto;
    min-width: 100%;
  }
  
  .students-table td {
    position: relative;
  }
  
  .students-table td:first-child {
    position: relative;
  }
  
  /* تحسين عرض الأسماء الطويلة */
  .students-table td:first-child {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  /* إضافة tooltip للأسماء المختصرة */
  .students-table td:first-child[title]:hover::after {
    content: attr(title);
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 1000;
    pointer-events: none;
  }
  
  /* تحسين التمرير الأفقي */
  .students-table-container {
    scrollbar-width: thin;
    scrollbar-color: #BD9750 #f1f1f1;
  }
  
  .students-table-container::-webkit-scrollbar {
    height: 8px;
  }
  
  .students-table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  
  .students-table-container::-webkit-scrollbar-thumb {
    background: #BD9750;
    border-radius: 4px;
  }
  
  .students-table-container::-webkit-scrollbar-thumb:hover {
    background: #8B6F2F;
  }
  
  /* علامات الحالة */
  .status-check {
    color: #28a745;
    font-size: 1.2rem;
    font-weight: bold;
  }
  
  .status-cross {
    color: #dc3545;
    font-size: 1.2rem;
    font-weight: bold;
  }
  
  /* التنبيهات والملاحظات */
  .session-warnings {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 20px;
    margin: 25px 0;
  }
  
  .session-warnings h3 {
    color: #856404;
    margin-bottom: 15px;
    font-size: 1.1rem;
    font-weight: 600;
  }
  
  .warnings-content {
    color: #856404;
    line-height: 1.6;
    font-size: 0.9rem;
  }
  
  /* زر تصدير PDF */
  .export-section {
    text-align: center;
    margin-top: 25px;
  }
  .export-pdf-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .export-pdf-btn:hover {
    background: #c82333;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
  }
  
  .export-pdf-btn i {
    font-size: 1rem;
  }
  
  /* CSS لإعدادات عرض ملخص الحلقة */
  .summary-display-settings {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
  }
  
  .summary-display-settings h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.1rem;
    border-bottom: 2px solid #28a745;
    padding-bottom: 8px;
  }
  
  .summary-display-settings .form-group {
    margin-bottom: 15px;
  }
  
  .summary-display-settings .form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2c3e50;
  }
  
  .summary-display-settings .form-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .summary-display-settings .form-input:focus {
    border-color: #28a745;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
    outline: none;
  }
  
  .summary-display-settings textarea.form-input {
    resize: vertical;
    min-height: 80px;
  }
  
  /* CSS لإعدادات عرض ملخص الحلقة للإدارة */
  .summary-admin-settings {
    background: #f0f8ff;
    border: 1px solid #b3d9ff;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
  }
  
  .summary-admin-settings h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.1rem;
    border-bottom: 2px solid #007bff;
    padding-bottom: 8px;
  }
  
  .summary-admin-settings .form-group {
    margin-bottom: 15px;
  }
  
  .summary-admin-settings .form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2c3e50;
  }
  
  .summary-admin-settings .form-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .summary-admin-settings .form-input:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
    outline: none;
  }
  
  /* تحسينات للهاتف */
  @media (max-width: 768px) {
    .session-summary-section {
      padding: 20px 15px;
      margin-top: 20px;
    }
    
    .summary-title {
      font-size: 1.5rem;
    }
    
    .summary-info {
      flex-direction: column;
      align-items: center;
    }
    
    .summary-field {
      width: 100%;
      max-width: 200px;
    }
    
    .students-table th,
    .students-table td {
      padding: 8px 10px;
      font-size: 0.85rem;
    }
    
    .export-pdf-btn {
      width: 100%;
      justify-content: center;
    }
  }
  
  /* تحسينات للهاتف */
  @media (max-width: 768px) {
    .summary-field-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    
    .field-label {
      min-width: auto;
      width: 100%;
    }
    
    .field-controls {
      width: 100%;
      justify-content: flex-start;
    }
    
    .field-text {
      width: 100px;
    }
    
    .field-font, .field-size, .field-weight {
      width: 80px;
    }
    
    .preview-container {
      flex-direction: column;
    }
    
    .preview-field {
      width: 100%;
      min-width: auto;
    }
  }
  
  /* CSS للأزرار والعناصر المحددة */
  .student-item, .column-item, .summary-item {
    padding: 10px;
    margin: 5px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .student-item:hover, .column-item:hover, .summary-item:hover {
    background-color: #f8f9fa;
    border-color: #BD9750;
  }
  
  .student-item.selected, .column-item.selected, .summary-item.selected {
    background-color: #e3f2fd;
    border-color: #2196f3;
    box-shadow: 0 2px 4px rgba(33, 150, 243, 0.2);
  }
  
  .admin-item, .schedule-item, .message-item {
    padding: 10px;
    margin: 5px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .form-btn {
    transition: all 0.2s ease;
  }
  
  .form-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .form-btn:active {
    transform: translateY(0);
  }
  
  /* CSS للأزرار الإدارية الجديدة */
  .admin-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Cairo', sans-serif;
    min-height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .admin-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  
  .admin-btn:active {
    transform: translateY(0);
  }
  
  .admin-btn.gold-btn {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
  }
  
  .admin-btn.gold-btn:hover {
    background: linear-gradient(135deg, #e67e22, #d35400);
  }
  
  .admin-btn.red-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
  }
  
  .admin-btn.red-btn:hover {
    background: linear-gradient(135deg, #c0392b, #a93226);
  }
  
  .admin-btn.green-btn {
    background: linear-gradient(135deg, #27ae60, #229954);
    color: white;
  }
  
  .admin-btn.green-btn:hover {
    background: linear-gradient(135deg, #229954, #1e8449);
  }
  
  .admin-btn.blue-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
  }
  
  .admin-btn.blue-btn:hover {
    background: linear-gradient(135deg, #2980b9, #21618c);
  }
  
  /* تحسين أزرار الإدارة الأخرى */
  .admin-section .form-btn {
    padding: 10px 18px;
    font-size: 0.85rem;
    border-radius: 6px;
    margin: 5px;
  }
  
  /* تحسين أقسام الإدارة */
  .admin-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  
  .admin-section h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.2rem;
    border-bottom: 2px solid #BD9750;
    padding-bottom: 8px;
  }
  
  /* تحسين حقول الإدخال */
  .admin-section input, .admin-section textarea, .admin-section select {
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .admin-section input:focus, .admin-section textarea:focus, .admin-section select:focus {
    border-color: #BD9750;
    box-shadow: 0 0 0 2px rgba(189, 151, 80, 0.2);
    outline: none;
  }
  
  /* تحسين التخطيط */
  .time-settings {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 15px;
  }
  
  .time-group {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  }
  
  .time-group h4 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-size: 1rem;
  }
  
  .time-inputs {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .time-inputs input {
    flex: 1;
  }
  
  .time-inputs span {
    color: #666;
    font-weight: 500;
  }
  
  /* تحسينات للهاتف المحمول */
  @media (max-width: 768px) {
    .admin-controls {
      grid-template-columns: 1fr !important;
      gap: 8px !important;
    }
    
    .admin-btn {
      padding: 10px 15px;
      font-size: 0.85rem;
      min-height: 40px;
    }
    
    .time-settings {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .admin-section {
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .admin-section h3 {
      font-size: 1.1rem;
    }
    
    .time-inputs {
      flex-direction: column;
      gap: 8px;
    }
    
    .time-inputs input {
      width: 100%;
    }
  }
  
  @media (max-width: 480px) {
    .admin-btn {
      padding: 8px 12px;
      font-size: 0.8rem;
      min-height: 35px;
    }
    
    .admin-section {
      padding: 12px;
    }
  }
  
  /* تحسين مظهر حقل اسم الطالبة */
  #studentName:disabled {
    background-color: #f5f5f5 !important;
    color: #999 !important;
    border-color: #ddd !important;
    cursor: not-allowed;
    opacity: 0.7;
  }
  
  #studentName:disabled::placeholder {
    color: #999 !important;
    font-style: italic;
  }
  
  #studentName:not(:disabled) {
    background-color: #ffffff !important;
    color: #333 !important;
    border-color: #BD9750 !important;
    cursor: text;
    opacity: 1;
  }
  
  #studentName:not(:disabled):focus {
    border-color: #BD9750 !important;
    box-shadow: 0 0 0 2px rgba(189, 151, 80, 0.2) !important;
  }
  </style>

  <script>
  // تحسينات الأداء العامة
  'use strict';
  
  // منع التحديثات المتكررة
  let isUpdating = false;
  
  // نظام إدارة الواجبات
  let homeworkData = {};

  // تحميل بيانات الواجبات من LocalStorage (محسن)
  function loadHomeworkData() {
    try {
      const savedData = localStorage.getItem('afnan_homework_data');
      if (savedData) {
        homeworkData = JSON.parse(savedData);
      } else {
        // البيانات الافتراضية
        homeworkData = {
          'level2-batch1': { password: '', links: [] },
          'level1-batch2': { password: '', links: [] },
          'level1-batch3': { password: '', links: [] }
        };
        // حفظ البيانات الافتراضية
        localStorage.setItem('afnan_homework_data', JSON.stringify(homeworkData));
      }
    } catch(e) {
      console.warn('خطأ في تحميل بيانات الواجبات:', e);
      homeworkData = {
        'level2-batch1': { password: '', links: [] },
        'level1-batch2': { password: '', links: [] },
        'level1-batch3': { password: '', links: [] }
      };
    }
    
    // تحميل البيانات في الخلفية لتجنب التأخير
    setTimeout(() => {
      renderHomeworkData();
    }, 100);
  }

  // حفظ بيانات الواجبات في LocalStorage (محسن)
  function saveHomeworkData() {
    try {
      localStorage.setItem('afnan_homework_data', JSON.stringify(homeworkData));
    } catch(e) {
      console.error('خطأ في حفظ بيانات الواجبات:', e);
      // محاولة تنظيف الذاكرة
      try {
        localStorage.clear();
        localStorage.setItem('afnan_homework_data', JSON.stringify(homeworkData));
      } catch(e2) {
        console.error('فشل في حفظ البيانات بعد التنظيف:', e2);
      }
    }
  }

  // عرض بيانات الواجبات في النماذج (محسن)
  function renderHomeworkData() {
    // تحسين الأداء - تجميع التحديثات
    const updates = [];
    
    Object.keys(homeworkData).forEach(level => {
      const passwordInput = document.getElementById(`${level}-password`);
      const linksInput = document.getElementById(`${level}-links`);
      
      if (passwordInput) {
        updates.push(() => {
          passwordInput.value = homeworkData[level].password || '';
        });
      }
      
      if (linksInput) {
        updates.push(() => {
          linksInput.value = homeworkData[level].links.join('\n') || '';
        });
      }
    });
    
    // تنفيذ التحديثات في الخلفية
    requestAnimationFrame(() => {
      updates.forEach(update => update());
    });
  }

  // تحديث كلمة المرور (محسن)
  function updateHomeworkPassword(level) {
    if (isUpdating) return; // منع التحديثات المتكررة
    
    const passwordInput = document.getElementById(`${level}-password`);
    const password = passwordInput.value.trim();
    
    if (!password) {
      showToast('يرجى إدخال كلمة المرور', 'error');
      return;
    }
    
    isUpdating = true;
    
    try {
      homeworkData[level].password = password;
      saveHomeworkData();
      showToast('تم تحديث كلمة المرور بنجاح', 'success');
    } catch(e) {
      console.error('خطأ في تحديث كلمة المرور:', e);
      showToast('حدث خطأ في التحديث', 'error');
    } finally {
      isUpdating = false;
    }
  }

  // تحديث روابط الواجبات
  function updateHomeworkLinks(level) {
    const linksInput = document.getElementById(`${level}-links`);
    const linksText = linksInput.value.trim();
    
    if (!linksText) {
      showToast('يرجى إدخال روابط الواجبات', 'error');
      return;
    }
    
    const links = linksText.split('\n').filter(link => link.trim() !== '');
    homeworkData[level].links = links;
    saveHomeworkData();
    showToast(`تم حفظ ${links.length} رابط بنجاح`, 'success');
  }
  // عرض الواجبات للمستخدم (مع كلمة المرور)
  function showHomeworkLevel(level) {
    const levelData = homeworkData[level];
    
    if (!levelData || !levelData.password) {
      showToast('لا توجد واجبات متاحة لهذا المستوى', 'warning');
      return;
    }
    
    const password = prompt(`أدخل كلمة المرور للمستوى ${getLevelName(level)}:`);
    
    if (!password) {
      return;
    }
    
    // تحويل الأرقام العربية إلى إنجليزية للمقارنة
    const normalizedPassword = normalizeNumbers(password);
    const normalizedStoredPassword = normalizeNumbers(levelData.password);
    
    if (normalizedPassword !== normalizedStoredPassword) {
      showToast('كلمة المرور غير صحيحة', 'error');
      return;
    }
    
    if (!levelData.links || levelData.links.length === 0) {
      showToast('لا توجد روابط واجبات متاحة', 'warning');
      return;
    }
    
    // إنشاء نافذة منبثقة لعرض الروابط
    const linksHtml = levelData.links.map((link, index) => {
      const lectureNumber = getArabicNumber(index + 1);
      return `<a href="${link}" target="_blank" style="display: block; padding: 10px; margin: 5px 0; background: #f7ecd6; border-radius: 8px; text-decoration: none; color: #8B6F2F; font-weight: 600;">
        رابط واجب المحاضرة ${lectureNumber}
      </a>`;
    }).join('');
    
    const popup = window.open('', '_blank', 'width=500,height=600,scrollbars=yes');
    popup.document.write(`
      <!DOCTYPE html>
      <html dir="rtl">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>واجبات ${getLevelName(level)}</title>
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          
          body { 
            font-family: 'Cairo', 'Tajawal', Arial, sans-serif; 
            padding: 20px; 
            background: #f8f9fa; 
            line-height: 1.6;
            color: #333;
          }
          
          h2 { 
            color: #8B6F2F; 
            text-align: center; 
            margin-bottom: 30px; 
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
          }
          
          a { 
            display: block; 
            padding: 18px 20px; 
            margin: 12px 0; 
            background: linear-gradient(135deg, #f7ecd6, #e6d7b8); 
            border-radius: 12px; 
            text-decoration: none; 
            color: #8B6F2F; 
            font-weight: 600; 
            font-size: 1.1rem;
            text-align: center;
            border: 2px solid #e6d7b8;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(139,111,47,0.1);
          }
          
          a:hover { 
            background: linear-gradient(135deg, #e6d7b8, #d4c4a8) !important; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139,111,47,0.2);
            border-color: #BD9750;
          }
          
          a:active {
            transform: translateY(0);
          }
          
          /* تحسين للهاتف */
          @media (max-width: 768px) {
            body {
              padding: 15px;
            }
            
            h2 {
              font-size: 1.5rem;
              margin-bottom: 25px;
            }
            
            a {
              padding: 20px 15px;
              font-size: 1.2rem;
              margin: 15px 0;
            }
          }
          
          /* تحسين للشاشات الصغيرة جداً */
          @media (max-width: 480px) {
            body {
              padding: 10px;
            }
            
            h2 {
              font-size: 1.3rem;
              margin-bottom: 20px;
            }
            
            a {
              padding: 18px 12px;
              font-size: 1.1rem;
              margin: 12px 0;
            }
          }
        </style>
      </head>
      <body>
        <h2>واجبات ${getLevelName(level)}</h2>
        ${linksHtml}
      </body>
      </html>
    `);
  }

  // الحصول على اسم المستوى
  function getLevelName(level) {
    const names = {
      'level2-batch1': 'المستوى الثاني الدُفعة الأولى',
      'level1-batch2': 'المستوى الأول الدُفعة الثانية',
      'level1-batch3': 'المستوى الأول الدُفعة الثالثة'
    };
    return names[level] || level;
  }

  // تحويل الأرقام إلى العربية
  function getArabicNumber(num) {
    const arabicNumbers = {
      1: 'الأولى',
      2: 'الثانية',
      3: 'الثالثة',
      4: 'الرابعة',
      5: 'الخامسة',
      6: 'السادسة',
      7: 'السابعة',
      8: 'الثامنة',
      9: 'التاسعة',
      10: 'العاشرة',
      11: 'الحادية عشرة',
      12: 'الثانية عشرة',
      13: 'الثالثة عشرة',
      14: 'الرابعة عشرة',
      15: 'الخامسة عشرة',
      16: 'السادسة عشرة',
      17: 'السابعة عشرة',
      18: 'الثامنة عشرة',
      19: 'التاسعة عشرة',
      20: 'العشرون',
      21: 'الحادية والعشرون',
      22: 'الثانية والعشرون',
      23: 'الثالثة والعشرون',
      24: 'الرابعة والعشرون',
      25: 'الخامسة والعشرون',
      26: 'السادسة والعشرون',
      27: 'السابعة والعشرون',
      28: 'الثامنة والعشرون',
      29: 'التاسعة والعشرون',
      30: 'الثلاثون'
    };
    
    return arabicNumbers[num] || num.toString();
  }

  // تحويل الأرقام العربية إلى إنجليزية
  function normalizeNumbers(text) {
    const arabicToEnglish = {
      '٠': '0', '١': '1', '٢': '2', '٣': '3', '٤': '4',
      '٥': '5', '٦': '6', '٧': '7', '٨': '8', '٩': '9'
    };
    
    return text.replace(/[٠-٩]/g, function(match) {
      return arabicToEnglish[match] || match;
    });
  }

  // تحسين الأداء - تحميل البيانات مرة واحدة فقط
  let homeworkDataLoaded = false;
  
  // تحميل بيانات الواجبات عند تحميل الصفحة (محسن)
  document.addEventListener('DOMContentLoaded', function() {
    if (!homeworkDataLoaded) {
      loadHomeworkData();
      homeworkDataLoaded = true;
    }
  });

  // دوال القائمة المنسدلة للواجبات في الهاتف (محسنة)
  function toggleMobileHomeworkMenu() {
    const submenu = document.getElementById('mobileHomeworkSubmenu');
    if (submenu) {
      submenu.classList.toggle('active');
    }
  }

  function closeMobileMenu() {
    const mobileMenu = document.getElementById('mobileSideMenu');
    if (mobileMenu) {
      mobileMenu.classList.remove('active');
    }
    // إغلاق القائمة المنسدلة للواجبات
    const submenu = document.getElementById('mobileHomeworkSubmenu');
    if (submenu) {
      submenu.classList.remove('active');
    }
  }
  </script>
</body>
</html>  